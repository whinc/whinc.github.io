"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[6233],{3055:(e,n,t)=>{t.d(n,{f:()=>r});var a=t(7462),o=t(633),l=t(7294);function r(e){const n=l.forwardRef(((n,t)=>e(n,t)));return function e(t){let{modalProps:r,...s}=t;const[c,u]=(0,l.useState)(!1),[d,m]=(0,l.useState)({}),[p,i]=(0,l.useState)({}),f=(0,l.useRef)(),M=(0,l.useCallback)((()=>{u(!1),m({}),i({})}),[]),y=(0,l.useMemo)((()=>({close:M,state:d,setState:m,ref:f})),[M,d]);(0,l.useEffect)((()=>(e.show=e=>{u(!0),i((()=>e))},()=>{e.show=null})),[]);const{modalProps:C={},...k}=(0,l.useMemo)((()=>"function"==typeof p?p(y):p),[y,p]),g={maskClosable:!1,destroyOnClose:!0,onCancel:M,onOk:M};return l.createElement(o.Z,(0,a.Z)({},g,r,C,{open:c}),l.createElement(n,(0,a.Z)({ref:f},s,k)))}}},7475:(e,n,t)=>{t.d(n,{Z:()=>C});const a='import { Button, message } from "antd";\nimport React, { useRef } from "react";\nimport { MyModal, MyModalInstance } from "./MyModal";\n\nexport default function App() {\n  const ref = useRef<MyModalInstance>(null);\n  return (\n    <>\n      <Button\n        onClick={() =>\n          ref.current?.open({\n            value: "hello world!",\n            modalProps: {\n              onCancel: ref.current.close,\n              onOk: async () => {\n                message.success("ok");\n                ref.current?.close();\n              },\n            },\n          })\n        }\n      >\n        \u663e\u793a\u5f39\u7a97\n      </Button>\n      <MyModal ref={ref} />\n    </>\n  );\n}\n',o="import { Modal, ModalProps } from 'antd';\nimport React, { useCallback, useImperativeHandle, useState } from 'react';\nimport { ContentProps, MyModalContent } from './MyModalContent';\n\nexport interface MyModalProps {\n  onSuccess?(): void\n}\n\nexport interface MyModalInstance {\n  open(payload?: Payload): void\n  close(): void\n}\n\ntype Payload = ContentProps & { modalProps?: ModalProps }\n\nexport const MyModal = React.forwardRef<MyModalInstance, MyModalProps>(({ onSuccess }, ref) => {\n  const [open, setOpen] = useState(false)\n  const [payload, setPayload] = useState<Payload>({});\n\n  const onOk = useCallback(async () => {\n    onSuccess?.();\n  }, [onSuccess]);\n\n  const openModal = useCallback((_payload = {}) => {\n    setOpen(true)\n    setPayload(_payload);\n  }, []);\n\n  const closeModal = useCallback(() => {\n    setOpen(false)\n    // reset payload\n    setPayload({})\n  }, [])\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      open: openModal,\n      close: closeModal\n    }),\n    [open],\n  );\n\n  return (\n    <Modal {...payload.modalProps} open={open}><MyModalContent {...payload} /></Modal>\n  );\n});\n",l='import React from "react"\n\nexport interface ContentProps {\n    value?: any\n}\n\nexport function MyModalContent(props: ContentProps) {\n    return <div>{props.value}</div>\n}';var r=t(3945),s=t(5162),c=t(4866),u=t(7294),d=t(1577),m=t(7790),p=t(7462),i=t(633);function f(e){return u.createElement("div",null,e.value)}const M=u.forwardRef(((e,n)=>{let{onSuccess:t}=e;const[a,o]=(0,u.useState)(!1),[l,r]=(0,u.useState)({}),s=((0,u.useCallback)((async()=>{t?.()}),[t]),(0,u.useCallback)((function(e){void 0===e&&(e={}),o(!0),r(e)}),[])),c=(0,u.useCallback)((()=>{o(!1),r({})}),[]);return(0,u.useImperativeHandle)(n,(()=>({open:s,close:c})),[a]),u.createElement(i.Z,(0,p.Z)({},l.modalProps,{open:a}),u.createElement(f,l))}));function y(){const e=(0,u.useRef)(null);return u.createElement(u.Fragment,null,u.createElement(d.ZP,{onClick:()=>e.current?.open({value:"hello world!",modalProps:{onCancel:e.current.close,onOk:async()=>{m.ZP.success("ok"),e.current?.close()}}})},"\u663e\u793a\u5f39\u7a97"),u.createElement(M,{ref:e}))}function C(){return u.createElement(c.Z,null,u.createElement(s.Z,{value:"1",label:"\u6548\u679c",default:!0},u.createElement(y,null)),u.createElement(s.Z,{value:"2",label:"App"},u.createElement(r.Z,{language:"tsx"},a)),u.createElement(s.Z,{value:"3",label:"MyModal"},u.createElement(r.Z,{language:"tsx"},o)),u.createElement(s.Z,{value:"4",label:"MyModalContent"},u.createElement(r.Z,{language:"tsx"},l)))}},7517:(e,n,t)=>{t.d(n,{Z:()=>f});const a='import { Button, message } from "antd";\nimport React from "react";\nimport MyModal from "./MyModal";\n\nexport default function App() {\n  return (\n    <>\n      <Button\n        onClick={() =>\n          MyModal.show(({ close }) => ({\n            value: \'hello world!\',\n            modalProps: {\n              onCancel: close,\n              onOk: async () => {\n                message.success("ok");\n                close()\n              },\n            },\n          }))\n        }\n      >\n        \u663e\u793a\u5f39\u7a97\n      </Button>\n      <MyModal />\n    </>\n  );\n}\n',o='import { createModal } from "../createModal";\nimport { MyModalContent } from "./MyModalContent";\n\nexport default createModal(MyModalContent)',l='import React from "react"\n\nexport interface ContentProps {\n    value?: any\n}\n\nexport function MyModalContent(props: ContentProps) {\n    return <div>{props.value}</div>\n}';var r=t(3945),s=t(5162),c=t(4866),u=t(7294),d=t(1577),m=t(7790);const p=(0,t(3055).f)((function(e){return u.createElement("div",null,e.value)}));function i(){return u.createElement(u.Fragment,null,u.createElement(d.ZP,{onClick:()=>p.show((e=>{let{close:n}=e;return{value:"hello world!",modalProps:{onCancel:n,onOk:async()=>{m.ZP.success("ok"),n()}}}}))},"\u663e\u793a\u5f39\u7a97"),u.createElement(p,null))}function f(){return u.createElement(c.Z,null,u.createElement(s.Z,{value:"1",label:"\u6548\u679c",default:!0},u.createElement(i,null)),u.createElement(s.Z,{value:"2",label:"App"},u.createElement(r.Z,{language:"tsx"},a)),u.createElement(s.Z,{value:"3",label:"MyModal"},u.createElement(r.Z,{language:"tsx"},o)),u.createElement(s.Z,{value:"4",label:"MyModalContent"},u.createElement(r.Z,{language:"tsx"},l)))}},6640:(e,n,t)=>{t.d(n,{Z:()=>g});const a='import { Button, message } from "antd";\nimport React from "react";\nimport MyModal from "./MyModal";\n\nconst mockRequest = (data: any) => new Promise((r) => setTimeout(r, 2000));\n\nexport default function App() {\n  return (\n    <>\n      <Button\n        onClick={() =>\n          MyModal.show(({ close, state, setState, ref }) => ({\n            initialValues: {\n              name: "zhangsan",\n              age: 20,\n            },\n            modalProps: {\n              title: "\u6ce8\u518c\u7528\u6237",\n              confirmLoading: state.loading,\n              onCancel: close,\n              onOk: async () => {\n                setState({ loading: true });\n                const formData = await ref.current.submit();\n                await mockRequest(formData);\n                setState({ loading: false });\n                message.success("\u63d0\u4ea4\u8868\u5355\uff1a" + JSON.stringify(formData));\n                close();\n              },\n            },\n          }))\n        }\n      >\n        \u663e\u793a\u5f39\u7a97\n      </Button>\n      <MyModal />\n    </>\n  );\n}\n',o='import { createModal } from "../createModal";\nimport { MyModalContent } from "./MyModalContent";\n\nexport default createModal(MyModalContent)',l='import { Form, Input, InputNumber } from "antd";\nimport React, { useImperativeHandle } from "react";\n\nexport interface ContentProps {\n  initialValues?: any;\n}\n\nexport interface ContentInstance {\n  submit(): Promise<void>;\n}\n\nexport function MyModalContent(\n  props: ContentProps,\n  ref: React.MutableRefObject<ContentInstance>\n) {\n  const [form] = Form.useForm();\n\n  useImperativeHandle(ref, () => ({\n    async submit() {\n      return await form.validateFields();\n    },\n  }));\n  return (\n    <Form form={form} initialValues={props.initialValues}>\n      <Form.Item name={"name"} label="\u59d3\u540d">\n        <Input />\n      </Form.Item>\n      <Form.Item name={"age"} label="\u5e74\u9f84">\n        <InputNumber />\n      </Form.Item>\n    </Form>\n  );\n}\n';var r=t(3945),s=t(5162),c=t(4866),u=t(7294),d=t(1577),m=t(7790),p=t(3055),i=t(5411),f=t(8270),M=t(9627);const y=(0,p.f)((function(e,n){const[t]=i.Z.useForm();return(0,u.useImperativeHandle)(n,(()=>({submit:async()=>await t.validateFields()}))),u.createElement(i.Z,{form:t,initialValues:e.initialValues},u.createElement(i.Z.Item,{name:"name",label:"\u59d3\u540d"},u.createElement(f.Z,null)),u.createElement(i.Z.Item,{name:"age",label:"\u5e74\u9f84"},u.createElement(M.Z,null)))})),C=e=>new Promise((e=>setTimeout(e,2e3)));function k(){return u.createElement(u.Fragment,null,u.createElement(d.ZP,{onClick:()=>y.show((e=>{let{close:n,state:t,setState:a,ref:o}=e;return{initialValues:{name:"zhangsan",age:20},modalProps:{title:"\u6ce8\u518c\u7528\u6237",confirmLoading:t.loading,onCancel:n,onOk:async()=>{a({loading:!0});const e=await o.current.submit();await C(e),a({loading:!1}),m.ZP.success("\u63d0\u4ea4\u8868\u5355\uff1a"+JSON.stringify(e)),n()}}}}))},"\u663e\u793a\u5f39\u7a97"),u.createElement(y,null))}function g(){return u.createElement(c.Z,null,u.createElement(s.Z,{value:"1",label:"\u6548\u679c",default:!0},u.createElement(k,null)),u.createElement(s.Z,{value:"2",label:"App"},u.createElement(r.Z,{language:"tsx"},a)),u.createElement(s.Z,{value:"3",label:"MyModal"},u.createElement(r.Z,{language:"tsx"},o)),u.createElement(s.Z,{value:"4",label:"MyModalContent"},u.createElement(r.Z,{language:"tsx"},l)))}},3945:(e,n,t)=>{t.d(n,{Z:()=>l});var a=t(7294),o=t(814);function l(e){return a.createElement(a.Fragment,null,a.createElement(o.Z,e))}},8707:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>m,default:()=>C,frontMatter:()=>d,metadata:()=>p,toc:()=>f});var a=t(7462),o=(t(7294),t(3905)),l=t(7475),r=t(3945),s=t(9533),c=t(7517),u=t(6640);const d={tags:["antd","react"],keywords:["antd","modal"]},m="Antd \u5f39\u7a97\u5c01\u88c5",p={permalink:"/blog/2023/antd-create-modal",editUrl:"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2023/antd-create-modal/index.md",source:"@site/blog/2023/antd-create-modal/index.md",title:"Antd \u5f39\u7a97\u5c01\u88c5",description:"\u5728 Antd \u4e2d\u5f39\u7a97\u7684\u4f7f\u7528\u9891\u7387\u5f88\u9ad8\uff0c\u7b80\u5355\u7684\u5c55\u793a\u5f39\u7a97\u4f7f\u7528Modal.method()\u5373\u53ef\uff0c\u590d\u6742\u7684\u5f39\u7a97\u7684\u5f39\u7a97\u5219\u9700\u8981\u81ea\u5b9a\u4e49\u5f39\u7a97\uff0c\u4ee5\u4fbf\u63a7\u5236\u5f39\u7a97\u7684\u663e\u793a\u548c\u9690\u85cf\uff0c\u4ee5\u53ca\u6570\u636e\u4ea4\u4e92\u3002",date:"2023-03-08T06:52:58.000Z",formattedDate:"March 8, 2023",tags:[{label:"antd",permalink:"/blog/tags/antd"},{label:"react",permalink:"/blog/tags/react"}],readingTime:2.785,hasTruncateMarker:!1,authors:[],frontMatter:{tags:["antd","react"],keywords:["antd","modal"]},nextItem:{title:"\u5982\u4f55\u642d\u5efa\u535a\u5ba2\u7ad9\u70b9",permalink:"/blog/2023/how-to-setup-blog"}},i={authorsImageUrls:[]},f=[{value:"\u7b2c\u4e00\u7248",id:"\u7b2c\u4e00\u7248",level:2},{value:"\u7b2c\u4e8c\u7248",id:"\u7b2c\u4e8c\u7248",level:2},{value:"\u5c0f\u7ed3",id:"\u5c0f\u7ed3",level:2}],M={toc:f},y="wrapper";function C(e){let{components:n,...t}=e;return(0,o.kt)(y,(0,a.Z)({},M,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5728 Antd \u4e2d\u5f39\u7a97\u7684\u4f7f\u7528\u9891\u7387\u5f88\u9ad8\uff0c\u7b80\u5355\u7684\u5c55\u793a\u5f39\u7a97\u4f7f\u7528",(0,o.kt)("a",{parentName:"p",href:"https://4x.ant.design/components/modal-cn/#Modal.method()"},"Modal.method()"),"\u5373\u53ef\uff0c\u590d\u6742\u7684\u5f39\u7a97\u7684\u5f39\u7a97\u5219\u9700\u8981\u81ea\u5b9a\u4e49\u5f39\u7a97\uff0c\u4ee5\u4fbf\u63a7\u5236\u5f39\u7a97\u7684\u663e\u793a\u548c\u9690\u85cf\uff0c\u4ee5\u53ca\u6570\u636e\u4ea4\u4e92\u3002"),(0,o.kt)("h2",{id:"\u7b2c\u4e00\u7248"},"\u7b2c\u4e00\u7248"),(0,o.kt)("p",null,"\u4e0b\u9762\u662f\u6211\u5c01\u88c5\u7684\u7b2c\u4e00\u7248\u5f39\u7a97\uff0c\u5f39\u7a97\u901a\u8fc7\u66b4\u9732 ref \u5f15\u7528\uff0c\u8ba9\u5916\u90e8\u63a7\u5236\u5f39\u7a97\u7684\u663e\u793a\uff0c\u4ee5\u53ca\u4f20\u9012\u6570\u636e\u7ed9\u5f39\u7a97\u5bb9\uff0c\u901a\u8fc7\u56de\u8c03\u51fd\u6570\u5c06\u5f39\u7a97\u5185\u90e8\u7684\u5904\u7406\u7ed3\u679c\u4f20\u9012\u7ed9\u5916\u90e8\u3002"),(0,o.kt)(l.Z,{mdxType:"Demo1"}),(0,o.kt)("h2",{id:"\u7b2c\u4e8c\u7248"},"\u7b2c\u4e8c\u7248"),(0,o.kt)("p",null,"\u57fa\u4e8e\u4e0a\u9762\u5f39\u7a97\u7684\u5c01\u88c5\u6a21\u5f0f\uff0c\u6839\u636e\u9700\u8981\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u57fa\u672c\u80fd\u6ee1\u8db3\u5927\u90e8\u5206\u5f39\u7a97\u4f7f\u7528\u573a\u666f\u4e86\u3002\u4f46\u662f\u4e0a\u9762\u5c01\u88c5\u65b9\u5f0f\u6709\u4e0d\u5c11\u6837\u677f\u4ee3\u7801\uff0c\u6bcf\u6b21\u5199\u4e2a\u5f39\u7a97\u6709\u4e0d\u5c11\u91cd\u590d\u5de5\u4f5c\uff0c\u4e8e\u662f\u5c06\u5bf9\u5f39\u7a97\u7684\u5c01\u88c5\u6a21\u5f0f\u5265\u79bb\u51fa\u6765\u5f62\u6210\u4e00\u4e2a\u72ec\u7acb\u7684\u51fd\u6570",(0,o.kt)("inlineCode",{parentName:"p"},"createModal"),"\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u6837\u677f\u4ee3\u7801\uff0c\u805a\u7126\u4e8e\u7f16\u5199\u5f39\u7a97\u7684\u5185\u5bb9\u548c\u4ea4\u4e92\u903b\u8f91\u3002"),(0,o.kt)(r.Z,{language:"tsx",mdxType:"CodeBlock"},s.Z),(0,o.kt)("p",null,"\u4e0b\u9762\u662f\u57fa\u4e8e ",(0,o.kt)("inlineCode",{parentName:"p"},"createModal")," \u521b\u5efa\u5f39\u7a97\u7684\u793a\u4f8b\uff0c\u53ef\u4ee5\u770b\u5230\u5f39\u7a97\u7684\u6e90\u7801\u5df2\u7ecf\u51cf\u5c11\u5230\u4e00\u884c\u4ee3\u7801\u4e86\uff0c\u5199\u5f39\u7a97\u65f6\u53ea\u9700\u8981\u5173\u6ce8\u4e8e\u5f39\u7a97\u7684\u5185\u5bb9\u533a\u57df\uff0c\u4f7f\u7528\u5f39\u7a97\u65f6\u4e5f\u65e0\u9700\u521b\u5efa ref \u6765\u5f15\u7528\u5f39\u7a97\uff0c\u800c\u662f\u901a\u8fc7\u5f39\u7a97\u4e0a\u66b4\u9732\u7684\u9759\u6001\u65b9\u6cd5",(0,o.kt)("inlineCode",{parentName:"p"},"MyModal.show()"),"\u663e\u793a\u5f39\u7a97\u548c\u4f20\u53c2\u3002"),(0,o.kt)(c.Z,{mdxType:"Demo2"}),(0,o.kt)("p",null,"\u7ecf\u8fc7",(0,o.kt)("inlineCode",{parentName:"p"},"createModal"),"\u5c01\u88c5\u540e\uff0c\u4e1a\u52a1\u5c42\u53ea\u9700\u5173\u6ce8\u5f39\u7a97\u7684\u5185\u5bb9\uff08\u5373",(0,o.kt)("inlineCode",{parentName:"p"},"<Modal>"),"\u7684\u5b50\u7ec4\u4ef6\uff09\uff0c\u65e0\u9700\u5904\u7406\u5f39\u7a97\u4e0e\u5185\u5bb9\u7684\u4ea4\u4e92\u3002 \u90a3\u4f7f\u7528\u65f6\u5982\u4f55\u63a7\u5236\u5f39\u7a97\u7684\u4ea4\u4e92\u5462\uff1f\u4f8b\u5982\u70b9\u51fb\u786e\u8ba4\u65f6\u83b7\u53d6\u5f39\u7a97\u4e2d\u7684\u8868\u5355\u5185\u5bb9\u3001\u70b9\u51fb\u786e\u8ba4\u65f6\u5f39\u7a97\u6309\u94ae\u663e\u793a loading \u6548\u679c\u7b49\u3002"),(0,o.kt)("p",null,"\u7b54\u6848\u662f\u901a\u8fc7\u5f39\u7a97\u66b4\u9732\u7684\u9759\u6001\u65b9\u6cd5",(0,o.kt)("inlineCode",{parentName:"p"},"MyModal.show()"),"\u5b9e\u73b0\uff0c\u8bf7\u770b\u4e0b\u9762\u4f8b\u5b50\uff0c\u901a\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"p"},"state/setState"),"\u53ef\u4ee5\u5728\u5f39\u7a97\u7ec4\u4ef6\u5185\u90e8\u5b58\u50a8\u72b6\u6001\uff0c\u901a\u8fc7 ref \u53ef\u4ee5\u8c03\u7528\u5f39\u7a97\u5185\u5bb9\u7ec4\u4ef6\u66b4\u9732\u7684\u65b9\u6cd5\u3002"),(0,o.kt)(u.Z,{mdxType:"Demo3"}),(0,o.kt)("h2",{id:"\u5c0f\u7ed3"},"\u5c0f\u7ed3"),(0,o.kt)("p",null,"Antd \u7684\u5f39\u7a97\u529f\u80fd\u5f88\u591a\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u8fd8\u662f\u9700\u8981\u505a\u4e0d\u5c11\u5de5\u4f5c\uff0c\u901a\u8fc7\u5c01\u88c5 Antd \u7684\u5f39\u7a97\uff0c\u5927\u5927\u7b80\u5316\u4e86\u5f39\u7a97\u7684\u5904\u7406\u903b\u8f91\uff0c\u8ba9\u4e1a\u52a1\u5c42\u4e13\u6ce8\u4e8e\u5f39\u7a97\u7684\u5185\u5bb9\u903b\u8f91\u3002"))}C.isMDXComponent=!0},9533:(e,n,t)=>{t.d(n,{Z:()=>a});const a="import { Modal } from 'antd';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nexport function createModal(ContentComponent) {\n  const ContentComponent2 = React.forwardRef((props, ref) => ContentComponent(props, ref));\n\n  return function NewModal({ modalProps: modalProps, ...props }) {\n    const [open, setOpen] = useState(false);\n\n    // store UI data\n    const [state, setState] = useState({});\n    const [payload, setPayload] = useState({});\n    const ref = useRef();\n\n    const close = useCallback(() => {\n      setOpen(false);\n      // reset\n      setState({});\n      setPayload({});\n    }, []);\n\n    const actions = useMemo(() => ({ close, state, setState, ref }), [close, state]);\n\n    useEffect(() => {\n      const show = (_payload) => {\n        setOpen(true);\n        setPayload(() => _payload);\n      };\n      NewModal.show = show;\n      return () => {\n        NewModal.show = null;\n      };\n    }, []);\n\n    const { modalProps: modalProps2 = {}, ...props2 } = useMemo(\n      () => (typeof payload === 'function' ? payload(actions) : payload),\n      [actions, payload],\n    );\n\n    /** @type {import('antd').ModalProps} */\n    const defaultModalProps = {\n      maskClosable: false,\n      destroyOnClose: true,\n      onCancel: close,\n      onOk: close,\n    };\n    return (\n      <Modal {...defaultModalProps} {...modalProps} {...modalProps2} open={open}>\n        <ContentComponent2 ref={ref} {...props} {...props2} />\n      </Modal>\n    );\n  };\n}\n"}}]);