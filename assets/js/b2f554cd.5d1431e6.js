"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1477],{30010:n=>{n.exports=JSON.parse('{"blogPosts":[{"id":"/2023/04/05/knex-tutorial","metadata":{"permalink":"/blog/2023/04/05/knex-tutorial","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2023/04-05-knex-tutorial/index.mdx","source":"@site/blog/2023/04-05-knex-tutorial/index.mdx","title":"Knex.js \u6559\u7a0b","description":"\u4ec0\u4e48\u662f Knex \uff1f","date":"2023-04-05T00:00:00.000Z","formattedDate":"April 5, 2023","tags":[{"label":"Node.js","permalink":"/blog/tags/node-js"},{"label":"ORM","permalink":"/blog/tags/orm"}],"readingTime":12.245,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Node.js","ORM"],"keywords":["knex","orm","query builder"]},"nextItem":{"title":"Antd \u5f39\u7a97\u5c01\u88c5","permalink":"/blog/2023/03/04/antd-create-modal"}},"content":"## \u4ec0\u4e48\u662f Knex \uff1f\\n\\n[Knex](https://github.com/knex/knex) \u662f\u4e00\u4e2a\u6d41\u884c\u7684Node.js SQL\u67e5\u8be2\u6784\u5efa\u5668\uff0c\u5b83\u5141\u8bb8\u4f60\u4f7f\u7528JavaScript\u8bed\u8a00\u7f16\u5199SQL\u67e5\u8be2\uff0c\u800c\u65e0\u9700\u76f4\u63a5\u7f16\u5199SQL\u8bed\u53e5\u3002\u5b83\u652f\u6301\u591a\u79cd\u6570\u636e\u5e93\uff0c\u5305\u62ecMySQL\uff0cPostgreSQL\uff0cSQLite\u548cMicrosoft SQL Server\u7b49\u3002\\n\\n\u4f7f\u7528Knex.js\uff0c\u4f60\u53ef\u4ee5\u8f7b\u677e\u5730\u6784\u5efa\u590d\u6742\u7684SQL\u67e5\u8be2\uff0c\u5305\u62ec\u8054\u63a5\u3001\u5b50\u67e5\u8be2\u548c\u805a\u5408\u51fd\u6570\u7b49\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u4fbf\u7684\u529f\u80fd\uff0c\u5982\u4e8b\u52a1\u5904\u7406\uff0c\u6279\u91cf\u63d2\u5165\u548c\u66f4\u65b0\u7b49\u3002\\n\\nKnex.js\u7684API\u7b80\u5355\u6613\u7528\uff0c\u5177\u6709\u826f\u597d\u7684\u6587\u6863\u548c\u793e\u533a\u652f\u6301\u3002\u5b83\u8fd8\u63d0\u4f9b\u4e86\u53ef\u6269\u5c55\u6027\u548c\u7075\u6d3b\u6027\uff0c\u5141\u8bb8\u4f60\u8f7b\u677e\u5730\u81ea\u5b9a\u4e49\u548c\u6269\u5c55\u5176\u529f\u80fd\u3002\\n\\n\u4e0b\u9762\u662f Knex \u7684\u4f7f\u7528\u793a\u4f8b\uff0c\u4f7f\u7528 js \u5b9e\u73b0\u7684 DSL \u8bfb\u5199\u4e0a\u4e0e SQL \u975e\u5e38\u76f8\u4f3c\u3002\\n\\nimport RunKitEmbed from \'@site/src/components/RunKitEmbed\';\\nimport preamble from \'!!raw-loader!./preamble\'\\n\\n<RunKitEmbed \\nevaluateOnLoad\\nsource={`\\n${preamble}\\np(db.table(\'aa\').select(\'b\', \'c\'))\\n`} />\\n\\n\x3c!--truncate--\x3e\\n\\n\u7531\u4e8e Node.js \u6ca1\u6709\u63d0\u4f9b\u50cf java \u4e2d\u7684 JDBC \u8fd9\u6837\u7684\u6570\u636e\u5e93\u8bbf\u95ee\u62bd\u8c61\u5c42\uff0c\u5bfc\u81f4\u57fa\u4e8e\u539f\u751f\u7684 Node.js \u8fdb\u884c\u6570\u636e\u5e93\u7f16\u7a0b\u65f6\uff0c\u9700\u8981\u9762\u5411\u4e0d\u540c\u7684\u6570\u636e\u5e93\u7c7b\u578b\u63d0\u4f9b\u7684\u5e95\u5c42 SDK \u7f16\u7a0b\uff0c\u5b66\u4e60\u6210\u672c\u9ad8\u3001\u4e0d\u53ef\u79fb\u690d\u3002\\n\\nKnex \u5efa\u7acb\u5728\u5e95\u5c42\u6570\u636e\u5e93\u63d0\u4f9b\u7684 SDK \u4e4b\u4e0a\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684 API \u6570\u636e\u5e93\u63a5\u53e3\uff0c\u53ef\u4ee5\u5c06\u5176\u770b\u6210\u662f Node.js \u4e2d\u7c7b\u4f3c\\"JDBC\\"\u7684\u5b58\u5728\uff0c\u4ee3\u7801\u4e0e\u5e95\u5c42\u6570\u636e\u5e93\u8026\u5408\u5f31\uff0c\u65b9\u4fbf\u5728\u6570\u636e\u5e93\u4e4b\u95f4\u8fc1\u79fb\uff08\u5982\u672c\u5730\u5f00\u53d1\u6d4b\u8bd5\u7528 sqlite3\uff0c\u7ebf\u4e0a\u7528MySQL\uff09\uff0c\u65e0\u9700\u5b66\u4e60 SQL \u65b9\u8a00\u3002\\n\\n```mermaid\\nflowchart TD\\n    A[Web Server] --\x3e|DSL based on javascript| B(Knex)\\n    B --\x3e MySQL\\n    B --\x3e PostgreSQL\\n    B --\x3e |native sql| SQLite3\\n    B --\x3e SQLServer[SQL Server]\\n    B --\x3e Oracle\\n```\\n\\n## \u4f18\u7f3a\u70b9\u53ca\u5e94\u7528\u573a\u666f\\n\\n\u4f18\u70b9\uff1a\\n- **\u7b80\u5355\u6613\u7528**\uff1aKnex.js\u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u800c\u76f4\u89c2\u7684API\uff0c\u4f7f\u5f97\u6784\u5efa\u548c\u6267\u884cSQL\u67e5\u8be2\u53d8\u5f97\u975e\u5e38\u5bb9\u6613\u3002\\n- **\u8de8\u6570\u636e\u5e93\u652f\u6301**\uff1aKnex.js\u652f\u6301\u591a\u79cd\u6570\u636e\u5e93\uff0c\u5305\u62ecMySQL\u3001PostgreSQL\u3001SQLite\u548cOracle\u7b49\uff0c\u4f7f\u5f97\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u8f7b\u677e\u5730\u5728\u4e0d\u540c\u7684\u6570\u636e\u5e93\u4e4b\u95f4\u5207\u6362\u3002\\n- **\u5b89\u5168\u6027**\uff1aKnex.js\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5b89\u5168\u529f\u80fd\uff0c\u4f8b\u5982\u53c2\u6570\u5316\u67e5\u8be2\u548c\u9632\u6b62SQL\u6ce8\u5165\u653b\u51fb\u7b49\uff0c\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u514d\u53d7\u5b89\u5168\u6f0f\u6d1e\u7684\u5f71\u54cd\u3002\\n- **\u53ef\u6d4b\u8bd5\u6027**\uff1aKnex.js\u7684\u67e5\u8be2\u6784\u5efa\u5668\u53ef\u4ee5\u8f7b\u677e\u5730\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u4f7f\u5f97\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u6d4b\u8bd5\u5176\u5e94\u7528\u7a0b\u5e8f\u7684\u67e5\u8be2\u903b\u8f91\u3002\\n\\n\u7f3a\u70b9\uff1a\\n- **\u6027\u80fd**\uff1aKnex.js\u7684\u6027\u80fd\u53ef\u80fd\u4e0d\u5982\u539f\u751f\u7684SQL\u67e5\u8be2\uff0c\u56e0\u4e3a\u5b83\u9700\u8981\u5c06\u67e5\u8be2\u6784\u5efa\u5668\u8f6c\u6362\u4e3aSQL\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u6027\u80fd\u635f\u5931\u3002\\n- **\u5b66\u4e60\u66f2\u7ebf**\uff1a\u5c3d\u7ba1Knex.js\u7684API\u76f8\u5bf9\u7b80\u5355\uff0c\u4f46\u5bf9\u4e8e\u65b0\u624b\u6765\u8bf4\uff0c\u5b66\u4e60\u5982\u4f55\u4f7f\u7528\u5b83\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u548c\u52aa\u529b\u3002\\n- **\u9650\u5236**\uff1aKnex.js\u7684\u67e5\u8be2\u6784\u5efa\u5668\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u6240\u6709\u7684\u67e5\u8be2\u9700\u6c42\uff0c\u56e0\u4e3a\u5b83\u662f\u57fa\u4e8e\u4e00\u7ec4\u9884\u5b9a\u4e49\u7684API\u6784\u5efa\u7684\uff0c\u800c\u4e0d\u662f\u539f\u751f\u7684SQL\u67e5\u8be2\u8bed\u53e5\u3002\\n\\n\u5e94\u7528\u573a\u666f\uff1a\\n- Web\u5e94\u7528\u7a0b\u5e8f\uff1aKnex.js\u53ef\u4ee5\u7528\u4e8e\u6784\u5efaWeb\u5e94\u7528\u7a0b\u5e8f\u7684\u540e\u7aef\uff0c\u4ee5\u4fbf\u4e0e\u6570\u636e\u5e93\u8fdb\u884c\u4ea4\u4e92\u3002\u5b83\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u5730\u6784\u5efa\u548c\u6267\u884cSQL\u67e5\u8be2\uff0c\u4ece\u800c\u7b80\u5316\u4e86Web\u5e94\u7528\u7a0b\u5e8f\u7684\u5f00\u53d1\u8fc7\u7a0b\u3002\\n- \u6570\u636e\u5206\u6790\uff1aKnex.js\u53ef\u4ee5\u7528\u4e8e\u6570\u636e\u5206\u6790\u5e94\u7528\u7a0b\u5e8f\uff0c\u4ee5\u4fbf\u4ece\u6570\u636e\u5e93\u4e2d\u68c0\u7d22\u548c\u5206\u6790\u6570\u636e\u3002\u5b83\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u5730\u6784\u5efa\u590d\u6742\u7684\u67e5\u8be2\uff0c\u4ece\u800c\u4f7f\u6570\u636e\u5206\u6790\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\\n- \u6570\u636e\u5e93\u7ba1\u7406\u5de5\u5177\uff1aKnex.js\u53ef\u4ee5\u7528\u4e8e\u6784\u5efa\u6570\u636e\u5e93\u7ba1\u7406\u5de5\u5177\uff0c\u4ee5\u4fbf\u7ba1\u7406\u548c\u7ef4\u62a4\u6570\u636e\u5e93\u3002\u5b83\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u5730\u6267\u884c\u6570\u636e\u5e93\u64cd\u4f5c\uff0c\u4f8b\u5982\u521b\u5efa\u8868\u683c\u3001\u63d2\u5165\u6570\u636e\u548c\u66f4\u65b0\u6570\u636e\u7b49\u3002\\n- \u670d\u52a1\u5668\u7aef\u6e32\u67d3\uff1aKnex.js\u53ef\u4ee5\u7528\u4e8e\u670d\u52a1\u5668\u7aef\u6e32\u67d3\u5e94\u7528\u7a0b\u5e8f\uff0c\u4ee5\u4fbf\u4ece\u6570\u636e\u5e93\u4e2d\u68c0\u7d22\u6570\u636e\u5e76\u5c06\u5176\u5448\u73b0\u4e3aHTML\u3002\u5b83\u53ef\u4ee5\u5e2e\u52a9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u5730\u6784\u5efa\u590d\u6742\u7684\u67e5\u8be2\uff0c\u4ece\u800c\u4f7f\u670d\u52a1\u5668\u7aef\u6e32\u67d3\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u3002\\n\\n## \u914d\u7f6e\\n\\n### \u8fde\u63a5\u6c60\u914d\u7f6e\\n\\n\u5728\u914d\u7f6e\u4e2d\u8bbe\u7f6e\u5408\u9002\u7684\u8fde\u63a5\u6c60\u6709\u52a9\u4e8e\u4f18\u5316\u6570\u636e\u5e93\u6027\u80fd\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u8003[pool](https://knexjs.org/guide/#pool)\\n```js\\nconst knex = require(\'knex\')({\\n  client: \'mysql\',\\n  connection: {\\n    host: \'localhost\',\\n    user: \'root\',\\n    password: \'password\',\\n    database: \'mydatabase\'\\n  },\\n  // highlight-start\\n  pool: {\\n    min: 0,\\n    max: 10\\n  }\\n  // highlight-end\\n});\\n```\\n\\n## \u5b9e\u6218\u793a\u4f8b\\n\\n### Schema Building\\n\\nknex.js\u7684 Schema Building \u529f\u80fd\u975e\u5e38\u5f3a\u5927\u548c\u7075\u6d3b\uff0c\u4f7f\u7528\u5b83\u53ef\u4ee5\u8f7b\u677e\u6784\u5efa\u548c\u7ba1\u7406\u5e38\u89c1\u7684\u6570\u636e\u5e93\u6a21\u5f0f\u3002\\n\\n1. \u521b\u5efa\u8868\u683c\uff1a\u4f7f\u7528`createTable`\u65b9\u6cd5\u53ef\u4ee5\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u8868\u683c\u3002\\n```js\\nknex.schema.createTable(\'users\', (table) => {\\n  table.increments(\'id\');\\n  table.string(\'name\');\\n  table.string(\'email\');\\n})\\n.then(() => {\\n  console.log(\'Table created\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n2. \u4fee\u6539\u8868\u683c\uff1a\u4f7f\u7528`alterTable`\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u3002\\n\\n```js\\nknex.schema.alterTable(\'users\', (table) => {\\n  table.string(\'password\');\\n})\\n.then(() => {\\n  console.log(\'Table altered\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n3. \u5220\u9664\u8868\u683c\uff1a\u4f7f\u7528`dropTable`\u65b9\u6cd5\u53ef\u4ee5\u5220\u9664\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u3002\\n```javascript\\nknex.schema.dropTable(\'users\')\\n.then(() => {\\n  console.log(\'Table dropped\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n4. \u6dfb\u52a0\u5217\uff1a\u4f7f\u7528`addColumn`\u65b9\u6cd5\u53ef\u4ee5\u5411\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u6dfb\u52a0\u65b0\u5217\u3002\\n```javascript\\nknex.schema.table(\'users\', (table) => {\\n  table.string(\'password\');\\n})\\n.then(() => {\\n  console.log(\'Column added\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n5. \u4fee\u6539\u5217\uff1a\u4f7f\u7528`alterColumn`\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u5217\u3002\\n```javascript\\nknex.schema.table(\'users\', (table) => {\\n  table.string(\'password\').notNullable().defaultTo(\'\');\\n})\\n.then(() => {\\n  console.log(\'Column altered\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n6. \u6dfb\u52a0\u7d22\u5f15\uff1a\u4f7f\u7528`index`\u65b9\u6cd5\u53ef\u4ee5\u5411\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u6dfb\u52a0\u7d22\u5f15\u3002\\n```javascript\\nknex.schema.table(\'users\', (table) => {\\n  table.index(\'email\');\\n})\\n.then(() => {\\n  console.log(\'Index added\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n7. \u6dfb\u52a0\u5916\u952e\uff1a\u4f7f\u7528`foreign`\u65b9\u6cd5\u53ef\u4ee5\u5411\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u6dfb\u52a0\u5916\u952e\u3002\\n```javascript\\nknex.schema.table(\'orders\', (table) => {\\n  table.integer(\'user_id\').unsigned().references(\'id\').inTable(\'users\');\\n})\\n.then(() => {\\n  console.log(\'Foreign key added\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n8. \u4fee\u6539\u5916\u952e\uff1a\u4f7f\u7528`dropForeign`\u548c`foreign`\u65b9\u6cd5\u53ef\u4ee5\u4fee\u6539\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u5916\u952e\u3002\\n```javascript\\nknex.schema.table(\'orders\', (table) => {\\n  table.dropForeign(\'user_id\');\\n  table.integer(\'customer_id\').unsigned().references(\'id\').inTable(\'customers\');\\n})\\n.then(() => {\\n  console.log(\'Foreign key altered\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n9. \u6dfb\u52a0\u552f\u4e00\u7ea6\u675f\uff1a\u4f7f\u7528`unique`\u65b9\u6cd5\u53ef\u4ee5\u5411\u73b0\u6709\u7684\u6570\u636e\u5e93\u8868\u683c\u6dfb\u52a0\u552f\u4e00\u7ea6\u675f\u3002\\n```javascript\\nknex.schema.table(\'users\', (table) => {\\n  table.unique(\'email\');\\n})\\n.then(() => {\\n  console.log(\'Unique constraint added\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n\u9664\u4e86\u4e0a\u8ff0\u573a\u666f\u5916\uff0c\u901a\u8fc7`raw`\u65b9\u6cd5\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u6570\u636e\u5e93\u539f\u751f\u7684\u4e00\u4e9b\u6a21\u5f0f\uff0c\u5982MySQL\u4e2d\u7684\u89c6\u56fe\u3001\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u3001\u5e8f\u5217\u7b49\u529f\u80fd\u3002\\n\\n10. \u521b\u5efa\u89c6\u56fe\uff1a\u4f7f\u7528`raw`\u65b9\u6cd5\u53ef\u4ee5\u521b\u5efa\u65b0\u7684\u6570\u636e\u5e93\u89c6\u56fe\u3002\\n```js\\nknex.raw(\'CREATE VIEW active_users AS SELECT * FROM users WHERE active = 1\')\\n.then(() => {\\n  console.log(\'View created\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n### CRUD \u589e\u5220\u6539\u67e5\\n\\n\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528MySQL\u4f5c\u4e3a\u6570\u636e\u5e93\u5ba2\u6237\u7aef\uff0c\u5e76\u8fde\u63a5\u5230\u540d\u4e3amydatabase\u7684\u6570\u636e\u5e93\u3002\u6211\u4eec\u4f7f\u7528knex\u5bf9\u8c61\u6765\u6267\u884cCRUD\u64cd\u4f5c\u3002\\n\\n\u9996\u5148\uff0c\u6211\u4eec\u4f7f\u7528insert\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u65b0\u7528\u6237\u3002\u7136\u540e\uff0c\u6211\u4eec\u4f7f\u7528select\u65b9\u6cd5\u8bfb\u53d6\u6240\u6709\u7528\u6237\u7684\u6570\u636e\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528update\u65b9\u6cd5\u66f4\u65b0ID\u4e3a1\u7684\u7528\u6237\u7684\u540d\u79f0\u3002\u6700\u540e\uff0c\u6211\u4eec\u4f7f\u7528del\u65b9\u6cd5\u5220\u9664ID\u4e3a1\u7684\u7528\u6237\u3002\\n\\n```js\\nconst knex = require(\'knex\')({\\n  client: \'mysql\',\\n  connection: {\\n    host: \'localhost\',\\n    user: \'root\',\\n    password: \'password\',\\n    database: \'mydatabase\'\\n  }\\n});\\n\\n// Create\\nknex(\'users\').insert({ name: \'John\', email: \'john@example.com\' })\\n  .then(() => {\\n    console.log(\'User created\');\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n\\n// Read\\nknex(\'users\').select(\'*\')\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n\\n// Update\\nknex(\'users\').where({ id: 1 }).update({ name: \'Jane\' })\\n  .then(() => {\\n    console.log(\'User updated\');\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n\\n// Delete\\nknex(\'users\').where({ id: 1 }).del()\\n  .then(() => {\\n    console.log(\'User deleted\');\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n### \u5206\u9875\u67e5\u8be2\\n\\n\u5728Knex.js\u4e2d\u5b9e\u73b0\u5206\u9875\u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528`limit`\u548c`offset`\u65b9\u6cd5\u3002`limit`\u65b9\u6cd5\u7528\u4e8e\u9650\u5236\u67e5\u8be2\u7ed3\u679c\u7684\u6570\u91cf\uff0c`offset`\u65b9\u6cd5\u7528\u4e8e\u6307\u5b9a\u67e5\u8be2\u7ed3\u679c\u7684\u504f\u79fb\u91cf\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a\\n\\n```js\\nconst page = 2; // \u7b2c\u4e8c\u9875\\nconst pageSize = 10; // \u6bcf\u987510\u6761\u8bb0\u5f55\\n\\nknex(\'users\')\\n  .select(\'*\')\\n  // highlight-start\\n  .limit(pageSize)\\n  .offset((page - 1) * pageSize)\\n  // highlight-end\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528`limit`\u65b9\u6cd5\u9650\u5236\u67e5\u8be2\u7ed3\u679c\u7684\u6570\u91cf\u4e3a10\u6761\u8bb0\u5f55\uff0c\u4f7f\u7528`offset`\u65b9\u6cd5\u6307\u5b9a\u67e5\u8be2\u7ed3\u679c\u7684\u504f\u79fb\u91cf\u4e3a10\u6761\u8bb0\u5f55\uff08\u5373\u7b2c\u4e8c\u9875\uff09\u3002\u8fd9\u5c06\u8fd4\u56de\u7b2c11\u5230\u7b2c20\u6761\u8bb0\u5f55\u3002\\n\\n\u5982\u679c\u60a8\u5e0c\u671b\u5728\u67e5\u8be2\u4e2d\u6dfb\u52a0\u5176\u4ed6\u6761\u4ef6\uff0c\u4f8b\u5982\u6309\u540d\u79f0\u6392\u5e8f\uff0c\u5219\u53ef\u4ee5\u5728select\u65b9\u6cd5\u4e4b\u540e\u6dfb\u52a0orderBy\u65b9\u6cd5\uff1a\\n```js\\nconst page = 2; // \u7b2c\u4e8c\u9875\\nconst pageSize = 10; // \u6bcf\u987510\u6761\u8bb0\u5f55\\n\\nknex(\'users\')\\n  .select(\'*\')\\n  // highlight-start\\n  .orderBy(\'name\', \'asc\')\\n  .limit(pageSize)\\n  .offset((page - 1) * pageSize)\\n  // highlight-end\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n### \u6279\u91cf\u63d2\u5165\\n\\n\u4f7f\u7528batchInsert\u65b9\u6cd5\u53ef\u4ee5\u4e00\u6b21\u6027\u63d2\u5165\u591a\u4e2a\u8bb0\u5f55\\n```js\\nknex.batchInsert(\'users\', [\\n  { name: \'John\', email: \'john@example.com\' },\\n  { name: \'Jane\', email: \'jane@example.com\' },\\n  { name: \'Bob\', email: \'bob@example.com\' }\\n])\\n.then(() => {\\n  console.log(\'Batch insert complete\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n### \u8054\u7ed3\u67e5\u8be2\\n\\n\u5728Knex.js\u4e2d\u5b9e\u73b0\u8054\u7ed3\u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528 [join](https://knexjs.org/guide/query-builder.html#join-methods) \u65b9\u6cd5\u3002`join`\u65b9\u6cd5\u7528\u4e8e\u5c06\u4e24\u4e2a\u6216\u591a\u4e2a\u8868\u683c\u8054\u7ed3\u5728\u4e00\u8d77\uff0c\u4ee5\u4fbf\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528\u5b83\u4eec\u7684\u5217\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a\\n\\n```js\\nknex(\'users\').join(\'accounts\', \'users.id\', \'=\', \'accounts.user_id\')\\n  .select(\'users.name\', \'accounts.balance\')\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528`join`\u65b9\u6cd5\u5c06users\u8868\u683c\u548corders\u8868\u683c\u8054\u7ed3\u5728\u4e00\u8d77\uff0c\u4ee5\u4fbf\u5728\u67e5\u8be2\u4e2d\u4f7f\u7528\u5b83\u4eec\u7684\u5217\u3002\u6211\u4eec\u4f7f\u7528select\u65b9\u6cd5\u9009\u62e9users.name\u548corders.order_number\u5217\u3002\u8fd9\u5c06\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u7528\u6237\u540d\u79f0\u548c\u8ba2\u5355\u53f7\u7684\u7ed3\u679c\u96c6\u3002\\n\\n\u5982\u679c\u60a8\u9700\u8981\u4f7f\u7528\u4e0d\u540c\u7c7b\u578b\u7684\u8054\u7ed3\uff08\u4e0d\u540c\u8054\u7ed3\u7c7b\u578b\u7684\u533a\u522b\u53c2\u8003[SQL Joins](https://www.w3schools.com/sql/sql_join.asp)\uff09\uff0c\u4f8b\u5982\u5de6\u8054\u7ed3\u6216\u53f3\u8054\u7ed3\uff0c\u5219\u53ef\u4ee5\u5728`join`\u65b9\u6cd5\u4e4b\u524d\u6dfb\u52a0`leftJoin`\u6216`rightJoin`\u65b9\u6cd5\uff1a\\n\\n```js\\nknex(\'users\')\\n  .leftJoin(\'orders\', \'users.id\', \'=\', \'orders.user_id\')\\n  .select(\'users.name\', \'orders.order_number\')\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528leftJoin\u65b9\u6cd5\u6267\u884c\u5de6\u8054\u7ed3\u3002\u8fd9\u5c06\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6240\u6709\u7528\u6237\u548c\u4ed6\u4eec\u7684\u8ba2\u5355\uff08\u5982\u679c\u6709\uff09\u7684\u7ed3\u679c\u96c6\u3002\\n\\n### \u4e8b\u52a1\u5904\u7406\\n\\n\u4f7f\u7528transaction\u65b9\u6cd5\u53ef\u4ee5\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u6267\u884c\u591a\u4e2a\u67e5\u8be2\uff0c\u5e76\u786e\u4fdd\u5b83\u4eec\u90fd\u6210\u529f\u6216\u90fd\u5931\u8d25\u3002\\n\\n```js\\nknex.transaction((trx) => {\\n  knex(\'users\').transacting(trx).insert({ name: \'John\', email: \'john@example.com\' })\\n    .then(() => {\\n      return knex(\'accounts\').transacting(trx).insert({ user_id: 1, balance: 100 });\\n    })\\n    .then(trx.commit)\\n    .catch(trx.rollback);\\n})\\n.then(() => {\\n  console.log(\'Transaction complete\');\\n})\\n.catch((err) => {\\n  console.error(err);\\n});\\n```\\n\\n\\n### Raw Query\\n\\n\u4f7f\u7528raw\u65b9\u6cd5\u53ef\u4ee5\u6267\u884c\u539f\u59cb\u7684SQL\u67e5\u8be2\u3002\\n\\n```js\\nknex.raw(\'SELECT * FROM users WHERE name = ?\', [\'John\'])\\n  .then((rows) => {\\n    console.log(rows);\\n  })\\n  .catch((err) => {\\n    console.error(err);\\n  });\\n```\\n\\n\\n\\n## \u603b\u7ed3"},{"id":"/2023/03/04/antd-create-modal","metadata":{"permalink":"/blog/2023/03/04/antd-create-modal","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2023/03-04-antd-create-modal/index.mdx","source":"@site/blog/2023/03-04-antd-create-modal/index.mdx","title":"Antd \u5f39\u7a97\u5c01\u88c5","description":"\u5728 Antd \u4e2d\u5f39\u7a97\u7684\u4f7f\u7528\u9891\u7387\u5f88\u9ad8\uff0c\u4e00\u4e2a\u597d\u7528\u7684\u5f39\u7a97\u6211\u8ba4\u4e3a\u5e94\u8be5\u5177\u5907\u51e0\u4e2a\u7279\u70b9\uff1a","date":"2023-03-04T00:00:00.000Z","formattedDate":"March 4, 2023","tags":[{"label":"Antd","permalink":"/blog/tags/antd"},{"label":"React","permalink":"/blog/tags/react"}],"readingTime":4.36,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Antd","React"],"keywords":["antd","antd modal","antd \u5f39\u7a97"]},"prevItem":{"title":"Knex.js \u6559\u7a0b","permalink":"/blog/2023/04/05/knex-tutorial"},"nextItem":{"title":"\u642d\u5efa\u535a\u5ba2\u7ad9\u70b9","permalink":"/blog/2023/03/04/how-to-setup-blog"}},"content":"\u5728 Antd \u4e2d\u5f39\u7a97\u7684\u4f7f\u7528\u9891\u7387\u5f88\u9ad8\uff0c\u4e00\u4e2a\u597d\u7528\u7684\u5f39\u7a97\u6211\u8ba4\u4e3a\u5e94\u8be5\u5177\u5907\u51e0\u4e2a\u7279\u70b9\uff1a\\n1. \u652f\u6301\u547d\u4ee4\u5f0f\u8c03\u7528\uff0c\u7c7b\u4f3c`window.alert()`\u8fd9\u79cd\u65b9\u5f0f\uff08\u65e0\u9700\u5173\u6ce8\u5f39\u7a97\u7684\u58f0\u660e\u4f4d\u7f6e\uff09\\n2. \u80fd\u591f\u4e0e\u5f39\u7a97\u8fdb\u884c\u4ea4\u4e92\uff0c\u5373\u63d0\u4f9b\u53c2\u6570\u63a7\u5236\u5f39\u7a97\u7684\u6e32\u67d3\uff0c\u540c\u65f6\u5f39\u7a97\u5173\u95ed\u65f6\u80fd\u4ece\u4e2d\u83b7\u53d6\u6240\u9700\u6570\u636e\uff08\u8fd9\u4e2a\u5728\u8868\u5355\u573a\u666f\u5e38\u89c1\uff09\\n3. \u5f39\u7a97\u7684\u72b6\u6001\u4e0e\u5176\u6240\u5728\u7ec4\u4ef6\u6811\u9694\u79bb\uff08\u907f\u514d\u72b6\u6001\u6c61\u67d3\uff09\\n\\nAntd \u63d0\u4f9b\u7684 [Modal.method()](<https://4x.ant.design/components/modal-cn/#Modal.method()>) \u5f88\u597d\u7684\u5904\u7406\u4e86\u7b2c 1 \u548c 3 \u4e2a\u95ee\u9898\uff0c\u4f7f\u7528\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u4e00\u884c\u4ee3\u7801\u5373\u53ef\u3002\\n\\n```jsx\\nModal.confirm({\\n    title: \'\u786e\u8ba4\uff1f\',\\n    content: <MyModalContent>,\\n    onOk () {\\n        // do something\\n    }\\n})\\n```\\n\\n\u4f46\u662f`Modal.method()`\u5e76\u672a\u89e3\u51b3\u7b2c 2 \u4e2a\u95ee\u9898\uff0c\u5176\u5185\u5bb9\u5c55\u793a\u540e\u5c31\u4e0e\u5f53\u524d\u4e0a\u4e0b\u6587\u8131\u79bb\u8054\u7cfb\u4e86\uff0c\u4e3a\u4e86\u5b9e\u73b0\u6240\u671f\u671b\u7684\u5f39\u7a97\uff0c\u4e0b\u9762\u6211\u5c1d\u8bd5\u4e86\u51e0\u79cd\u5c01\u88c5\u65b9\u5f0f\uff0c\u8bd5\u56fe\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u7b2c\u4e00\u7248\\n\\n\u4e0b\u9762\u662f\u6211\u5c01\u88c5\u7684\u7b2c\u4e00\u7248\u5f39\u7a97\uff0c\u5f39\u7a97\u901a\u8fc7\u66b4\u9732 ref \u5f15\u7528\uff0c\u8ba9\u5916\u90e8\u63a7\u5236\u5f39\u7a97\u7684\u663e\u793a\uff0c\u4ee5\u53ca\u4f20\u9012\u6570\u636e\u7ed9\u5f39\u7a97\u5bb9\uff0c\u901a\u8fc7\u56de\u8c03\u51fd\u6570\u5c06\u5f39\u7a97\u5185\u90e8\u7684\u5904\u7406\u7ed3\u679c\u4f20\u9012\u7ed9\u5916\u90e8\u3002\\n\\nimport Demo1 from \'./demo1\';\\n\\n<Demo1/>\\n\\n## \u7b2c\u4e8c\u7248\\n\\n\u57fa\u4e8e\u4e0a\u9762\u5f39\u7a97\u7684\u5c01\u88c5\u6a21\u5f0f\uff0c\u6839\u636e\u9700\u8981\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u57fa\u672c\u80fd\u6ee1\u8db3\u5927\u90e8\u5206\u5f39\u7a97\u4f7f\u7528\u573a\u666f\u4e86\u3002\u4f46\u662f\u4e0a\u9762\u5c01\u88c5\u65b9\u5f0f\u6709\u4e0d\u5c11\u6837\u677f\u4ee3\u7801\uff0c\u6bcf\u6b21\u5199\u4e2a\u5f39\u7a97\u6709\u4e0d\u5c11\u91cd\u590d\u5de5\u4f5c\uff0c\u4e8e\u662f\u5c06\u5bf9\u5f39\u7a97\u7684\u5c01\u88c5\u6a21\u5f0f\u5265\u79bb\u51fa\u6765\u5f62\u6210\u4e00\u4e2a\u72ec\u7acb\u7684\u51fd\u6570`createModal`\uff0c\u8fd9\u6837\u53ef\u4ee5\u5927\u5927\u51cf\u5c11\u6837\u677f\u4ee3\u7801\uff0c\u805a\u7126\u4e8e\u7f16\u5199\u5f39\u7a97\u7684\u5185\u5bb9\u548c\u4ea4\u4e92\u903b\u8f91\u3002\\n\\n\\nimport CodeBlock from \'@theme/CodeBlock\';\\nimport createModal_ from \'!!raw-loader!./createModal\';\\n\\n<CodeBlock language=\\"tsx\\">{createModal_}</CodeBlock>\\n\\n\u4e0b\u9762\u662f\u57fa\u4e8e `createModal` \u521b\u5efa\u5f39\u7a97\u7684\u793a\u4f8b\uff0c\u53ef\u4ee5\u770b\u5230\u5f39\u7a97\u7684\u6e90\u7801\u5df2\u7ecf\u51cf\u5c11\u5230\u4e00\u884c\u4ee3\u7801\u4e86\uff0c\u5199\u5f39\u7a97\u65f6\u53ea\u9700\u8981\u5173\u6ce8\u4e8e\u5f39\u7a97\u7684\u5185\u5bb9\u533a\u57df\uff0c\u4f7f\u7528\u5f39\u7a97\u65f6\u4e5f\u65e0\u9700\u521b\u5efa ref \u6765\u5f15\u7528\u5f39\u7a97\uff0c\u800c\u662f\u901a\u8fc7\u5f39\u7a97\u4e0a\u66b4\u9732\u7684\u9759\u6001\u65b9\u6cd5`MyModal.show()`\u663e\u793a\u5f39\u7a97\u548c\u4f20\u53c2\u3002\\n\\nimport Demo2 from \'./demo2\';\\n\\n<Demo2/>\\n\\n\u7ecf\u8fc7`createModal`\u5c01\u88c5\u540e\uff0c\u4e1a\u52a1\u5c42\u53ea\u9700\u5173\u6ce8\u5f39\u7a97\u7684\u5185\u5bb9\uff08\u5373`<Modal>`\u7684\u5b50\u7ec4\u4ef6\uff09\uff0c\u65e0\u9700\u5904\u7406\u5f39\u7a97\u4e0e\u5185\u5bb9\u7684\u4ea4\u4e92\u3002 \u90a3\u4f7f\u7528\u65f6\u5982\u4f55\u63a7\u5236\u5f39\u7a97\u7684\u4ea4\u4e92\u5462\uff1f\u4f8b\u5982\u70b9\u51fb\u786e\u8ba4\u65f6\u83b7\u53d6\u5f39\u7a97\u4e2d\u7684\u8868\u5355\u5185\u5bb9\u3001\u70b9\u51fb\u786e\u8ba4\u65f6\u5f39\u7a97\u6309\u94ae\u663e\u793a loading \u6548\u679c\u7b49\u3002\\n\\n\u7b54\u6848\u662f\u901a\u8fc7\u5f39\u7a97\u66b4\u9732\u7684\u9759\u6001\u65b9\u6cd5`MyModal.show()`\u5b9e\u73b0\uff0c\u8bf7\u770b\u4e0b\u9762\u4f8b\u5b50\uff0c\u901a\u8fc7 `state/setState`\u53ef\u4ee5\u5728\u5f39\u7a97\u7ec4\u4ef6\u5185\u90e8\u5b58\u50a8\u72b6\u6001\uff0c\u901a\u8fc7 ref \u53ef\u4ee5\u8c03\u7528\u5f39\u7a97\u5185\u5bb9\u7ec4\u4ef6\u66b4\u9732\u7684\u65b9\u6cd5\u3002\\n\\nimport Demo3 from \'./demo3\';\\n\\n<Demo3/>\\n\\n## \u7b2c\u4e09\u7248\\n\\n\u5076\u7136\u6d4f\u89c8\u77e5\u4e4e\u770b\u5230[\u8fd9\u7bc7\u6587\u7ae0](https://zhuanlan.zhihu.com/p/552965494)\uff0c\u624d\u5f97\u77e5\u5df2\u7ecf\u6709\u4eba\u505a\u4e86\u7c7b\u4f3c\u7684\u5de5\u4f5c\uff0c\u5e76\u4e14\u5f00\u6e90\u4e86\u53eb [nice-modal-react](https://github.com/eBay/nice-modal-react)\uff0c\u5176\u539f\u7406\u662f\u63d0\u4f9b\u5168\u5c40\u7684`<Provider>`\u6765\u5b58\u50a8\u548c\u6e32\u67d3\u5168\u5c40\u5f39\u7a97\uff0c\u901a\u8fc7\u5176\u63d0\u4f9b\u7684 `create()`\u65b9\u6cd5\u521b\u5efa\u7684\u5f39\u7a97\u540e\uff0c\u5373\u53ef\u901a\u8fc7`show()/hide()`\u65b9\u6cd5\u547d\u4ee4\u5f0f\u4f7f\u7528\u5f39\u7a97\uff0c\u5f39\u7a97\u7684\u5185\u90e8\u72b6\u6001\u4e0e\u5916\u90e8\u7ec4\u4ef6\u9694\u79bb\uff0c\u5b8c\u5168\u6ee1\u8db3\u4e86\u6587\u7ae0\u5f00\u5934\u63d0\u5230\u7684\u51e0\u4e2a\u7279\u70b9\u3002\\n\\n\u4e0b\u9762\u662f\u57fa\u4e8e nice-modal-react \u5e93\u91cd\u5199\u7684\u4e0a\u9762\u4f8b\u5b50\\n\\nimport Demo4 from \'./demo4\';\\n\\n<Demo4 />\\n\\n## \u5c0f\u7ed3\\n\\nAntd \u7684\u5f39\u7a97\u529f\u80fd\u5f88\u591a\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u8fd8\u662f\u9700\u8981\u505a\u4e0d\u5c11\u5de5\u4f5c\uff0c\u901a\u8fc7\u5c01\u88c5 Antd \u7684\u5f39\u7a97\uff0c\u5927\u5927\u7b80\u5316\u4e86\u5f39\u7a97\u7684\u5904\u7406\u903b\u8f91\uff0c\u8ba9\u4e1a\u52a1\u5c42\u4e13\u6ce8\u4e8e\u5f39\u7a97\u7684\u5185\u5bb9\u903b\u8f91\u3002"},{"id":"/2023/03/04/how-to-setup-blog","metadata":{"permalink":"/blog/2023/03/04/how-to-setup-blog","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2023/03-04-how-to-setup-blog/index.md","source":"@site/blog/2023/03-04-how-to-setup-blog/index.md","title":"\u642d\u5efa\u535a\u5ba2\u7ad9\u70b9","description":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u4e2a\u4eba\u7ad9\u70b9 whinc.github.io \u7684\u642d\u5efa\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u540e\u7eed\u7684\u7ef4\u62a4\u66f4\u65b0\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e2a\u4eba\u7ad9\u70b9\u81ea\u8eab\u7684\u4e00\u4efd changelog","date":"2023-03-04T00:00:00.000Z","formattedDate":"March 4, 2023","tags":[{"label":"Other","permalink":"/blog/tags/other"}],"readingTime":1.98,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Other"],"keywords":["blog","\u535a\u5ba2","\u535a\u5ba2\u642d\u5efa","Docusaurus"]},"prevItem":{"title":"Antd \u5f39\u7a97\u5c01\u88c5","permalink":"/blog/2023/03/04/antd-create-modal"},"nextItem":{"title":"\u81ea\u5b9a\u4e49 hooks - useHash","permalink":"/blog/2020/11/25/usehash"}},"content":"\u672c\u6587\u4e3b\u8981\u8bb0\u5f55\u4e2a\u4eba\u7ad9\u70b9 [whinc.github.io](https://whinc.github.io/) \u7684\u642d\u5efa\u8fc7\u7a0b\uff0c\u4ee5\u53ca\u540e\u7eed\u7684\u7ef4\u62a4\u66f4\u65b0\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u4e2a\u4eba\u7ad9\u70b9\u81ea\u8eab\u7684\u4e00\u4efd changelog\\n\\n\u7ad9\u70b9\u57fa\u4e8e [Docusaurus](https://docusaurus.io/) \u642d\u5efa\uff0c\u5176\u63d0\u4f9b\u4e86\u535a\u5ba2\u3001\u6587\u6863(MDX)\u3001React \u5355\u5355\u9875\u5e94\u7528\u591a\u79cd\u6a21\u5f0f\u6784\u5efa\u7ad9\u70b9\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206\u7684\u4e2a\u4eba\u5b9a\u5236\u5316\u7684\u9700\u6c42\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u6dfb\u52a0\u6587\u7ae0\u8bc4\u8bba - Giscus\\n\\n[giscus](https://github.com/giscus/giscus) \u662f\u4e00\u4e2a\u57fa\u4e8e Github \u7684\u5f00\u6e90\u514d\u8d39\u7684\u8bc4\u8bba\u7cfb\u7edf\uff0c\u5176\u539f\u7406\u662f\u57fa\u4e8e github \u7684 discussion \u529f\u80fd\u6765\u5b9e\u73b0\u8bc4\u8bba\u7684\u5b58\u50a8\u3002\\n\\n\u63a5\u5165\u6b65\u9aa4\uff1a\u53c2\u8003 [How to add Giscus comments to Docusaurus](https://m19v.github.io/blog/how-to-add-giscus-to-docusaurus)\uff0c\u53c2\u8003\u6587\u6863[giscus \u914d\u7f6e\u9875](https://giscus.app/zh-CN) \u548c [giscus-component](https://github.com/giscus/giscus-component)\\n\\n\\n## \u6dfb\u52a0 MDX \u4e92\u52a8\u4ee3\u7801 - RunKit\\n\\n[RunKit](https://runkit.com/home) \u63d0\u4f9b\u8fd0\u884c\u5728\u7f51\u9875\u4e2d\u5d4c\u5165 Node.js \u4ee3\u7801\u7247\u6bb5\uff0c\u5e76\u6267\u884c\u663e\u793a\u8f93\u51fa\u7684\u80fd\u529b\uff0c\u9002\u5408\u4ea4\u4e92\u5f0f\u6f14\u793a\u4ee3\u7801\u7247\u6bb5\u3002\\n\\n\\n\\n\u63a5\u5165\u6b65\u9aa4\uff1a\\n\\n1. \u5c01\u88c5 RunKitEmbed \u7ec4\u4ef6\uff1a[RunKit Embed](https://runkit.com/docs/embed) \u6587\u6863\u63d0\u4f9b\u4e86\u539f\u751f JS \u5d4c\u5165 RunKit \u7684\u65b9\u6cd5\uff0c\u4e5f\u63d0\u4f9b\u4e86 WebComponent \u548c React \u7684\u5c01\u88c5\uff0c\u4e0d\u8fc7 React \u7684\u5c01\u88c5\u7248\u672c\u592a\u65e7\u4e86(react 16)\uff0c\u4e8e\u662f\u81ea\u884c\u5c01\u88c5\u4e86\u4e00\u4e2a React hooks \u7ec4\u4ef6\uff08\u5982\u4e0b\uff09\uff0c\u53ef\u5728 MDX \u4e2d\u76f4\u63a5\u4f7f\u7528\u3002\\n\\nimport CodeBlock from \'@theme/CodeBlock\';\\nimport RunKitEmbed_ from \'!!raw-loader!@site/src/components/RunKitEmbed\';\\n\\n<CodeBlock language=\\"tsx\\">{RunKitEmbed_}</CodeBlock>\\n\\n2. \u5728 MDX \u4e2d\u5d4c\u5165 RunKit\uff1a\u5f15\u5165\u4e0a\u9762\u5c01\u88c5\u7684 RunKitEmbed \u7ec4\u4ef6\uff0c\u4f20\u5165 source \u6e90\u7801\u5373\u53ef\uff0c\u5982\u679c\u60f3\u5bf9 RunKit \u505a\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\uff0c\u53c2\u8003\u4e0a\u9762\u7684 RunKit Embed \u6587\u6863\\n\\n```jsx\\nimport RunKitEmbed from \'@site/src/components/RunKitEmbed\';\\n\\n<RunKitEmbed source={`\\n    const knex = require(\'knex\');\\n    const db = knex({client: \'mysql\'});\\n    await db.table(\'aa\').select(\'b\', \'c\').toSQL().toNative()\\n`} />\\n```\\n\\n## \u6dfb\u52a0 MD/MDX \u56fe\u8868 - Mermaid\\n\\n[mermaid](https://github.com/mermaid-js/mermaid) \u662f\u57fa\u4e8e javascript \u7684\u7eaf\u6587\u672c\u56fe\u6e32\u67d3\u5e93\uff0c\u5e38\u7528\u4e8e\u6269\u5c55 Markdown \u7684\u56fe\u8868\u8fbe\u80fd\u529b\uff0c\u652f\u6301 Sequence/Flow/Class/State/Git/Mindmap\u7b49\u591a\u79cd\u56fe\u3002\\n\\n\u63a5\u5165\u65b9\u5f0f\uff1a\u53c2\u8003 [docusaurus diagrams](https://docusaurus.io/docs/2.3.1/markdown-features/diagrams)"},{"id":"/2020/11/25/usehash","metadata":{"permalink":"/blog/2020/11/25/usehash","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2020/11-25-usehash.md","source":"@site/blog/2020/11-25-usehash.md","title":"\u81ea\u5b9a\u4e49 hooks - useHash","description":"\u52a8\u673a & \u76ee\u6807","date":"2020-11-25T00:00:00.000Z","formattedDate":"November 25, 2020","tags":[{"label":"React","permalink":"/blog/tags/react"},{"label":"React Hooks","permalink":"/blog/tags/react-hooks"}],"readingTime":10.52,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["React","React Hooks"]},"prevItem":{"title":"\u642d\u5efa\u535a\u5ba2\u7ad9\u70b9","permalink":"/blog/2023/03/04/how-to-setup-blog"},"nextItem":{"title":"glob \u6a21\u5f0f\u5339\u914d\u6559\u7a0b","permalink":"/blog/2020/02/24/glob"}},"content":"## \u52a8\u673a & \u76ee\u6807\\n\\n\u5728\u57fa\u4e8e hash \u6a21\u5f0f\u7684 web \u5355\u9875\u5e94\u7528\u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u8bfb\u5199 hash \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\uff0c\u4f8b\u5982\u4ece hash \u67e5\u8be2\u53c2\u6570\u4e2d\u8bfb\u53d6\u5546\u54c1 ID\u3002\u5728 React \u5e94\u7528\u4e2d\uff0c\u5982\u679c\u76f4\u63a5\u89e3\u6790`window.location.hash`\u503c\uff0c\u5219 hash \u53d8\u5316\u65f6\u65e0\u6cd5\u6536\u5230\u66f4\u65b0\uff0c\u4f60\u8fd8\u9700\u8981\u76d1\u542c`hashchange`\u4e8b\u4ef6\u6765\u66f4\u65b0\u5185\u90e8\u72b6\u6001\uff0c\u8fd9\u4e9b\u7e41\u7410\u7684\u6b65\u9aa4\u53ef\u4ee5\u5c01\u88c5\u6210\u81ea\u5b9a\u4e49 hooks\uff0c\u540c\u65f6\u66f4\u8fdb\u4e00\u6b65\u7ed9\u53c2\u6570\u52a0\u4e0a\u81ea\u52a8\u7c7b\u578b\u89e3\u6790\u548c\u5e8f\u5217\u5316\uff0c\u4f7f\u5176\u652f\u6301\u4efb\u610f\u53c2\u6570\u503c\u7c7b\u578b\uff08\u5305\u62ec\u5d4c\u5957\u7684 JSON \u5bf9\u8c61\uff09\uff0c\u5168\u90e8\u8fd9\u4e9b\u529f\u80fd\u4ec5\u9700\u8981\u4e00\u4e2a\u7b80\u5355\u7684 hook \u5373\u53ef\u5b9e\u73b0\u3002\\n\\n\x3c!-- truncate --\x3e\\n\\n\u4e0b\u9762\u662f\u6700\u7ec8\u5b9e\u73b0\u7684 hook \u6548\u679c\uff0c\u901a\u8fc7`useHashSearchParamsJSON` hook \u8bfb\u5199\u6307\u5b9a\u7684\u67e5\u8be2\u53c2\u6570\uff0c\u5e76\u4e14\u81ea\u52a8\u89e3\u6790\u51fa\u6b63\u786e\u7684\u7c7b\u578b\u3002\\n\\n```js\\n// http://a/b/c#/a/b/c?id=1&name=\\"jim\\"\\n\\n// \u83b7\u53d6\u6307\u5b9a\u7684\u67e5\u8be2\u53c2\u6570\u503c\\nconst [id, setId] = useHashSearchParamsJSON(\\"id\\");\\nconsole.log(id); // 1\\n\\n// \u83b7\u53d6\u5168\u90e8\u67e5\u8be2\u53c2\u6570\\nconst [params, setParams] = useHashSearchParamsJSON();\\nconsole.log(params); // {id: 1, name: \\"jim\\"}\\n\\n// \u66f4\u65b0\u53c2\u6570\\nsetParams({ ...params, id: 2 });\\n// http://a/b/c#/a/b/c?id=2&name=\\"jim\\"\\n```\\n\\n\u4e0a\u9762\u7684 hook \u5e76\u975e\u4e00\u6b65\u5230\u4f4d\u5b9e\u73b0\u7684\uff0c\u800c\u662f\u5206\u4e3a\u4e09\u4e2a\u4e0d\u540c\u7c92\u5ea6\u7684 hook\uff0c\u5206\u522b\u662f`useHash`(\u8bfb\u5199 hash \u4e32)\u3001`useHashSearchParams`(\u8bfb\u5199\u67e5\u8be2\u53c2\u6570)\u548c`userHashSearchParamsJSON`(\u8bfb\u5199\u5e26\u7c7b\u578b\u7684\u67e5\u8be2\u53c2\u6570)\uff0c\u4e0b\u9762\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u9010\u6b65\u5b9e\u73b0\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u7684 hooks\uff0c\u4ece\u4e2d\u4f60\u9664\u4e86\u53ef\u4ee5\u5c06\u8fd9\u4e9b\u81ea\u5b9a\u4e49 hooks \u7528\u5230\u81ea\u5df1\u7684\u9879\u76ee\u4e2d\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u5b66\u4e60\u5230\u5982\u4f55\u5c01\u88c5\u81ea\u5df1\u7684 hooks \u4ee5\u4fbf\u63d0\u53d6\u53ef\u590d\u7528\u7684\u903b\u8f91\u3002\\n\\n## `useHash` - \u8bfb\u5199 hash \u503c\\n\\n\u8def\u7531\u53c2\u6570\u5305\u542b\u5728 URL \u7684 hash \u503c\u4e2d\uff0c\u5b9e\u73b0\u8bfb\u5199\u8def\u7531\u53c2\u6570\u7684\u57fa\u7840\u662f\u5148\u5b9e\u73b0\u8bfb\u5199 hash \u503c\uff0chooks \u539f\u578b\u5982\u4e0b\uff1a\\n\\n```js\\n// hash: string - hash \u4e32\\n// setHash: (hash: string) => void - \u66f4\u65b0 hash \u4e32\\nconst [hash, setHash] = useHash();\\n```\\n\\n\u5b83\u8fd4\u56de\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u5f53\u524d URL \u4e2d\u7684 hash \u4e32\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f hash \u4e32\u7684\u66f4\u65b0\u51fd\u6570\uff0c\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```js\\n// http://www.abc.com/#/path/to/page?id=1\\n\\nconst [hash, setHash] = useHash();\\nconsole.log(hash); // \\"#/path/to/page?id=1\\"\\n\\nsetHash(\\"#/path/to/page?id=2\\");\\nconsole.log(hash); // \\"#/path/to/page?id=2\\"\\n```\\n\\n\u57fa\u4e8e\u4ee5\u4e0a\u7684\u671f\u671b\u884c\u4e3a\uff0c\u5b9e\u73b0`useHash`\u7684\u4ee3\u7801\u5982\u4e0b\uff0c\u5176\u5173\u952e\u70b9\u5728\u4e8e\u81ea\u52a8\u76d1\u542c\u4e86`hashchange`\u4e8b\u4ef6\uff0c\u7701\u53bb\u4e86\u9700\u8981\u4f7f\u7528\u8005\u91cd\u590d\u7f16\u5199\u7684\u4ee3\u7801\uff08\u53ea\u6709\u5207\u5b9e\u7684\u51cf\u5c11\u5de5\u4f5c\u91cf\u548c\u9519\u8bef\uff0c\u4f60\u5c01\u88c5\u7684 hook \u624d\u53ef\u80fd\u4f1a\u6709\u88ab\u5176\u4ed6\u4eba\u4f7f\u7528\u7684\u6b32\u671b\uff09\uff1a\\n\\n```ts\\nimport { useState, useCallback, useEffect } from \\"react\\";\\n\\n/**\\n * \u8bfb\u5199 URL hash \u4e32\uff0c\u5e76\u81ea\u52a8\u54cd\u5e94 URL hash \u4e32\u7684\u53d8\u5316\\n */\\nexport const useHash = () => {\\n  const [hash, setHash] = useState(() => window.location.hash);\\n\\n  const onHashChange = useCallback(() => {\\n    setHash(window.location.hash);\\n  }, []);\\n\\n  // \u76d1\u542c hash \u4e32\u7684\u53d8\u5316\\n  useEffect(() => {\\n    window.addEventListener(\\"hashchange\\", onHashChange);\\n    return () => {\\n      window.removeEventListener(\\"hashchange\\", onHashChange);\\n    };\\n  }, []);\\n\\n  const _setHash = useCallback(\\n    (newHash: string) => {\\n      if (newHash !== hash) {\\n        window.location.hash = newHash;\\n      }\\n    },\\n    [hash]\\n  );\\n\\n  return [hash, _setHash] as const;\\n};\\n```\\n\\n> `useHash`\u7684\u5b9e\u73b0\u5408\u5165\u5230 [react-use](https://github.com/streamich/react-use/blob/master/docs/useHash.md) \u4ed3\u5e93\uff0c\u53ef\u4ee5\u5f15\u5165 react-use \u5305\u76f4\u63a5\u4f7f\u7528\u3002\\n\\n## `useHashSearchParams` - \u8bfb\u5199 hash \u7684\u67e5\u8be2\u53c2\u6570\\n\\n\u6709\u4e86`useHash`\u6211\u4eec\u53ef\u4ee5\u65b9\u4fbf\u7684\u8bfb\u5199 URL hash \u503c\u4e86\uff0c\u63a5\u4e0b\u6765\u8981\u5b9e\u73b0\u8bfb\u5199 hash \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\uff0c\u67e5\u8be2\u53c2\u6570\u683c\u5f0f\u662f`key1=value1&key2=value2&...`\uff0c\u5176\u6838\u5fc3\u662f\u89e3\u6790\u67e5\u8be2\u53c2\u6570\u4e2d\u7684\u952e\u503c\u5bf9\u3002\\n\\nhooks \u7684\u539f\u578b\u5982\u4e0b\uff1a\\n\\n```js\\n// value: string - \u6307\u5b9a key \u7684\u503c\\n// setValue: (value: string) => void - \u66f4\u65b0\u6307\u5b9a key \u7684\u503c\\nconst [value, setValue] = useHashSearchParams(key);\\n\\n// query: Record<string, string> - \u6240\u6709\u67e5\u8be2\u53c2\u6570\\n// setQuery: (query: Record<string, string>) => void - \u66f4\u65b0\u67e5\u8be2\u53c2\u6570\\nconst [query, setQuery] = useHashSearchParams();\\n```\\n\\n\u5b83\u8fd4\u56de\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u53c2\u6570\u8868\u793a\u6307\u5b9a\u7684 key \u7684\u503c\uff08\u6216\u8005\u6240\u6709 key/value \u7ec4\u6210\u7684\u5bf9\u8c61\uff09\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u7528\u4e8e\u66f4\u65b0\u6307\u5b9a\u7684 key \u7684\u503c\uff08\u6216\u8005\u66f4\u65b0\u6574\u4e2a\u67e5\u8be2\u53c2\u6570\uff09\u3002\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```js\\n// http://a/b/c#/a/b/c?id=1&name=jim\\n\\n// \u8bfb\u53d6\u5355\u4e2a\u67e5\u8be2\u53c2\u6570\\nconst [id, setId] = useHashSearchParams(\\"id\\");\\nconsole.log(id); // \\"1\\"\\n// \u4fee\u6539\u5355\u4e2a\u67e5\u8be2\u53c2\u6570\\nsetId(2);\\nconsole.log(id); // \\"2\\"\\n\\n// \u8bfb\u53d6\u6240\u6709\u67e5\u8be2\u53c2\u6570\\nconst [params, setParams] = useHashSearchParams();\\nconsole.log(params); // {id: \\"1\\", name: \\"jim\\"}\\n// \u4fee\u6539\u6574\u4e2a\u67e5\u8be2\u53c2\u6570\\nsetParams({ name: \\"jack\\" });\\nconsole.log(params); // {id: \\"1\\", name: \\"jack\\"}\\n```\\n\\n\u5b9e\u73b0\u601d\u8def\uff1a\u8bfb\u53d6\u65f6\u8c03\u7528`useHash`\u83b7\u53d6 URL hash \u503c\uff0c\u7136\u540e\u622a\u53d6 hash \u4e2d\u7684\u67e5\u8be2\u4e32\uff0c\u5e76\u4f7f\u7528`URLSearchParams`\u89e3\u6790\u6210\u952e\u503c\u5bf9\u8fd4\u56de\u3002\u5199\u5165\u65f6\u4fee\u6539\u952e\u503c\u5bf9\uff0c\u7136\u540e\u62fc\u63a5\u6210\u67e5\u8be2\u4e32\uff0c\u8c03\u7528`setHash`\u5199\u56de URL hash \u503c\u3002\u8fd9\u91cc\u5173\u952e\u70b9\u662f\u6ce8\u610f\u67e5\u8be2\u53c2\u6570\u7684 key/value \u7f16\u7801\u548c\u89e3\u7801\uff0c\u4f7f\u7528`URLSearchParams`\u89e3\u6790 hash \u4e32\u65f6\uff0c\u5b83\u4f1a\u5e2e\u6211\u4eec\u89e3\u7801\uff0c\u5c06\u67e5\u8be2\u53c2\u6570\u5e8f\u5217\u5316\u6210 hash \u4e32\u65f6\uff0c\u6211\u4eec\u9700\u8981\u81ea\u884c\u8fdb\u884c\u7f16\u7801\u3002\u6b64\u5916\uff0c\u8981\u6ce8\u610f\u533a\u5206\u8bfb\u5199\u7684\u662f\u5355\u4e2a\u8fd8\u662f\u6240\u6709\u7684\u67e5\u8be2\u53c2\u6570\u3002\\n\\n\u6700\u7ec8\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a\\n\\n```ts\\nimport { useHash } from \\"./useHash\\";\\nimport { useCallback } from \\"react\\";\\n\\n// \u91cd\u8f7d\u51fd\u6570\u7b7e\u540d\\ninterface UseHashSearchParamsType {\\n  (key: string, defaultValue?: string): readonly [string, (value: any) => void];\\n  (): readonly [\\n    Record<string, string>,\\n    (searchParams: Record<string, any>) => void\\n  ];\\n}\\n\\nexport const useHashSearchParams: UseHashSearchParamsType = (\\n  key?: any,\\n  defaultValue?: any\\n): any => {\\n  const [hash, setHash] = useHash();\\n  const questionIndex = hash.indexOf(\\"?\\");\\n  const search = questionIndex !== -1 ? hash.substring(questionIndex) : \\"\\";\\n  // \u89e3\u6790\u67e5\u8be2\u53c2\u6570\\n  const usp = new URLSearchParams(search);\\n\\n  const hashSearchParams: Record<string, string> = {};\\n  usp.forEach((value, key) => {\\n    hashSearchParams[key] = value;\\n  });\\n\\n  const setHashSearchParams = useCallback(\\n    (searchParams: Record<string, any>) => {\\n      const searchPrefix =\\n        (questionIndex !== -1 ? hash.slice(0, questionIndex) : hash.slice(0)) +\\n        \\"?\\";\\n      // \u62fc\u63a5\u67e5\u8be2\u53c2\u6570\uff0c\u5e76\u8fdb\u884c\u7f16\u7801\u5904\u7406\\n      const search = Object.keys(searchParams).reduce((finalSearch, key) => {\\n        if (finalSearch) finalSearch += \\"&\\";\\n        const value = String(searchParams[key]);\\n        finalSearch += encodeURIComponent(key);\\n        // remove \'=\' if param with empty value\\n        if (value) {\\n          finalSearch += \\"=\\" + encodeURIComponent(value);\\n        }\\n        return finalSearch;\\n      }, \\"\\");\\n      setHash(searchPrefix + search);\\n    },\\n    [hash, questionIndex, setHash]\\n  );\\n\\n  if (key) {\\n    return [\\n      hashSearchParams[key] === undefined\\n        ? defaultValue\\n        : hashSearchParams[key],\\n      (value: any) =>\\n        setHashSearchParams({ ...hashSearchParams, [key]: String(value) }),\\n    ];\\n  } else {\\n    return [hashSearchParams, setHashSearchParams];\\n  }\\n};\\n```\\n\\n> `useHashSearchParams`\u5df2\u63d0\u4ea4 PR \u5230 [react-use](https://github.com/streamich/react-use/pull/1300) \u4ed3\u5e93\uff0c\u5f85\u5408\u5165\u540e\uff0c\u53ef\u5f15\u5165 react-use \u5305\u4f7f\u7528\\n\\n## `useHashSearchParamsJSON` - \u6309 JSON \u683c\u5f0f\u8bfb\u5199 hash \u7684\u67e5\u8be2\u53c2\u6570\\n\\n\u57fa\u4e8e`useHashSearchParams`\u5df2\u7ecf\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9e\u73b0\u5bf9 URL hash \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\u8fdb\u884c\u8bfb\u5199\u4e86\uff0c\u4f46\u662f\u8fd9\u91cc\u7684\u53c2\u6570\u503c\u90fd\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u5b9e\u9645\u4f7f\u7528\u65f6\u7ecf\u5e38\u8fd8\u9700\u8981\u6839\u636e\u5b57\u6bb5\u6240\u5c5e\u7c7b\u578b\u8fdb\u884c\u7c7b\u578b\u89e3\u6790\uff0c\u4f8b\u5982`http://a/b/c#/a/b/c?id=1&name=jim`\u4e2d\u7684 id \u662f\u6570\u503c\u7c7b\u578b\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u5148\u8c03\u7528`parseInt`\u89e3\u6790\u6210\u6570\u5b57\uff0c\u5bf9\u4e8e\u5b9e\u9645\u4e1a\u52a1\u5f00\u53d1\u975e\u5e38\u4e0d\u4fbf\u3002\\n\\n\u6211\u671f\u671b\u8def\u7531\u53c2\u6570\u80fd\u81ea\u5305\u542b\u6570\u636e\u7c7b\u578b\uff0c\u540c\u65f6\u53c8\u80fd\u5e8f\u5217\u5316\u6210\u5b57\u7b26\u4e32\uff0c\u6700\u4f73\u7684\u6570\u636e\u683c\u5f0f\u5c31\u662f JSON \u683c\u5f0f\u4e86\u3002\u5c06\u67e5\u8be2\u53c2\u6570\u5e8f\u5217\u5316\u4e3a JSON \u540e\u4f5c\u4e3a hash \u4e32\uff0c\u4f7f\u7528\u65f6\u89e3\u6790 JSON \u5f97\u5230\u6b63\u786e\u7684\u6570\u636e\u7c7b\u578b\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u652f\u6301\u5728 hash \u4e2d\u5b58\u653e\u590d\u6742\u7684 JSON \u5bf9\u8c61\uff0c\u4ece\u800c\u652f\u6301\u9875\u9762\u95f4\u8df3\u8f6c\u65f6\u4f20\u9012 JavaScript \u7eaf\u5bf9\u8c61\u3002\\n\\nhooks \u539f\u578b\u5982\u4e0b\uff1a\\n\\n```js\\n// value: any - \u6307\u5b9a key \u7684\u503c\uff0c\u4efb\u610f\u7c7b\u578b\\n// setValue: (value: any) => void - \u66f4\u65b0\u6307\u5b9a key \u7684\u503c\\nconst [value, setValue] = useHashSearchParamsJSON(key);\\n\\n// query: Record<string, any> - \u6240\u6709\u67e5\u8be2\u53c2\u6570\uff0c\u5176\u4e2d\u503c\u53ef\u4ee5\u662f\u4efb\u610f\u7c7b\u578b\\n// setQuery: (query: Record<string, any>) => void - \u66f4\u65b0\u67e5\u8be2\u53c2\u6570\\nconst [query, setQuery] = useHashSearchParamsJSON();\\n```\\n\\n\u4f7f\u7528\u793a\u4f8b\u5982\u4e0b\uff1a\\n\\n```ts\\n// http://a/b/c#/a/b/c?id=1&name=\\"jim\\"\\n\\nconst [id, setId] = useHashSearchParamsJSON<number>(\\"id\\");\\nconsole.log(id); // 1\\n\\nconst [name, setName] = useHashSearchParamsJSON<string>(\\"name\\");\\nconsole.log(name); // \\"jim\\"\\n\\nconst [params, setParams] = useHashSearchParamsJSON();\\nconsole.log(params); // {id: 1, name: \\"jim\\"}\\nsetParams({ empty: true });\\nconsole.log(params); // {id: 1, name: \\"jim\\", empty: true}\\n```\\n\\n\u5b9e\u73b0\u601d\u8def\uff1a\u8bfb\u53d6\u65f6\u5148\u901a\u8fc7`useHashSearchParams`\u83b7\u53d6\u67e5\u8be2\u53c2\u6570\u503c\u7684\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u7136\u540e\u901a\u8fc7`JSON.parse`\u89e3\u6790\u5f97\u5230 JS \u7c7b\u578b\u3002\u5199\u5165\u65f6\u5148\u901a\u8fc7`JSON.stringify`\u5e8f\u5217\u5316\u6210\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u7136\u540e\u901a\u8fc7`useHashSearchParams`\u63d0\u4f9b\u7684\u66f4\u65b0\u51fd\u6570\u5199\u56de\u5230 hash \u4e32\u4e2d\u3002\\n\\n\u5b9e\u73b0\u4ee3\u7801\u5982\u4e0b\uff1a\\n\\n```ts\\nimport { useCallback } from \\"react\\";\\nimport { useHashSearchParams } from \\"react-use\\";\\n\\nconst mapValues = (src, fn) =>\\n  Object.keys(src).reduce(\\n    (target, key) => Object.assign(target, { [key]: fn(src[key]) }),\\n    {}\\n  );\\n\\n// \u91cd\u8f7d\u51fd\u6570\u7b7e\u540d\\ninterface UseRouteParamsType {\\n  <T = any>(key: string, defaultValue?: T): [T | undefined, (value: T) => void];\\n  <T = any>(): [\\n    Record<string, T | undefined>,\\n    (searchParams: Record<string, T>) => void\\n  ];\\n}\\n\\nexport const useHashSearchParamsJSON: UseRouteParamsType = (\\n  key?: any,\\n  defaultValue?: any\\n): any => {\\n  const dispatch = useTDispatch();\\n  // \u83b7\u53d6\u6307\u5b9a key \u7684 value \u503c\uff0c\u6b64\u65f6\u662f\u5b57\u7b26\u4e32\u683c\u5f0f\\n  const [json, setJson] = useHashSearchParams(key);\\n  let value: any;\\n\\n  // \u8c03\u7528 JSON.parse \u89e3\u6790 JSON \u5b57\u7b26\u4e32\u5230 JS \u503c\uff0c\u89e3\u6790\u53ef\u80fd\u4f1a\u5931\u8d25\u9700\u6355\u83b7\u5f02\u5e38\u5904\u7406\\n  try {\\n    value = key\\n      ? json === undefined\\n        ? defaultValue\\n        : JSON.parse(json)\\n      : _.mapValues(json, (v) => JSON.parse(v));\\n  } catch (err) {\\n    // debugErr(err)\\n  }\\n\\n  // \u8c03\u7528 JSON.stringify \u5e8f\u5217\u5316 JS \u503c\u6210 JSON \u5b57\u7b26\u4e32\\n  const setValue = useCallback(\\n    (newValue: any) => {\\n      if (key) {\\n        setJson(JSON.stringify(newValue));\\n      } else {\\n        setJson(_.mapValues(newValue, (v) => JSON.stringify(v)));\\n      }\\n    },\\n    [dispatch.shared, key, setJson, value]\\n  );\\n\\n  return [value, setValue];\\n};\\n```\\n\\n> `useHashSearchParamsJSON`\u9002\u7528\u8303\u56f4\u6bd4\u8f83\u6709\u9650\uff0c\u4e0d\u8003\u8651\u5408\u5165 react-use\uff0c\u5982\u679c\u9700\u8981\u53ef\u4ee5\u53c2\u8003\u4e0a\u8ff0\u4ee3\u7801\u81ea\u884c\u5728\u9879\u76ee\u4e2d\u5b9e\u73b0\u3002\\n\\n## \u5c0f\u7ed3\\n\\n\u672c\u6587\u5b9e\u73b0\u7684\u5bf9\u8def\u7531\u53c2\u6570\u8fdb\u884c\u8bfb\u5199\u7684 hooks\uff0c\u672c\u8eab\u5177\u6709\u5f88\u5f3a\u7684\u5b9e\u7528\u4ef7\u503c\uff0c\u5176\u6b21\u53ef\u4f5c\u4e3a\u81ea\u5b9a\u4e49 hooks \u7684\u5b66\u4e60\u53c2\u8003\u3002\u6b64\u5916\uff0c\u9047\u5230\u529f\u80fd\u590d\u6742\u7684 hooks \u53ef\u5c1d\u8bd5\u50cf\u672c\u6587\u4e00\u6837\u5148\u5206\u89e3 hooks \u7136\u540e\u5206\u6b65\u5b9e\u73b0\uff1a\u5148\u627e\u51fa\u66f4\u901a\u7528\u7684 hooks(\u5982`useHash`)\uff0c\u518d\u57fa\u4e8e\u5df2\u6709\u7684 hook \u5b9e\u73b0\u529f\u80fd\u66f4\u7279\u5b9a\u7684 hooks(\u5982`useHashSearchParams`)\u3002"},{"id":"/2020/02/24/glob","metadata":{"permalink":"/blog/2020/02/24/glob","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2020/02-24-glob.md","source":"@site/blog/2020/02-24-glob.md","title":"glob \u6a21\u5f0f\u5339\u914d\u6559\u7a0b","description":"\u4ecb\u7ecd","date":"2020-02-24T00:00:00.000Z","formattedDate":"February 24, 2020","tags":[{"label":"Node.js","permalink":"/blog/tags/node-js"},{"label":"Linux","permalink":"/blog/tags/linux"}],"readingTime":6.265,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Node.js","Linux"],"keywords":["glob","\u6a21\u5f0f\u5339\u914d"]},"prevItem":{"title":"\u81ea\u5b9a\u4e49 hooks - useHash","permalink":"/blog/2020/11/25/usehash"},"nextItem":{"title":"JavaScript \u9879\u76ee\u5fc5\u5907\u914d\u7f6e","permalink":"/blog/2019/07/30/setup-js-project"}},"content":"## \u4ecb\u7ecd\\n\\n\u6839\u636e[\u7ef4\u57fa\u767e\u79d1](<https://en.wikipedia.org/wiki/Glob_(programming)>)\u7684\u4ecb\u7ecd\uff0c\u5728\u8ba1\u7b97\u673a\u7f16\u7a0b\u4e2d glob \u6a21\u5f0f\u8868\u793a\u5e26\u6709\u901a\u914d\u7b26\u7684\u8def\u5f84\u540d\uff0c\u4f8b\u5982\u5728 bash \u4e2d\u67e5\u770b\u6587\u4ef6\u5217\u8868\uff1a\\n\\n```bash\\n$ls src/*.js\\nsrc/a.js src/b.js\\n```\\n\\n\u5b83\u6700\u521d\u662f\u8d1d\u5c14\u5b9e\u9a8c\u5ba4 Unix \u7cfb\u7edf\u4e0a\u7684\u4e00\u4e2a\u540d\u53eb glob \u7684\u547d\u4ee4\uff08glob \u662f global \u7684\u7f29\u5199\uff09\uff0c\u7528\u4e8e\u5c55\u5f00\u547d\u4ee4\u884c\u4e2d\u7684\u901a\u914d\u7b26\u3002\u540e\u6765\u7cfb\u7edf\u63d0\u4f9b\u4e86\u8be5\u529f\u80fd\u7684 C \u8bed\u8a00\u5e93\u51fd\u6570`glob()`\uff0c\u77e5\u540d\u7684 shell \u89e3\u91ca\u5668\u5c31\u4f7f\u7528\u4e86\u8be5\u63a5\u53e3\uff0cshell \u811a\u672c\u548c\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528\u7684 glob \u6a21\u5f0f\u5339\u914d\u529f\u80fd\u4fbf\u6e90\u81ea\u4e8e\u6b64\u3002\\n\\n\x3c!-- truncate --\x3e\\n\\n## \u57fa\u7840\u8bed\u6cd5\\n\\n\u76f8\u6bd4\u6b63\u5219\u8868\u8fbe\u5f0f\u5927\u91cf\u7684\u5143\u5b57\u7b26\uff0cglob \u6a21\u5f0f\u4e2d\u5143\u5b57\u7b26\u6781\u5c11\uff0c\u6240\u4ee5\u638c\u63e1\u8d77\u6765\u4e5f\u5f88\u5feb\u3002glob \u9ed8\u8ba4\u4e0d\u5339\u914d\u9690\u85cf\u6587\u4ef6\uff08\u4ee5\u70b9`.`\u5f00\u5934\u7684\u6587\u4ef6\u6216\u76ee\u5f55\uff09\uff0c\u4e0b\u9762\u662f glob \u7684\u8bed\u6cd5\uff1a\\n\\n| \u901a\u914d\u7b26             | \u63cf\u8ff0                           | \u793a\u4f8b      | \u5339\u914d                   | \u4e0d\u5339\u914d              |\\n| ------------------ | ------------------------------ | --------- | ---------------------- | ------------------- |\\n| `*`                | \u5339\u914d 0 \u4e2a\u6216\u591a\u4e2a\u5b57\u7b26\uff0c\u5305\u542b\u7a7a\u4e32  | `Law*`    | `Law`, `Laws`\u548c`Lawer` | `La`, `aw`          |\\n| `?`                | \u5339\u914d 1 \u4e2a\u5b57\u7b26                  | `?at`     | `cat`, `bat`           | `at`                |\\n| `[abc]`            | \u5339\u914d\u62ec\u53f7\u5185\u5b57\u7b26\u96c6\u5408\u4e2d\u7684\u5355\u4e2a\u5b57\u7b26 | `[cb]at`  | `cat`, `bat`           | `at`, `bcat`        |\\n| `[a-z]`            | \u5339\u914d\u62ec\u53f7\u5185\u5b57\u7b26\u8303\u56f4\u4e2d\u7684\u5355\u4e2a\u5b57\u7b26 | `[a-z]at` | `aat`, `bat`, `zat`    | `at`, `bcat`, `Bat` |\\n| `[^abc]`\u6216`[!abc]` | \u5339\u914d\u62ec\u53f7\u5185\u5b57\u7b26\u96c6\u5408\u4e2d\u7684\u5355\u4e2a\u5b57\u7b26 | `[cb]at`  | `cat`, `bat`           | `at`, `bcat`        |\\n| `[^a-z]`\u6216`[!a-z]` | \u5339\u914d\u62ec\u53f7\u5185\u5b57\u7b26\u8303\u56f4\u4e2d\u7684\u5355\u4e2a\u5b57\u7b26 | `[a-z]at` | `aat`, `bat`, `zat`    | `at`, `bcat`, `Bat` |\\n\\n> \u5728 bash \u547d\u4ee4\u884c\u4e2d`[!abc]`\u9700\u8981\u8f6c\u4e49\u6210`[\\\\!abc]`\\n\\n## \u6269\u5c55\u8bed\u6cd5\\n\\n\u9664\u4e86\u57fa\u7840\u8bed\u6cd5\u5916\uff0cbash \u8fd8\u652f\u6301 glob \u7684\u4e00\u4e9b\u6269\u5c55\u8bed\u6cd5\uff0c\u4e3b\u8981\u5305\u542b\u4e09\u79cd\uff1a\\n\\n- Brace Expansion\\n- globstar\\n- extglob\\n\\n\u4e09\u79cd\u6269\u5c55\u8bed\u6cd5\u7684\u5b9a\u4e49\u548c\u63cf\u8ff0\u5982\u4e0b\uff1a\\n\\n| \u901a\u914d\u7b26            | \u63cf\u8ff0                                                                                | \u793a\u4f8b              | \u5339\u914d                               | \u4e0d\u5339\u914d           |\\n| ----------------- | ----------------------------------------------------------------------------------- | ----------------- | ---------------------------------- | ---------------- |\\n| `{x, y, ...}`     | Brace Expansion\uff0c\u5c55\u5f00\u82b1\u62ec\u53f7\u5185\u5bb9\uff0c\u652f\u6301\u5c55\u5f00\u5d4c\u5957\u62ec\u53f7                                   | `a.{png,jp{,e}g}` | `a.png`, `a.jpg`, `a.jpeg`         |                  |\\n| `**`              | globstar\uff0c\u5339\u914d\u6240\u6709\u6587\u4ef6\u548c\u4efb\u610f\u5c42\u76ee\u5f55\uff0c\u5982\u679c`**`\u540e\u9762\u7d27\u63a5\u7740`/`\u5219\u53ea\u5339\u914d\u76ee\u5f55\uff0c\u4e0d\u542b\u9690\u85cf\u76ee\u5f55 | `src/**`          | `src/a.js`, `src/b/a.js`, `src/b/` | `src/.hide/a.js` |\\n| `?(pattern-list)` | \u5339\u914d 0 \u6b21\u6216 1 \u6b21\u7ed9\u5b9a\u7684\u6a21\u5f0f                                                          | `a.?(txt\\\\|bin)`   | `a.`, `a.txt`, `a.bin`             | `a`              |\\n| `*(pattern-list)` | \u5339\u914d 0 \u6b21\u6216\u591a\u6b21\u7ed9\u5b9a\u7684\u6a21\u5f0f                                                           | `a.*(txt\\\\|bin)`   | `a.`, `a.txt`, `a.bin`, `a.txtbin` | `a`              |\\n| `+(pattern-list)` | \u5339\u914d 1 \u6b21\u6216\u591a\u6b21\u7ed9\u5b9a\u7684\u6a21\u5f0f                                                           | `a.+(txt\\\\|bin)`   | `a.txt`, `a.bin`, `a.txtbin`       | `a.`, `a`        |\\n| `@(pattern-list)` | \u5339\u914d\u7ed9\u5b9a\u7684\u6a21\u5f0f                                                                      | `a.@(txt\\\\|bin)`   | `a.txt`, `a.bin`                   | `a.`, `a.txtbin` |\\n| `!(pattern-list)` | \u5339\u914d\u975e\u7ed9\u5b9a\u7684\u6a21\u5f0f                                                                    | `a.!(txt\\\\|bin)`   | `a.`, `a.txtbin`                   | `a.txt`, `a.bin` |\\n\\n> pattern-list \u662f\u4e00\u7ec4\u4ee5`|`\u4f5c\u4e3a\u5206\u9694\u7b26\u7684\u6a21\u5f0f\u96c6\u5408\uff0c\u4f8b\u5982`abc|a?c|ac*`\\n\\n## \u4e0e regexp \u7684\u5dee\u5f02\\n\\nglob \u6a21\u5f0f\u4e3b\u8981\u7528\u4e8e\u5339\u914d\u6587\u4ef6\u8def\u5f84\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5339\u914d\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u5728\u5339\u914d\u5b57\u7b26\u4e32\u7684\u80fd\u529b\u4e0a\u6bd4 regexp \u8981\u5f31\u5f88\u591a\u3002\u7531\u4e8e glob \u6a21\u5f0f\u548c regexp \u5b58\u5728\u76f8\u540c\u7684\u5143\u5b57\u7b26\uff0c\u4f46\u662f\u542b\u4e49\u5374\u4e0d\u540c\uff0c\u5bb9\u6613\u5bfc\u81f4\u6df7\u6dc6\uff0c\u4e3a\u4e86\u907f\u514d\u6df7\u6dc6\uff0c\u4e0b\u9762\u5c06 glob \u6a21\u5f0f\u8f6c\u6362\u6210\u5bf9\u5e94\u7684 regexp \u8868\u793a\uff0c\u4ee5\u4fbf\u533a\u5206\u4ed6\u4eec\u7684\u5f02\u540c\u70b9\u3002\\n\\n| glob    | regexp  | \u7cbe\u786e\u7684 regexp     |\\n| ------- | ------- | ----------------- |\\n| `*`     | `.*`    | `^(?!\\\\.)[^\\\\/]*?$` |\\n| `?`     | `.`     | `^(?!\\\\.)[^\\\\/]$`   |\\n| `[a-z]` | `[a-z]` | `^[a-z]$`         |\\n\\n> glob \u5339\u914d\u7684\u662f\u6574\u4e2a\u5b57\u7b26\u4e32\uff0c\u800c regexp \u9ed8\u8ba4\u5339\u914d\u7684\u662f\u5b50\u4e32\uff0cregexp \u5982\u679c\u8981\u5339\u914d\u6574\u4e2a\u5b57\u7b26\u4e32\u9700\u663e\u5f0f\u6307\u5b9a`^`\u548c`$`\u3002\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\u7684`(?!\\\\.)`\uff0c\u5176\u8868\u793a\u4e0d\u5339\u914d\u9690\u85cf\u6587\u4ef6\\n\\n## JavaScript API\\n\\n\u901a\u8fc7\u4e0a\u9762\u7684\u4ecb\u7ecd\uff0c\u5df2\u7ecf\u4e86\u89e3\u5230 glob \u6a21\u5f0f\u53ef\u4ee5\u7528\u4e8e\u5339\u914d\u6587\u4ef6\u8def\u5f84\uff0c\u751a\u81f3\u5b57\u7b26\u4e32\uff0c\u5982\u4f55\u4f7f\u7528\u5462\uff1f\u5728 JavaScript \u4e2d\uff0c\u6b63\u5219\u8868\u8fbe\u5f0f\u662f\u4ee5\u6807\u51c6 API \u5f62\u5f0f\u63d0\u4f9b\u7684\uff0c\u5f00\u7bb1\u5373\u7528\u3002\u4f46\u662f glob \u6a21\u5f0f\u5339\u914d\u5e76\u975e JavaScript \u4e2d\u7684\u6807\u51c6 API\uff0c\u9700\u8981\u81ea\u884c\u89e3\u6790\u548c\u5339\u914d\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u4e2a\u7528 JavaScript \u7f16\u5199\u7684 glob \u7684\u5339\u914d\u5e93 [minimatch](https://github.com/isaacs/minimatch)\uff0c\u5b83\u652f\u6301 glob \u57fa\u7840\u8bed\u6cd5\u548c\u6269\u5c55\u8bed\u6cd5\uff0c\u53ef\u4ee5\u5b9e\u73b0 glob \u7684\u6d4b\u8bd5\u3001\u5339\u914d\u4ee5\u53ca\u8f6c\u6362\u6210\u6b63\u5219\u8868\u8fbe\u5f0f\u3002\u4e0b\u9762\u662f\u4f7f\u7528\u793a\u4f8b\uff1a\\n\\n```js\\nconst minimatch = require(\\"minimatch\\");\\n\\n// minimatch \u4f5c\u4e3a\u51fd\u6570\u4f7f\u7528\u6d4b\u8bd5\u8def\u5f84\u5339\u914d\\n// \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8f93\u5165\u8def\u5f84\\n// \u7b2c\u4e8c\u4e2a\u53c2\u6570\u662f glob \u6a21\u5f0f\\n// \u8fd4\u56de boolean \u503c\\nminimatch(\\"a.txt\\", \\"*.txt\\"); // true\\nminimatch(\\"a.txt\\", \\"*.bin\\"); // false\\n\\n// minimatch.makeRe \u53ef\u5c06 glob \u6a21\u5f0f\u4e32\u8f6c\u6362\u6210 JS \u4e2d\u7684 RegExp \u5bf9\u8c61\\n// \u7136\u540e\u4f7f\u7528\u751f\u6210\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u8fdb\u884c\u8def\u5f84\u5339\u914d\u6d4b\u8bd5\\nminimatch.makeRe(\\"*.txt\\").test(\\"a.txt\\"); // true\\nminimatch.makeRe(\\"*.bin\\").test(\\"a.txt\\"); // false\\n```\\n\\n## \u5e94\u7528\u4f8b\u5b50\\n\\nglob \u6700\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u662f\u5339\u914d\u6587\u4ef6\u8def\u5f84\uff0c\u4f7f\u7528 glob \u5339\u914d\u6587\u4ef6\u8def\u5f84\u6bd4\u6b63\u5219\u8868\u8fbe\u5f0f\u66f4\u7b80\u6d01\u3002\u4e0b\u9762\u4f8b\u5b50\u5b9e\u73b0\u5229\u7528 glob \u6a21\u5f0f\u8fc7\u6ee4\u6587\u4ef6\u8def\u5f84\uff1a\\n\\n```js\\nvar minimatch = require(\\"minimatch\\");\\n\\nconst fileList = [\\n  \\"src/index.js\\",\\n  \\"src/index.css\\",\\n  \\"src/pages/HomePage.jsx\\",\\n  \\"src/pages/AboutPage/index.jsx\\",\\n];\\n\\n// minimatch.match \u65b9\u6cd5\u6839\u636e glob \u6a21\u5f0f\u8fc7\u6ee4\u8def\u5f84\u5217\u8868\\n// \u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u8def\u5f84\u5217\u8868\\n// \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e0e\u662f glob \u6a21\u5f0f\u4e32\\n// \u8fd4\u56de\u8fc7\u6ee4\u540e\u7684\u8def\u5f84\u5217\u8868\\nconsole.log(minimatch.match(fileList, \\"src/**/*.js{,x}\\"));\\n// [\\"src/index.js\\", \\"src/pages/HomePage.jsx\\", \\"src/pages/AboutPage/index.jsx\\"]\\n```\\n\\n\u5982\u679c\u8981\u901a\u8fc7 glob \u6a21\u5f0f\u904d\u5386\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4f7f\u7528 [node-glob](https://github.com/isaacs/node-glob) \uff0c\u5b83\u57fa\u4e8e minimatch \u548c node \u5b9e\u73b0 glob \u6a21\u5f0f\u904d\u5386\u6587\u4ef6\u7684 API\u3002\\n\\n## \u53c2\u8003\\n\\n- https://en.wikipedia.org/wiki/Glob_(programming)\\n- https://www.gnu.org/software/bash/manual/html_node/Brace-Expansion.html#Brace-Expansion\\n- https://www.gnu.org/software/bash/manual/html_node/Pattern-Matching.html#Pattern-Matching\\n- https://github.com/isaacs/minimatch\\n- https://github.com/qdlaoyao/js-regex-mini-book"},{"id":"/2019/07/30/setup-js-project","metadata":{"permalink":"/blog/2019/07/30/setup-js-project","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2019/07-30-setup-js-project/index.md","source":"@site/blog/2019/07-30-setup-js-project/index.md","title":"JavaScript \u9879\u76ee\u5fc5\u5907\u914d\u7f6e","description":"\u672c\u6587\u4ecb\u7ecd\u4e00\u4e9b\u524d\u7aef\u9879\u76ee\u7684\u901a\u7528\u914d\u7f6e\u53ca\u76f8\u5173\u8d44\u6e90\uff0c\u4ee5\u4fbf\u4f60\u4e86\u89e3\u9879\u76ee\u4e2d\u5e38\u89c1\u914d\u7f6e\u7684\u542b\u4e49\u4ee5\u53ca\u914d\u7f6e\u65b9\u5f0f\u3002","date":"2019-07-30T00:00:00.000Z","formattedDate":"July 30, 2019","tags":[],"readingTime":9.915,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tag":["Node.js","JavaScript"]},"prevItem":{"title":"glob \u6a21\u5f0f\u5339\u914d\u6559\u7a0b","permalink":"/blog/2020/02/24/glob"},"nextItem":{"title":"Web \u524d\u7aef\u8def\u7531\u539f\u7406\u89e3\u6790\u548c\u5b9e\u73b0","permalink":"/blog/2019/03/12/web-router-principle"}},"content":"\u672c\u6587\u4ecb\u7ecd\u4e00\u4e9b\u524d\u7aef\u9879\u76ee\u7684\u901a\u7528\u914d\u7f6e\u53ca\u76f8\u5173\u8d44\u6e90\uff0c\u4ee5\u4fbf\u4f60\u4e86\u89e3\u9879\u76ee\u4e2d\u5e38\u89c1\u914d\u7f6e\u7684\u542b\u4e49\u4ee5\u53ca\u914d\u7f6e\u65b9\u5f0f\u3002\\n\\n\u76ee\u5f55\\n- .gitignore - \u8ba9 Git \u63d0\u4ea4\u65f6\u5ffd\u7565\u6587\u4ef6\\n- editorconfig - \u8ba9\u7f16\u8f91\u5668\u6216IDEs\u4fdd\u6301\u4e00\u81f4\u7684\u7f16\u7801\u6837\u5f0f\\n- husky - \u4f7f\u7528 git hooks \u89e6\u53d1\u52a8\u4f5c\\n- lint-staged - \u5bf9 git \u6682\u5b58\u533a\u5339\u914d\u7684\u6587\u4ef6\u6267\u884c\u52a8\u4f5c\\n- commitzen - \u547d\u4ee4\u884c\u4ea4\u4e92\u5f0f\u751f\u6210\u7b26\u5408[\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303](https://www.conventionalcommits.org/zh-hans)\u7684 commit message\\n- commitlint - \u786e\u4fdd commit message \u7b26\u5408\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303\\n- Prettier - \u7f8e\u5316\u4ee3\u7801\u683c\u5f0f\\n- ESLint - \u68c0\u67e5 JS \u4ee3\u7801\u8d28\u91cf\\n- Stylelint - \u68c0\u67e5 CSS \u4ee3\u7801\u8d28\u91cf\\n\\n\x3c!--truncate--\x3e\\n\\n## [.gitignore](https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository) - \u8ba9 Git \u63d0\u4ea4\u65f6\u5ffd\u7565\u6587\u4ef6\\n \\n\u901a\u8fc7`.gitignore`\u6587\u4ef6\u53ef\u5c06\u9879\u76ee\u4e2d\u7b26\u5408\u89c4\u5219\u7684\u6587\u4ef6\u5ffd\u7565\u6389\uff0c\u907f\u514d\u63d0\u4ea4\u5e26\u6709\u654f\u611f\u4fe1\u606f\u6216\u4e0d\u9700\u8981\u5171\u4eab\u7684\u6587\u4ef6\u5230 Git \u4ed3\u5e93\u3002\\n\\nJavaScript \u9879\u76ee\u5e38\u7528\u914d\u7f6e\uff1a\\n```\\n# dependencies\\n/node_modules\\n\\n# testing\\n/coverage\\n\\n# production\\n/build\\n\\n# vscode\\n.vscode/*\\n!.vscode/settings.json\\n!.vscode/tasks.json\\n!.vscode/launch.json\\n!.vscode/extensions.json\\n\\n# env\\n.env.local\\n.env.*.local\\n\\n# misc\\n.DS_Store\\n\\n# package manager\\nnpm-debug.log*\\nyarn-debug.log*\\nyarn-error.log*\\n```\\n \\n[gitignore]( https://github.com/github/gitignore) \u662f Github \u5b98\u65b9\u7ef4\u62a4\u7684\u4e00\u4efd git ignore \u914d\u7f6e\uff0c\u53ef\u4ece\u4e2d\u67e5\u627e\u6240\u9700\u914d\u7f6e\u89c4\u5219\u3002\\n\\n## [.editorconfig](https://editorconfig.org/) - \u8ba9\u7f16\u8f91\u5668\u6216IDEs\u4fdd\u6301\u4e00\u81f4\u7684\u7f16\u7801\u6837\u5f0f\\n \\nEditorConfig\u53ef\u4ee5\u5e2e\u52a9\u5728\u4e0d\u540c\u7684\u7f16\u8f91\u5668\u548cIDE\u4e0a\u4ece\u4e8b\u540c\u4e00\u9879\u76ee\u7684\u591a\u4e2a\u5f00\u53d1\u4eba\u5458\u4fdd\u6301\u4e00\u81f4\u7684\u7f16\u7801\u6837\u5f0f\u3002 EditorConfig\u9879\u76ee\u5305\u62ec\u4e00\u4e2a\u7528\u4e8e\u5b9a\u4e49\u7f16\u7801\u6837\u5f0f\u7684\u6587\u4ef6\u683c\u5f0f\u548c\u4e00\u4e2a\u6587\u672c\u7f16\u8f91\u5668\u63d2\u4ef6\u96c6\u5408\uff0c\u8fd9\u4e9b\u6587\u672c\u7f16\u8f91\u5668\u63d2\u4ef6\u4f7f\u7f16\u8f91\u5668\u53ef\u4ee5\u8bfb\u53d6\u6587\u4ef6\u683c\u5f0f\u5e76\u9075\u5faa\u5b9a\u4e49\u7684\u6837\u5f0f\u3002 EditorConfig\u6587\u4ef6\u6613\u4e8e\u9605\u8bfb\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0e\u7248\u672c\u63a7\u5236\u7cfb\u7edf\u5f88\u597d\u5730\u534f\u540c\u5de5\u4f5c\u3002\\n \\n\u914d\u7f6e\u793a\u4f8b\uff1a\\n```ini\\n# editorconfig.org\\nroot = true\\n \\n[*]\\nindent_style = space\\nindent_size = 2\\nend_of_line = lf\\ncharset = utf-8\\ntrim_trailing_whitespace = true\\ninsert_final_newline = true\\n \\n[*.md]\\ntrim_trailing_whitespace = false\\n```\\n \\n\u66f4\u591a\u914d\u7f6e\u53c2\u8003 [EditorConfig](https://editorconfig.org/)\\n\\n## [husky](https://github.com/typicode/husky) - \u4f7f\u7528 git hooks \u89e6\u53d1\u52a8\u4f5c\\n\\n\u501f\u52a9 husky \u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5728 git push, git commit \u7b49\u547d\u4ee4\u65f6\u6267\u884c\u4e00\u4e9b\u9644\u52a0\u52a8\u4f5c\uff0c\u4f8b\u5982\u68c0\u67e5 commit message \u662f\u5426\u7b26\u5408\u89c4\u8303\u3001\u5bf9\u4ee3\u7801\u8fdb\u884c\u68c0\u67e5\u548c\u683c\u5f0f\u5316\u7b49\u3002\\n \\n\u901a\u8fc7 npm \u5b89\u88c5\\n```\\nnpm install husky --save-dev\\n```\\n\\n\u5728 pacakge.json \u4e2d\u6dfb\u52a0\u52a8\u4f5c\\n```json\\n{\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"pre-commit\\": \\"npm test\\",\\n      \\"pre-push\\": \\"echo $HUSKY_GIT_PARAMS\\",\\n      \\"...\\": \\"...\\"\\n    }\\n  }\\n}\\n```\\n\\n## [lint-staged](https://github.com/okonet/lint-staged)  - \u5bf9 git \u6682\u5b58\u533a\u5339\u914d\u7684\u6587\u4ef6\u6267\u884c\u52a8\u4f5c\\n\\n\u5728\u63d0\u4ea4\u4ee3\u7801\u524d\uff0c\u901a\u5e38\u4f1a\u5bf9\u4ee3\u7801\u8fdb\u884c\u8d28\u91cf\u68c0\u6d4b\u3001\u4ee3\u7801\u683c\u5f0f\u5316\u7b49\u64cd\u4f5c\uff0c\u4f46\u8fd9\u4e9b\u64cd\u4f5c\u9ed8\u8ba4\u4f1a\u5bf9\u6574\u4e2a\u9879\u76ee\u8fdb\u884c\u5904\u7406\uff0c\u5bf9\u4e8e\u7a0d\u5927\u7684\u9879\u76ee\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u5f02\u5e38\u6162\u3002\u5176\u5b9e\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5bf9\u672c\u6b21\u8981\u63d0\u4ea4\u5230 git \u4ed3\u5e93\u7684\u53d8\u66f4\u6587\u4ef6\uff0c\u8fdb\u884c\u68c0\u6d4b\u5373\u53ef\u907f\u514d\u4ee3\u7801\u6d41\u5165\u4ed3\u5e93\u3002\u901a\u5e38\u6bcf\u6b21\u63d0\u4ea4\u6240\u5305\u542b\u7684\u53d8\u66f4\u6587\u4ef6\u662f\u6bd4\u8f83\u5c11\u7684\uff0c\u8fd9\u53ef\u4ee5\u5927\u5927\u52a0\u901f\u4ee3\u7801\u68c0\u6d4b\u7684\u901f\u5ea6\u3002\\n\\n\u501f\u52a9 lint-staged \u53ef\u4ee5\u5bf9 git \u6682\u5b58\u533a\u5339\u914d\u7684\u6587\u4ef6\u6267\u884c\u4e00\u7ec4\u52a8\u4f5c\u3002\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```\\nnpm install --save-dev lint-staged\\n```\\n\\n\u5728 package.json \u4e2d\u914d\u7f6e\u5339\u914d\u6587\u4ef6(glob \u5339\u914d\u6a21\u5f0f)\u548c\u8981\u6267\u884c\u7684\u52a8\u4f5c\u547d\u4ee4\u3002\\n```json\\n{\\n  \\"lint-staged\\": {\\n    \\"*.js\\": \\"your-cmd\\"\\n  }\\n}\\n```\\n\\n\u5bf9\u4e8e\u4e0a\u9762\u7684\u914d\u7f6e\uff0c\u5982\u679c\u4f60\u521a\u6267\u884c\u4e86`git add file1.ext file2.ext`\uff0clint-staged \u5c06\u4f1a\u6267\u884c\u5982\u4e0b\u547d\u4ee4`your-cmd file1.ext file2.ext`\\n \\n## [commitizen](https://github.com/commitizen/cz-cli) - \u547d\u4ee4\u884c\u4ea4\u4e92\u5f0f\u751f\u6210\u7b26\u5408\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303\u7684 commit message\\n \\n\u4f7f\u7528 Commitizen \u8fdb\u884c\u63d0\u4ea4\u65f6\uff0c\u7cfb\u7edf\u4f1a\u63d0\u793a\u60a8\u5728\u63d0\u4ea4\u65f6\u586b\u5199\u6240\u6709\u5fc5\u9700\u7684\u63d0\u4ea4\u5b57\u6bb5\uff0c\u4f60\u53ea\u9700\u8981\u6839\u636e\u63d0\u793a\u586b\u5199\u63d0\u4ea4\u4fe1\u606f\uff0cCommitizen \u4f1a\u4fdd\u8bc1\u6700\u7ec8\u63d0\u4ea4\u7684\u6d88\u606f\u7b26\u5408 [\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303](https://www.conventionalcommits.org/zh-hans)\u3002\\n\\n![snapshot](add-commit.png)\\n\\n\u5982\u679c\u4f60\u7684\u9879\u76ee\u662f\u5bf9  Commitizen \u53cb\u597d\u7684\uff08\u5373\u5df2\u7ecf\u5b89\u88c5\u4e86 Commitizen \u4f9d\u8d56\uff09\uff0c\u5219\u5728\u9879\u76ee\u4e0b\u63d0\u4ea4\u6d88\u606f\u65f6\u53ef\u76f4\u63a5\u4f7f\u7528`npx git-cz`\u6765\u66ff\u4ee3`git commit`\u547d\u4ee4\u3002\u5426\u5219\uff0c\u4f60\u9700\u8981\u6309\u7167\u4e0b\u9762\u6307\u5f15\u5b89\u88c5\u4f9d\u8d56\uff0c\u8ba9\u4f60\u7684\u9879\u76ee\u53d8\u4e3a\u5bf9  Commitizen \u53cb\u597d\u7684\u3002\\n\\n**\u4f7f\u9879\u76ee\u5bf9 Commitizen \u53cb\u597d**\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```bash\\nnpm install --save-dev commitizen\\n```\\n\\n\u521d\u59cb\u5316\u9002\u914d\u5668\\n```\\nnpx commitizen init cz-conventional-changelog --save-dev --save-exact\\n```\\n \\n\u63d0\u4ea4\u4ee3\u7801\\n```bash\\n# \u6682\u5b58\u4fee\u6539\u7684\u4ee3\u7801\\ngit add .\\n\\n# \u63d0\u4ea4\u4ee3\u7801\uff0c\u8be5\u547d\u4ee4\u66ff\u4ee3 git commit\\nnpx git-cz\\n\\n# \u91cd\u65b0\u63d0\u4ea4\uff08\u4f7f\u7528\u4e0a\u6b21\u8f93\u5165\u7684 commit \u6d88\u606f\uff0c\u8fd9\u5728\u63d0\u4ea4\u5931\u8d25\u540e\u518d\u6b21\u63d0\u4ea4\u65f6\u7279\u522b\u6709\u7528\uff09\\nnpx git-cz --retry\\n```\\n\\n\u53c2\u8003[Commit message \u548c Change log \u7f16\u5199\u6307\u5357](http://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html)\u3002\\n\\n\\n## [commitlint](https://github.com/conventional-changelog/commitlint) - \u786e\u4fdd commit message \u7b26\u5408\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303\\n\\n\u501f\u52a9 commitizen \u53ef\u4ee5\u8f85\u52a9\u751f\u6210\u7b26\u5408\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303\u7684 commit message\uff0c\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u65e0\u6cd5\u786e\u4fdd\u9879\u76ee\u5176\u4ed6\u6210\u5458\u4e5f\u4f1a\u9075\u5faa\uff0c\u5373\u4f7f\u6709\u5f00\u53d1\u6587\u6863\u7ea6\u675f\uff0c\u4f46\u7f3a\u4e4f\u5f3a\u5236\u529b\uff0c\u4f9d\u7136\u4f1a\u6709\u6210\u5458\u5fd8\u8bb0\u6309\u8fd9\u79cd\u89c4\u8303\u7f16\u5199 commit message\u3002\u6b64\u65f6\uff0c\u9700\u8981\u501f\u52a9 commitlint \u5728\u63d0\u4ea4\u4e4b\u524d\u68c0\u6d4b commit message \u662f\u5426\u5408\u4e4e\u89c4\u8303\u3002\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```bash\\nnpm install --save-dev @commitlint/config-conventional @commitlint/cli\\n```\\n\\n\u5728 package.json \u4e2d\u8fdb\u884c\u914d\u7f6e\\n```json\\n{\\n  \\"commitlint\\": {\\n    \\"extends\\": [\\n      \\"@commitlint/config-conventional\\"\\n    ]\\n  }\\n}\\n```\\n\\n\u7ea6\u5b9a\u5f0f\u63d0\u4ea4\u89c4\u8303\u89c4\u5b9a commit message \u9700\u6ee1\u8db3\u4e0b\u9762\u683c\u5f0f\uff0c\u5176\u4e2d type \u548c description \u662f\u5fc5\u586b\u9879\uff0c\u6709\u6548\u7684 type \u503c\u6709 fix/feat/chore/docs/refactors/build/ci/style/perf/test \u4ee5\u53ca\u5176\u4ed6\u3002\\n```\\n<type>[optional scope]: <description>\\n\\n[optional body]\\n\\n[optional footer(s)]\\n```\\n\\n\u547d\u4ee4\u884c\u6d4b\u8bd5\\n```bash\\n# Error\uff0c\u4f1a\u8f93\u51fa\u9519\u8bef\u4fe1\u606f\\necho \\"xxx\\" | npx commitlint\\n\\n# OK\\necho \\"fix: xxx\\" | npx commitlint\\n```\\n\\n\u4e0e husky \u4e00\u8d77\u914d\u5408\u4f7f\u7528\uff0c\u63d0\u4ea4\u524d\u5bf9 commit message \u8fdb\u884c\u6821\u9a8c\\n```json\\n{\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"commit-msg\\": \\"commitlint -E HUSKY_GIT_PARAMS\\"\\n    }\\n  }\\n}\\n```\\n \\n## [Prettier](https://prettier.io/docs/en/install.html) - \u7f8e\u5316\u4ee3\u7801\u683c\u5f0f\\n\\nPrettier \u662f\u4e00\u4e2a\u4ee3\u7801\u683c\u5f0f\u5316\u7a0b\u5e8f\uff08\u5904\u7406\u7f29\u8fdb\u3001\u6362\u884c\u3001\u7a7a\u683c\u7b49\uff09\uff0c\u5b83\u89e3\u6790\u4ee3\u7801\u6210\u62bd\u8c61\u8bed\u6cd5\u6811(AST)\u5e76\u6839\u636e\u81ea\u5b9a\u4e49\u683c\u5f0f\u91cd\u65b0\u8f93\u51fa\u4ee3\u7801\uff0c\u4fdd\u8bc1\u4ee3\u7801\u903b\u8f91\u4e0d\u53d8\u7684\u524d\u63d0\u4e0b\u4ee3\u7801\u683c\u5f0f\u7edf\u4e00\u3002\u5b83\u652f\u6301\u4f17\u591a\u5e38\u89c1\u8bed\u8a00\uff0c\u4f8b\u5982 js/jsx/ts/tsx/json/css/scss/vue/yaml \u7b49\u3002\\n\\n**\u683c\u5f0f\u5316\u6307\u5b9a\u6587\u4ef6**\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```\\nnpm install --save-dev prettier\\n```\\n\\n\u6267\u884c\u4e0b\u9762\u547d\u4ee4\u540e\uff0cprettier \u683c\u5f0f\u5316\u6307\u5b9a\u6587\u4ef6\uff0c\u5e76\u5199\u56de\u539f\u6587\u4ef6\uff08\u6307\u5b9a`--write`\u53c2\u6570\uff09\u3002\\n```\\nnpx prettier --write \\"src/**/*.js\\"\\n```\\n\\n**\u683c\u5f0f\u5316\u672c\u6b21 git \u63d0\u4ea4\u7684\u6587\u4ef6**\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\u4f9d\u8d56\\n```bash\\nnpm install --save husky lint-staged\\n```\\n\\n\u5728`package.json`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff0c\u4e4b\u540e\u6267\u884c`git commit`\u524d\u4f1a\u5bf9\u672c\u6b21\u63d0\u4ea4\u7684\u6587\u4ef6\u8fdb\u884c\u683c\u5f0f\u5316\uff0c\u5e76\u6dfb\u52a0\u5230\u672c\u6b21\u63d0\u4ea4\u5185\u5bb9\u4e2d\u3002\u4e5f\u53ef\u4ee5\u76f4\u63a5\u6267\u884c`npx lint-staged`\u683c\u5f0f\u5316\u672c\u6b21\u5f85\u63d0\u4ea4\u6587\u4ef6\u3002\\n```json\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"pre-commit\\": \\"lint-staged\\"\\n    }\\n  },\\n  \\"lint-staged\\": {\\n    \\"src/**/*.{js,jsx,ts,tsx,json,css,scss,md}\\": [\\n      \\"prettier --write\\",\\n      \\"git add\\"\\n    ]\\n  }\\n```\\n\\n\u521b\u5efa [.prettierrc](https://prettier.io/docs/en/configuration.html) \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\\n\\n ## [ESLint]( https://eslint.org/) - \u68c0\u67e5 JS \u4ee3\u7801\u8d28\u91cf\\n \\nESLint \u662f\u4e00\u4e2a\u53ef\u63d2\u62d4\u7684 JS \u548c JSX \u68c0\u67e5\u5de5\u5177\u3002\\n \\n**\u68c0\u67e5\u6307\u5b9a\u6587\u4ef6** \\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```\\nnpm install --save-dev eslint\\n```\\n\\n\u6267\u884c\u4e0b\u9762\u547d\u4ee4\u540e\uff0ceslint \u4f1a\u8bfb\u53d6\u9879\u76ee\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u7136\u540e\u5bf9\u8f93\u5165\u6587\u4ef6\u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u8f93\u51fa\u68c0\u67e5\u7ed3\u679c\u3002\\n```\\nnpx eslint \\"src/**/*.js\\"\\n```\\n\\n**\u68c0\u67e5\u672c\u6b21 git \u63d0\u4ea4\u7684\u6587\u4ef6**\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\u4f9d\u8d56\\n```bash\\nnpm install --save-dev husky lint-staged\\n```\\n\\n\u5728`package.json`\u4e2d\u6dfb\u52a0\u5982\u4e0b\u914d\u7f6e\uff0c\u4e4b\u540e\u6267\u884c`git commit`\u524d eslint \u4f1a\u5bf9\u672c\u6b21\u63d0\u4ea4\u6587\u4ef6\u8fdb\u884c\u68c0\u67e5\uff0c\u5982\u679c\u68c0\u67e5\u5b58\u5728\u95ee\u9898\uff08\u5373 shell \u6307\u4ee4\u8fd4\u56de\u975e 0\uff09\u5219\u7ec8\u6b62\u672c\u6b21\u63d0\u4ea4\u3002\\n```json\\n  \\"lint-staged\\": {\\n    \\"src/**/*.{js,jsx}\\": \\"eslint\\"\\n  },\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"pre-commit\\": \\"lint-staged\\"\\n    }\\n  }\\n```\\n \\n\u521b\u5efa [.eslintrc](https://eslint.org/docs/user-guide/configuring) \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49\uff0c\u5982\u679c\u4e0d\u77e5\u9053\u5982\u4f55\u914d\u7f6e\uff0c\u53ef\u6267\u884c`eslint --init`\uff0c\u7136\u540e\u6839\u636e\u63d0\u793a\u505a\u51fa\u9009\u62e9\uff0ceslint \u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4efd\u914d\u7f6e\u6587\u4ef6\u3002\\n\\n \\n## [Stylelint](http://stylelint.cn/)- \u68c0\u67e5 CSS \u4ee3\u7801\u8d28\u91cf\\n\\nStylelint \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u73b0\u4ee3 CSS \u68c0\u6d4b\u5668\uff0c\u53ef\u4ee5\u8ba9\u4f60\u5728\u6837\u5f0f\u8868\u4e2d\u9075\u5faa\u4e00\u81f4\u7684\u7ea6\u5b9a\u548c\u907f\u514d\u9519\u8bef\u3002\\n\\n\u901a\u8fc7 npm \u5b89\u88c5\\n```\\nnpm install --save-dev stylelint\\n```\\n\\n\u4f7f\u7528 CLI \u68c0\u6d4b\u6837\u5f0f\u6587\u4ef6\\n```\\nnpx stylelint \\"src/**/*.css\\"\\n```\\n\\n\\n\u7ed3\u5408 husky \u4f7f\u7528\uff0c\u5728\u63d0\u4ea4\u4ee3\u7801\u524d\u6267\u884c\u68c0\u67e5\\n```json\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"pre-commit\\": \\"stylelint src/**/*.css\\"\\n    }\\n  }\\n```\\n\\n\u7ed3\u5408 husky \u548c lint-staged \u4e00\u8d77\u4f7f\u7528\uff0c\u68c0\u67e5\u672c\u6b21\u63d0\u4ea4\u4e2d\u4fee\u6539\u7684\u6587\u4ef6\\n```json\\n  \\"lint-staged\\": {\\n    \\"src/**/*.css\\": \\"stylelint\\"\\n  },\\n  \\"husky\\": {\\n    \\"hooks\\": {\\n      \\"pre-commit\\": \\"lint-staged\\"\\n    }\\n  }\\n```\\n\\n\\n\u521b\u5efa [.stylelintrc](http://stylelint.cn/user-guide/configuration/) \u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u81ea\u5b9a\u4e49\u3002\\n\\n\u9884\u8bbe\u914d\u7f6e\\n* [ stylelint-config-recommended ]( https://github.com/stylelint/stylelint-config-recommended )\\n\\n## \u53c2\u8003\\n \\n[node-blog 3.1 \u5f00\u53d1\u524d\u7684\u9879\u76ee\u914d\u7f6e](https://github.com/liuxing/abc-blog/tree/master/docs/3.1%E5%BC%80%E5%8F%91%E5%89%8D%E7%9A%84%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.md)\\n\\n## \u6700\u540e\\n\\n\u6682\u65f6\u5148\u5230\u8fd9\u91cc\uff0c\u540e\u7eed\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u60c5\u51b5\u548c\u5de5\u5177\u53d8\u5316\u518d\u8fdb\u884c\u66f4\u65b0\uff0c\u5982\u6709\u95ee\u9898\uff0c\u6b22\u8fce\u6307\u6b63\u3002"},{"id":"/2019/03/12/web-router-principle","metadata":{"permalink":"/blog/2019/03/12/web-router-principle","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2019/03-12-web-router-principle/index.md","source":"@site/blog/2019/03-12-web-router-principle/index.md","title":"Web \u524d\u7aef\u8def\u7531\u539f\u7406\u89e3\u6790\u548c\u5b9e\u73b0","description":"\u5728\u5355\u9875\u5e94\u7528\u5982\u6b64\u6d41\u884c\u7684\u4eca\u5929\uff0c\u66fe\u7ecf\u4ee4\u4eba\u60ca\u53f9\u7684\u524d\u7aef\u8def\u7531\u5df2\u7ecf\u6210\u4e3a\u5404\u5927\u6846\u67b6\u7684\u57fa\u7840\u6807\u914d\uff0c\u6bcf\u4e2a\u6846\u67b6\u90fd\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8def\u7531\u529f\u80fd\uff0c\u5bfc\u81f4\u8def\u7531\u5b9e\u73b0\u53d8\u7684\u590d\u6742\u3002\u60f3\u8981\u641e\u61c2\u8def\u7531\u5185\u90e8\u5b9e\u73b0\u8fd8\u662f\u6709\u4e9b\u56f0\u96be\u7684\uff0c\u4f46\u662f\u5982\u679c\u53ea\u60f3\u4e86\u89e3\u8def\u7531\u5b9e\u73b0\u57fa\u672c\u539f\u7406\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\u672c\u6587\u9488\u5bf9\u524d\u7aef\u8def\u7531\u4e3b\u6d41\u7684\u5b9e\u73b0\u65b9\u5f0f hash \u548c history\uff0c\u63d0\u4f9b\u4e86\u539f\u751fJS/React/Vue \u5171\u8ba1\u516d\u4e2a\u7248\u672c\u4f9b\u53c2\u8003\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u5b9e\u73b0\u4ee3\u7801\u7ea6 25~40 \u884c\u5de6\u53f3\uff08\u542b\u7a7a\u884c\uff09\u3002","date":"2019-03-12T00:00:00.000Z","formattedDate":"March 12, 2019","tags":[{"label":"Web Frontend","permalink":"/blog/tags/web-frontend"}],"readingTime":9.185,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Web Frontend"],"keywords":["router","react","vue","vanilla"]},"prevItem":{"title":"JavaScript \u9879\u76ee\u5fc5\u5907\u914d\u7f6e","permalink":"/blog/2019/07/30/setup-js-project"},"nextItem":{"title":"Vue \u751f\u547d\u5468\u671f\u68b3\u7406","permalink":"/blog/2018/12/10/vue-component-lifecycle"}},"content":">\u5728\u5355\u9875\u5e94\u7528\u5982\u6b64\u6d41\u884c\u7684\u4eca\u5929\uff0c\u66fe\u7ecf\u4ee4\u4eba\u60ca\u53f9\u7684\u524d\u7aef\u8def\u7531\u5df2\u7ecf\u6210\u4e3a\u5404\u5927\u6846\u67b6\u7684\u57fa\u7840\u6807\u914d\uff0c\u6bcf\u4e2a\u6846\u67b6\u90fd\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8def\u7531\u529f\u80fd\uff0c\u5bfc\u81f4\u8def\u7531\u5b9e\u73b0\u53d8\u7684\u590d\u6742\u3002\u60f3\u8981\u641e\u61c2\u8def\u7531\u5185\u90e8\u5b9e\u73b0\u8fd8\u662f\u6709\u4e9b\u56f0\u96be\u7684\uff0c\u4f46\u662f\u5982\u679c\u53ea\u60f3\u4e86\u89e3\u8def\u7531\u5b9e\u73b0\u57fa\u672c\u539f\u7406\u8fd8\u662f\u6bd4\u8f83\u7b80\u5355\u7684\u3002\u672c\u6587\u9488\u5bf9\u524d\u7aef\u8def\u7531\u4e3b\u6d41\u7684\u5b9e\u73b0\u65b9\u5f0f hash \u548c history\uff0c\u63d0\u4f9b\u4e86\u539f\u751fJS/React/Vue \u5171\u8ba1\u516d\u4e2a\u7248\u672c\u4f9b\u53c2\u8003\uff0c\u6bcf\u4e2a\u7248\u672c\u7684\u5b9e\u73b0\u4ee3\u7801\u7ea6 25~40 \u884c\u5de6\u53f3\uff08\u542b\u7a7a\u884c\uff09\u3002\\n\x3c!--truncate--\x3e\\n## \u4ec0\u4e48\u662f\u524d\u7aef\u8def\u7531\uff1f\\n\\n\u8def\u7531\u7684\u6982\u5ff5\u6765\u6e90\u4e8e\u670d\u52a1\u7aef\uff0c\u5728\u670d\u52a1\u7aef\u4e2d\u8def\u7531\u63cf\u8ff0\u7684\u662f URL \u4e0e\u5904\u7406\u51fd\u6570\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002\\n\\n\u5728 Web \u524d\u7aef\u5355\u9875\u5e94\u7528 SPA(Single Page Application)\u4e2d\uff0c\u8def\u7531\u63cf\u8ff0\u7684\u662f URL \u4e0e UI \u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u8fd9\u79cd\u6620\u5c04\u662f\u5355\u5411\u7684\uff0c\u5373 URL \u53d8\u5316\u5f15\u8d77 UI \u66f4\u65b0\uff08\u65e0\u9700\u5237\u65b0\u9875\u9762\uff09\u3002\\n\\n## \u5982\u4f55\u5b9e\u73b0\u524d\u7aef\u8def\u7531\uff1f\\n\\n\u8981\u5b9e\u73b0\u524d\u7aef\u8def\u7531\uff0c\u9700\u8981\u89e3\u51b3\u4e24\u4e2a\u6838\u5fc3\u95ee\u9898\uff1a\\n1. \u5982\u4f55\u6539\u53d8 URL \u5374\u4e0d\u5f15\u8d77\u9875\u9762\u5237\u65b0\uff1f\\n2. \u5982\u4f55\u68c0\u6d4b URL \u53d8\u5316\u4e86\uff1f\\n\\n\u4e0b\u9762\u5206\u522b\u4f7f\u7528 hash \u548c history \u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\u56de\u7b54\u4e0a\u9762\u7684\u4e24\u4e2a\u6838\u5fc3\u95ee\u9898\u3002\\n\\n**hash \u5b9e\u73b0**\\n1. hash \u662f URL \u4e2d hash (`#`) \u53ca\u540e\u9762\u7684\u90a3\u90e8\u5206\uff0c\u5e38\u7528\u4f5c\u951a\u70b9\u5728\u9875\u9762\u5185\u8fdb\u884c\u5bfc\u822a\uff0c\u6539\u53d8 URL \u4e2d\u7684 hash \u90e8\u5206\u4e0d\u4f1a\u5f15\u8d77\u9875\u9762\u5237\u65b0\\n2. \u901a\u8fc7 [hashchange](https://developer.mozilla.org/en-US/docs/Web/API/Window/hashchange_event) \u4e8b\u4ef6\u76d1\u542c URL \u7684\u53d8\u5316\uff0c\u6539\u53d8 URL \u7684\u65b9\u5f0f\u53ea\u6709\u8fd9\u51e0\u79cd\uff1a\u901a\u8fc7\u6d4f\u89c8\u5668\u524d\u8fdb\u540e\u9000\u6539\u53d8 URL\u3001\u901a\u8fc7`<a>`\u6807\u7b7e\u6539\u53d8 URL\u3001\u901a\u8fc7`window.location`\u6539\u53d8URL\uff0c\u8fd9\u51e0\u79cd\u60c5\u51b5\u6539\u53d8 URL \u90fd\u4f1a\u89e6\u53d1 hashchange \u4e8b\u4ef6\\n\\n**history \u5b9e\u73b0**\\n1. history \u63d0\u4f9b\u4e86 pushState \u548c replaceState \u4e24\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u6539\u53d8 URL \u7684 path \u90e8\u5206\u4e0d\u4f1a\u5f15\u8d77\u9875\u9762\u5237\u65b0\\n2. history \u63d0\u4f9b\u7c7b\u4f3c hashchange \u4e8b\u4ef6\u7684 [popstate](https://developer.mozilla.org/en-US/docs/Web/API/Window/popstate_event) \u4e8b\u4ef6\uff0c\u4f46 popstate \u4e8b\u4ef6\u6709\u4e9b\u4e0d\u540c\uff1a\u901a\u8fc7\u6d4f\u89c8\u5668\u524d\u8fdb\u540e\u9000\u6539\u53d8 URL \u65f6\u4f1a\u89e6\u53d1 popstate \u4e8b\u4ef6\uff0c\u901a\u8fc7`pushState/replaceState`\u6216`<a>`\u6807\u7b7e\u6539\u53d8 URL \u4e0d\u4f1a\u89e6\u53d1 popstate \u4e8b\u4ef6\u3002\u597d\u5728\u6211\u4eec\u53ef\u4ee5\u62e6\u622a `pushState/replaceState`\u7684\u8c03\u7528\u548c`<a>`\u6807\u7b7e\u7684\u70b9\u51fb\u4e8b\u4ef6\u6765\u68c0\u6d4b URL \u53d8\u5316\uff0c\u6240\u4ee5\u76d1\u542c URL \u53d8\u5316\u53ef\u4ee5\u5b9e\u73b0\uff0c\u53ea\u662f\u6ca1\u6709 hashchange \u90a3\u4e48\u65b9\u4fbf\u3002\\n\\n## \u539f\u751fJS\u7248\u524d\u7aef\u8def\u7531\u5b9e\u73b0\\n\\n\u57fa\u4e8e\u4e0a\u8282\u8ba8\u8bba\u7684\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5206\u522b\u5b9e\u73b0 hash \u7248\u672c\u548c history \u7248\u672c\u7684\u8def\u7531\uff0c\u793a\u4f8b\u4f7f\u7528\u539f\u751f HTML/JS \u5b9e\u73b0\uff0c\u4e0d\u4f9d\u8d56\u4efb\u4f55\u6846\u67b6\u3002 \\n\\n### \u57fa\u4e8e hash \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n![](vanilla-hash.png)\\n\\nHTML \u90e8\u5206\uff1a\\n```html\\n<body>\\n  <ul>\\n    \x3c!-- \u5b9a\u4e49\u8def\u7531 --\x3e\\n    <li><a href=\\"#/home\\">home</a></li>\\n    <li><a href=\\"#/about\\">about</a></li>\\n\\n    \x3c!-- \u6e32\u67d3\u8def\u7531\u5bf9\u5e94\u7684 UI --\x3e\\n    <div id=\\"routeView\\"></div>\\n  </ul>\\n</body>\\n```\\nJavaScript \u90e8\u5206\uff1a\\n```js\\n// \u9875\u9762\u52a0\u8f7d\u5b8c\u4e0d\u4f1a\u89e6\u53d1 hashchange\uff0c\u8fd9\u91cc\u4e3b\u52a8\u89e6\u53d1\u4e00\u6b21 hashchange \u4e8b\u4ef6\\nwindow.addEventListener(\'DOMContentLoaded\', onLoad)\\n// \u76d1\u542c\u8def\u7531\u53d8\u5316\\nwindow.addEventListener(\'hashchange\', onHashChange)\\n\\n// \u8def\u7531\u89c6\u56fe\\nvar routerView = null\\n\\nfunction onLoad () {\\n  routerView = document.querySelector(\'#routeView\')\\n  onHashChange()\\n}\\n\\n// \u8def\u7531\u53d8\u5316\u65f6\uff0c\u6839\u636e\u8def\u7531\u6e32\u67d3\u5bf9\u5e94 UI\\nfunction onHashChange () {\\n  switch (location.hash) {\\n    case \'#/home\':\\n      routerView.innerHTML = \'Home\'\\n      return\\n    case \'#/about\':\\n      routerView.innerHTML = \'About\'\\n      return\\n    default:\\n      return\\n  }\\n}\\n```\\n\\n### \u57fa\u4e8e history \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n![](vanilla-history.png)\\n\\nHTML \u90e8\u5206\uff1a\\n```html\\n<body>\\n  <ul>\\n    <li><a href=\'/home\'>home</a></li>\\n    <li><a href=\'/about\'>about</a></li>\\n\\n    <div id=\\"routeView\\"></div>\\n  </ul>\\n</body>\\n```\\n\\nJavaScript \u90e8\u5206\uff1a\\n```js\\n// \u9875\u9762\u52a0\u8f7d\u5b8c\u4e0d\u4f1a\u89e6\u53d1 hashchange\uff0c\u8fd9\u91cc\u4e3b\u52a8\u89e6\u53d1\u4e00\u6b21 hashchange \u4e8b\u4ef6\\nwindow.addEventListener(\'DOMContentLoaded\', onLoad)\\n// \u76d1\u542c\u8def\u7531\u53d8\u5316\\nwindow.addEventListener(\'popstate\', onPopState)\\n\\n// \u8def\u7531\u89c6\u56fe\\nvar routerView = null\\n\\nfunction onLoad () {\\n  routerView = document.querySelector(\'#routeView\')\\n  onPopState()\\n\\n  // \u62e6\u622a <a> \u6807\u7b7e\u70b9\u51fb\u4e8b\u4ef6\u9ed8\u8ba4\u884c\u4e3a\uff0c \u70b9\u51fb\u65f6\u4f7f\u7528 pushState \u4fee\u6539 URL\u5e76\u66f4\u65b0\u624b\u52a8 UI\uff0c\u4ece\u800c\u5b9e\u73b0\u70b9\u51fb\u94fe\u63a5\u66f4\u65b0 URL \u548c UI \u7684\u6548\u679c\u3002\\n  var linkList = document.querySelectorAll(\'a[href]\')\\n  linkList.forEach(el => el.addEventListener(\'click\', function (e) {\\n    e.preventDefault()\\n    history.pushState(null, \'\', el.getAttribute(\'href\'))\\n    onPopState()\\n  }))\\n}\\n\\n// \u8def\u7531\u53d8\u5316\u65f6\uff0c\u6839\u636e\u8def\u7531\u6e32\u67d3\u5bf9\u5e94 UI\\nfunction onPopState () {\\n  switch (location.pathname) {\\n    case \'/home\':\\n      routerView.innerHTML = \'Home\'\\n      return\\n    case \'/about\':\\n      routerView.innerHTML = \'About\'\\n      return\\n    default:\\n      return\\n  }\\n}\\n```\\n\\n## React \u7248\u524d\u7aef\u8def\u7531\u5b9e\u73b0\\n\\n### \u57fa\u4e8e hash \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n\\n![](react-hash.png)\\n\\n\u4f7f\u7528\u65b9\u5f0f\u548c react-router \u7c7b\u4f3c\uff1a\\n```jsx\\n  <BrowserRouter>\\n    <ul>\\n      <li>\\n        <Link to=\\"/home\\">home</Link>\\n      </li>\\n      <li>\\n        <Link to=\\"/about\\">about</Link>\\n      </li>\\n    </ul>\\n\\n    <Route path=\\"/home\\" render={() => <h2>Home</h2>} />\\n    <Route path=\\"/about\\" render={() => <h2>About</h2>} />\\n  </BrowserRouter>\\n```\\n\\nBrowserRouter \u5b9e\u73b0\\n```jsx\\nexport default class BrowserRouter extends React.Component {\\n  state = {\\n    currentPath: utils.extractHashPath(window.location.href)\\n  };\\n\\n  onHashChange = e => {\\n    const currentPath = utils.extractHashPath(e.newURL);\\n    console.log(\\"onHashChange:\\", currentPath);\\n    this.setState({ currentPath });\\n  };\\n\\n  componentDidMount() {\\n    window.addEventListener(\\"hashchange\\", this.onHashChange);\\n  }\\n\\n  componentWillUnmount() {\\n    window.removeEventListener(\\"hashchange\\", this.onHashChange);\\n  }\\n\\n  render() {\\n    return (\\n      <RouteContext.Provider value={{currentPath: this.state.currentPath}}>\\n        {this.props.children}\\n      </RouteContext.Provider>\\n    );\\n  }\\n}\\n```\\n\\nRoute \u5b9e\u73b0\\n```jsx\\nexport default ({ path, render }) => (\\n  <RouteContext.Consumer>\\n    {({currentPath}) => currentPath === path && render()}\\n  </RouteContext.Consumer>\\n);\\n```\\n\\nLink \u5b9e\u73b0\\n```jsx\\nexport default ({ to, ...props }) => <a {...props} href={\\"#\\" + to} />;\\n```\\n\\n### \u57fa\u4e8e history \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n![](react-history.png)\\n\\n\u4f7f\u7528\u65b9\u5f0f\u548c react-router \u7c7b\u4f3c\uff1a\\n```jsx\\n  <HistoryRouter>\\n    <ul>\\n      <li>\\n        <Link to=\\"/home\\">home</Link>\\n      </li>\\n      <li>\\n        <Link to=\\"/about\\">about</Link>\\n      </li>\\n    </ul>\\n\\n    <Route path=\\"/home\\" render={() => <h2>Home</h2>} />\\n    <Route path=\\"/about\\" render={() => <h2>About</h2>} />\\n  </HistoryRouter>\\n```\\n\\nHistoryRouter \u5b9e\u73b0\\n```jsx\\nexport default class HistoryRouter extends React.Component {\\n  state = {\\n    currentPath: utils.extractUrlPath(window.location.href)\\n  };\\n\\n  onPopState = e => {\\n    const currentPath = utils.extractUrlPath(window.location.href);\\n    console.log(\\"onPopState:\\", currentPath);\\n    this.setState({ currentPath });\\n  };\\n\\n  componentDidMount() {\\n    window.addEventListener(\\"popstate\\", this.onPopState);\\n  }\\n\\n  componentWillUnmount() {\\n    window.removeEventListener(\\"popstate\\", this.onPopState);\\n  }\\n\\n  render() {\\n    return (\\n      <RouteContext.Provider value={{currentPath: this.state.currentPath, onPopState: this.onPopState}}>\\n        {this.props.children}\\n      </RouteContext.Provider>\\n    );\\n  }\\n}\\n```\\n\\nRoute \u5b9e\u73b0\\n```jsx\\nexport default ({ path, render }) => (\\n  <RouteContext.Consumer>\\n    {({currentPath}) => currentPath === path && render()}\\n  </RouteContext.Consumer>\\n);\\n```\\n\\nLink \u5b9e\u73b0\\n```jsx\\nexport default ({ to, ...props }) => (\\n  <RouteContext.Consumer>\\n    {({ onPopState }) => (\\n      <a\\n        href=\\"\\"\\n        {...props}\\n        onClick={e => {\\n          e.preventDefault();\\n          window.history.pushState(null, \\"\\", to);\\n          onPopState();\\n        }}\\n      />\\n    )}\\n  </RouteContext.Consumer>\\n);\\n```\\n\\n## Vue \u7248\u672c\u524d\u7aef\u8def\u7531\u5b9e\u73b0\\n\\n### \u57fa\u4e8e hash \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n![](vue-hash.png)\\n\\n\u4f7f\u7528\u65b9\u5f0f\u548c vue-router \u7c7b\u4f3c\uff08vue-router \u901a\u8fc7\u63d2\u4ef6\u673a\u5236\u6ce8\u5165\u8def\u7531\uff0c\u4f46\u662f\u8fd9\u6837\u9690\u85cf\u4e86\u5b9e\u73b0\u7ec6\u8282\uff0c\u4e3a\u4e86\u4fdd\u6301\u4ee3\u7801\u76f4\u89c2\uff0c\u8fd9\u91cc\u6ca1\u6709\u4f7f\u7528 Vue \u63d2\u4ef6\u5c01\u88c5\uff09\uff1a\\n```html\\n    <div>\\n      <ul>\\n        <li><router-link to=\\"/home\\">home</router-link></li>\\n        <li><router-link to=\\"/about\\">about</router-link></li>\\n      </ul>\\n      <router-view></router-view>\\n    </div>\\n```\\n\\n```js\\nconst routes = {\\n  \'/home\': {\\n    template: \'<h2>Home</h2>\'\\n  },\\n  \'/about\': {\\n    template: \'<h2>About</h2>\'\\n  }\\n}\\n\\nconst app = new Vue({\\n  el: \'.vue.hash\',\\n  components: {\\n    \'router-view\': RouterView,\\n    \'router-link\': RouterLink\\n  },\\n  beforeCreate () {\\n    this.$routes = routes\\n  }\\n})\\n```\\n\\nrouter-view \u5b9e\u73b0\\n```html\\n<template>\\n  <component :is=\\"routeView\\" />\\n</template>\\n\\n<script>\\nimport utils from \'~/utils.js\'\\nexport default {\\n  data () {\\n    return {\\n      routeView: null\\n    }\\n  },\\n  created () {\\n    this.boundHashChange = this.onHashChange.bind(this)\\n  },\\n  beforeMount () {\\n    window.addEventListener(\'hashchange\', this.boundHashChange)\\n  },\\n  mounted () {\\n    this.onHashChange()\\n  },\\n  beforeDestroy() {\\n    window.removeEventListener(\'hashchange\', this.boundHashChange)\\n  },\\n  methods: {\\n    onHashChange () {\\n      const path = utils.extractHashPath(window.location.href)\\n      this.routeView = this.$root.$routes[path] || null\\n      console.log(\'vue:hashchange:\', path)\\n    }\\n  }\\n}\\n<\/script>\\n```\\n\\nrouter-link \u5b9e\u73b0\\n```html\\n<template>\\n  <a @click.prevent=\\"onClick\\" href=\'\'><slot></slot></a>\\n</template>\\n\\n<script>\\nexport default {\\n  props: {\\n    to: String\\n  },\\n  methods: {\\n    onClick () {\\n      window.location.hash = \'#\' + this.to\\n    }\\n  }\\n}\\n<\/script>\\n```\\n\\n### \u57fa\u4e8e history \u5b9e\u73b0\\n\\n\u8fd0\u884c\u6548\u679c\uff1a\\n![](vue-history.png)\\n\\n\u4f7f\u7528\u65b9\u5f0f\u548c vue-router \u7c7b\u4f3c\uff1a\\n```html\\n    <div>\\n      <ul>\\n        <li><router-link to=\\"/home\\">home</router-link></li>\\n        <li><router-link to=\\"/about\\">about</router-link></li>\\n      </ul>\\n      <router-view></router-view>\\n    </div>\\n```\\n\\n```js\\nconst routes = {\\n  \'/home\': {\\n    template: \'<h2>Home</h2>\'\\n  },\\n  \'/about\': {\\n    template: \'<h2>About</h2>\'\\n  }\\n}\\n\\nconst app = new Vue({\\n  el: \'.vue.history\',\\n  components: {\\n    \'router-view\': RouterView,\\n    \'router-link\': RouterLink\\n  },\\n  created () {\\n    this.$routes = routes\\n    this.boundPopState = this.onPopState.bind(this)\\n  },\\n  beforeMount () {\\n    window.addEventListener(\'popstate\', this.boundPopState) \\n  },\\n  beforeDestroy () {\\n    window.removeEventListener(\'popstate\', this.boundPopState) \\n  },\\n  methods: {\\n    onPopState (...args) {\\n      this.$emit(\'popstate\', ...args)\\n    }\\n  }\\n})\\n```\\n\\nrouter-view \u5b9e\u73b0\uff1a\\n```html\\n<template>\\n  <component :is=\\"routeView\\" />\\n</template>\\n\\n<script>\\nimport utils from \'~/utils.js\'\\nexport default {\\n  data () {\\n    return {\\n      routeView: null\\n    }\\n  },\\n  created () {\\n    this.boundPopState = this.onPopState.bind(this)\\n  },\\n  beforeMount () {\\n    this.$root.$on(\'popstate\', this.boundPopState)\\n  },\\n  beforeDestroy() {\\n    this.$root.$off(\'popstate\', this.boundPopState)\\n  },\\n  methods: {\\n    onPopState (e) {\\n      const path = utils.extractUrlPath(window.location.href)\\n      this.routeView = this.$root.$routes[path] || null\\n      console.log(\'[Vue] popstate:\', path)\\n    }\\n  }\\n}\\n<\/script>\\n```\\n\\nrouter-link \u5b9e\u73b0\\n```html\\n<template>\\n  <a @click.prevent=\\"onClick\\" href=\'\'><slot></slot></a>\\n</template>\\n\\n<script>\\nexport default {\\n  props: {\\n    to: String\\n  },\\n  methods: {\\n    onClick () {\\n      history.pushState(null, \'\', this.to)\\n      this.$root.$emit(\'popstate\')\\n    }\\n  }\\n}\\n<\/script>\\n```\\n\\n## \u5c0f\u7ed3\\n\\n\u524d\u7aef\u8def\u7531\u7684\u6838\u5fc3\u5b9e\u73b0\u539f\u7406\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u7ed3\u5408\u5177\u4f53\u6846\u67b6\u540e\uff0c\u6846\u67b6\u589e\u52a0\u4e86\u5f88\u591a\u7279\u6027\uff0c\u5982\u52a8\u6001\u8def\u7531\u3001\u8def\u7531\u53c2\u6570\u3001\u8def\u7531\u52a8\u753b\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5bfc\u81f4\u8def\u7531\u5b9e\u73b0\u53d8\u7684\u590d\u6742\u3002\u672c\u6587\u53bb\u7c97\u53d6\u7cbe\u53ea\u9488\u5bf9\u524d\u7aef\u8def\u7531\u6700\u6838\u5fc3\u90e8\u5206\u7684\u5b9e\u73b0\u8fdb\u884c\u5206\u6790\uff0c\u5e76\u57fa\u4e8e hash \u548c history \u4e24\u79cd\u6a21\u5f0f\uff0c\u5206\u522b\u63d0\u4f9b\u539f\u751fJS/React/Vue \u4e09\u79cd\u5b9e\u73b0\uff0c\u5171\u8ba1\u516d\u4e2a\u5b9e\u73b0\u7248\u672c\u4f9b\u53c2\u8003\uff0c\u5e0c\u671b\u5bf9\u4f60\u6709\u6240\u5e2e\u52a9\u3002\\n\\n\u6240\u6709\u7684\u793a\u4f8b\u7684\u4ee3\u7801\u653e\u5728 Github \u4ed3\u5e93\uff1ahttps://github.com/whinc/web-router-principle\\n\\n## \u53c2\u8003\\n* [\u8be6\u89e3\u5355\u9875\u9762\u8def\u7531\u7684\u51e0\u79cd\u5b9e\u73b0\u539f\u7406](http://www.cnblogs.com/xiaobie123/p/6357724.html)\\n* [\u5355\u9875\u9762\u5e94\u7528\u8def\u7531\u5b9e\u73b0\u539f\u7406\uff1a\u4ee5 React-Router \u4e3a\u4f8b](https://github.com/youngwind/blog/issues/109)"},{"id":"/2018/12/10/vue-component-lifecycle","metadata":{"permalink":"/blog/2018/12/10/vue-component-lifecycle","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/12-10-vue-component-lifecycle/index.md","source":"@site/blog/2018/12-10-vue-component-lifecycle/index.md","title":"Vue \u751f\u547d\u5468\u671f\u68b3\u7406","description":"\u76ee\u5f55","date":"2018-12-10T00:00:00.000Z","formattedDate":"December 10, 2018","tags":[{"label":"Vue","permalink":"/blog/tags/vue"}],"readingTime":11.945,"hasTruncateMarker":true,"authors":[],"frontMatter":{"tags":["Vue"],"keywords":["vue component lifecycle","vue\u7ec4\u4ef6\u751f\u547d\u5468\u671f"]},"prevItem":{"title":"Web \u524d\u7aef\u8def\u7531\u539f\u7406\u89e3\u6790\u548c\u5b9e\u73b0","permalink":"/blog/2019/03/12/web-router-principle"},"nextItem":{"title":"H5 \u548c\u5c0f\u7a0b\u5e8f\u62cd\u7167\u56fe\u7247\u65cb\u8f6c\u3001\u538b\u7f29\u548c\u4e0a\u4f20","permalink":"/blog/2018/09/29/take-photo-by-based-on-h5-miniprogram"}},"content":"**\u76ee\u5f55**\\n1. \u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n1. \u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n1. \u4f7f\u7528 keep-alive \u540e\u7684\u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n1. \u4f7f\u7528 keep-alive \u540e\u7684\u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n1. \u5c0f\u7ed3\\n\\n\u7ec4\u4ef6\u5316\u601d\u7ef4\u73b0\u5728\u5df2\u5f97\u5230\u5e7f\u6cdb\u7684\u8ba4\u53ef\uff0cVue \u662f\u56f4\u7ed5\u7ec4\u4ef6\u5316\u6784\u7b51\u8d77\u6765\u7684\u6846\u67b6\u3002\u76f8\u6bd4\u4f20\u7edf\u547d\u4ee4\u5f0f DOM \u64cd\u4f5c\u9700\u8981\u624b\u52a8\u68c0\u67e5\u548c\u5904\u7406 DOM \u53d8\u5316\uff0cVue \u4ee5\u7ec4\u4ef6\u4e3a\u5355\u4f4d\uff0c\u4f7f\u7528\u54cd\u5e94\u5f0f\u6570\u636e\u81ea\u52a8\u66f4\u65b0 DOM\uff0c\u5728\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u4e2d\u5904\u7406\u6570\u636e\u548c DOM \u53d8\u5316\u7684\u5404\u4e2a\u9636\u6bb5\u3002\u57fa\u4e8e Vue \u6784\u5efa\u7684\u4ea4\u4e92\u754c\u9762\u59cb\u4e8e\u4e00\u4e2a\u6839\u7ec4\u4ef6\uff0c\u5c06\u7ec4\u4ef6\u6709\u7ec4\u7ec7\u7684\u5c42\u5c42\u5d4c\u5957\u5f62\u6210\u4e00\u9897\u7ec4\u4ef6\u6811\u6784\u5efa\u8d77\u590d\u6742\u7684\u7f51\u9875\u5e94\u7528\u3002\u7ec4\u4ef6\u5c42\u5c42\u5d4c\u5957\u540e\uff0c\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u8c03\u7528\u7684\u987a\u5e8f\u53d8\u5f97\u5f88\u91cd\u8981\uff0c\u5c24\u5176\u5728\u5904\u7406\u4e00\u4e9b\u9700\u8981\u7236\u5b50\u7ec4\u4ef6\u8054\u52a8\u7684\u573a\u666f\u3002\u672c\u6587\u5148\u5206\u6790\u5355\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7684\u6267\u884c\u65f6\u673a\uff0c\u518d\u8003\u8651\u5b58\u5728\u7236\u5b50\u7ec4\u4ef6\u65f6\uff0c\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7684\u6267\u884c\u987a\u5e8f\u53d8\u5316\u3002\\n\\n\x3c!--truncate--\x3e\\n## \u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n\\n\u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u53c2\u8003 [Vue \u5b98\u7f51](https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA)\uff0c\u719f\u6089\u5355\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u65f6\u673a\u548c\u884c\u4e3a\uff0c\u6709\u5229\u4e8e\u540e\u7eed\u9762\u5bf9\u590d\u6742\u751f\u547d\u5468\u671f\u6267\u884c\u987a\u5e8f\u65f6\u4fdd\u6301\u6e05\u9192\u3002\\n![vue_lifecycle](https://cn.vuejs.org/images/lifecycle.png)\\n\\n**beforeCreate**\\n\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u5b9e\u4f8b\u5316\u4e4b\u540e\uff0c\u6570\u636e\u89c2\u6d4b (data observer) \u548c event/watcher \u4e8b\u4ef6\u914d\u7f6e\u4e4b\u524d\u3002\u6b64\u65f6\u6570\u636e\u8fd8\u4e0d\u662f\u54cd\u5e94\u5f0f\uff0c\u66f4\u65b0 data \u6570\u636e\u662f\u65e0\u6548\u7684\uff0c\u4e5f\u65e0\u6cd5\u8bbf\u95ee DOM\u3002\\n```js\\n data () {\\n    return {\\n      count: 0\\n    }\\n  },\\n  beforeCreate() {\\n    this.count = 10;\\n    console.log(\\"beforeCreate\\", this.$el); // beforeCreate undefined\\n  },\\n  created() {\\n    console.log(\\"created\\", this.count); // created 0\\n  }\\n\\n```\\n\\n**created**\\n\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u5b9e\u4f8b\u521b\u5efa\u4e4b\u540e\uff0c\u5df2\u5b8c\u6210\u914d\u7f6e\uff1a\u6570\u636e\u89c2\u6d4b (data observer)\u3001\u8ba1\u7b97\u5c5e\u6027\u3001\u65b9\u6cd5\u3001watch/event \u4e8b\u4ef6\u56de\u8c03\u3002\u6b64\u65f6\u6570\u636e\u662f\u54cd\u5e94\u5f0f\uff0c\u4e0d\u80fd\u8bbf\u95ee DOM\u3002\u7f51\u7edc\u6570\u636e\u8bf7\u6c42\u64cd\u4f5c\u9002\u5408\u653e\u5728\u6b64\u5904\u3002\\n\\n```js\\n data () {\\n    return {\\n      count: 0\\n    }\\n  }\\n  created() {\\n    this.count = 10;\\n    console.log(\\"created\\", this.$el); // created undefined\\n  }\\n  mounted() {\\n    console.log(\\"mounted\\", this.count);    // mounted 10\\n  }\\n```\\n\\n**beforeMount**\\n\u53d1\u751f\u5728 DOM \u6302\u8f7d\u4e4b\u524d\u3002\u6b64\u65f6\u6a21\u677f\u6216\u6e32\u67d3\u51fd\u6570\u5df2\u7ecf\u7f16\u8bd1\u597d\uff0c\u76f8\u5173\u7684 render \u51fd\u6570\u9996\u6b21\u88ab\u8c03\u7528\uff0c\u4e0d\u80fd\u8bbf\u95ee DOM\u3002\\n```js\\n  beforeMount() {\\n    console.log(\\"beforeMount\\", this.$el); // beforeMount undefined\\n  }\\n```\\n\\n**mounted**\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u6302\u8f7d\u5230 DOM \u4e4b\u540e\u3002\u6b64\u65f6\u53ef\u4ee5\u8bbf\u95ee DOM \u8282\u70b9\uff0c\u4f8b\u5982`this.$el`\uff0cDOM \u76f8\u5173\u7684\u64cd\u4f5c\u9002\u5408\u653e\u5728\u6b64\u5904\u3002\\n\\n```js\\n  mounted() {\\n    console.log(\\"mounted\\", this.$el); // mounted <div id=\\"app\\"></div>\\n  }\\n```\\n\\n**beforeUpdate**\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u6570\u636e\u53d8\u5316\u4e4b\u540e DOM \u66f4\u65b0\u4e4b\u524d\u3002\u6b64\u65f6\u8bbf\u95ee DOM \u662f\u6570\u636e\u53d8\u5316\u524d\u5bf9\u5e94\u7684 DOM\u3002\\n```html\\n<template>\\n  <span ref=\\"count\\">{{ count }}</span>\\n</template>\\n```\\n```js\\n data () {\\n    return {\\n      count: 0\\n    }\\n  },\\n  mounted() {\\n    this.count = 10;\\n  },\\n  // \u6570\u636e\u53d8\u5316\u4f46 DOM \u5c1a\u672a\u66f4\u65b0\uff0c\u83b7\u53d6\u7684 DOM \u6570\u636e\u4e0d\u662f\u6700\u65b0\u7684\\n  beforeUpdate() {\\n    console.log(\\"beforeUpdate\\", this.count, this.$refs.count.textContent); // beforeUpdate 10 0\\n  },\\n```\\n\\n**updated**\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u6570\u636e\u53d8\u5316\u5bfc\u81f4\u7684 DOM \u66f4\u65b0\u4e4b\u540e\u3002\u6b64\u65f6\u53ef\u8bbf\u95ee\u66f4\u65b0\u540e\u7684 DOM \u8282\u70b9\uff0cDOM \u4e0e data \u6570\u636e\u4e00\u81f4\u3002\\n\\n```html\\n<template>\\n  <span ref=\\"count\\">{{ count }}</span>\\n</template>\\n```\\n```js\\n data () {\\n    return {\\n      count: 0\\n    }\\n  },\\n  mounted() {\\n    this.count = 10;\\n  },\\n  beforeUpdate() {\\n    console.log(\\"beforeUpdate\\", this.count, this.$refs.count.textContent); // beforeUpdate 10 0\\n  },\\n  // \u6570\u636e\u53d8\u5316\u4e14 DOM \u5df2\u66f4\u65b0\uff0c\u83b7\u53d6\u7684 DOM \u6570\u636e\u662f\u6700\u65b0\u7684\\n  updated() {\\n    console.log(\\"updated\\", this.count, this.$refs.count.textContent); // beforeUpdate 10 10\\n  }\\n```\\n\\n**beforeDestroy**\\n\u53d1\u751f\u5728\u7ec4\u4ef6\u5b9e\u4f8b\u9500\u6bc1\u4e4b\u524d\u3002\u6b64\u65f6\u5b9e\u4f8b\u4ecd\u7136\u5b8c\u5168\u53ef\u7528\u3002\\n\\n**destroyed**\\n\u53d1\u751f\u7ec4\u4ef6\u5b9e\u4f8b\u9500\u6bc1\u4e4b\u540e\u3002\u6b64\u65f6\u7ec4\u4ef6\u6240\u6709\u4e1c\u897f\u90fd\u5df2\u89e3\u7ed1\uff0c\u6240\u6709\u7684\u4e8b\u4ef6\u76d1\u542c\u5668\u90fd\u5df2\u88ab\u79fb\u9664\uff0c\u8fd8\u80fd\u8bbf\u95ee DOM\u3002\\n```js\\n  data() {\\n    return {\\n      count: 0\\n    };\\n  },\\n  computed: {\\n    tenTimesCount() {\\n      return this.count * 10;\\n    }\\n  },\\n  // \u89e3\u9664\u6570\u636e\u54cd\u5e94\uff0c\u4fee\u6539\u6570\u636e\u540e\u8ba1\u7b97\u5c5e\u6027\u4e0d\u4f1a\u518d\u66f4\u65b0\u4e86\\n  destroyed() {\\n    this.count = 2;\\n    console.log(\\"destroyed\\", this.$el, this.count, this.tenTimesCount);  // destroyed <div id=\\"app\\"></div> 2 0\\n  }\\n```\\n\\n## \u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n\\n\u4e0b\u9762\u662f\u7236\u5b50\u7ec4\u4ef6\u60c5\u5f62\uff0c\u4ee5\u7236\u7ec4\u4ef6\u7684\u66f4\u65b0\u89c6\u89d2\u6574\u7406\u5468\u671f\u65b9\u6cd5\u6267\u884c\u5148\u540e\u987a\u5e8f\u5982\u4e0b\u56fe\u3002\\n```html\\n<Parent>\\n  <Child :count=\\"parentCount\\" />\\n</Parent>\\n```\\n\\n\u9996\u6b21\u52a0\u8f7d\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeCreate \\n[parent] created \\n[parent] beforeMount \\n[child ] beforeCreate \\n[child ] created \\n[child ] beforeMount \\n[child ] mounted \\n[parent] mounted \\n```\\n\u7236\u5b50\u7ec4\u4ef6\u540c\u65f6\u66f4\u65b0\u65f6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeUpdate \\n[child ] beforeUpdate \\n[child ] updated \\n[parent] updated \\n```\\n\u9500\u6bc1\u7236\u7ec4\u4ef6\u65f6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeDestroy \\n[child ] beforeDestroy \\n[child ] destroyed \\n[parent] destroyed \\n```\\n\\n\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u793a\u610f\u56fe\u8868\u793a\uff1a\\n![](https://github.com/whinc/blog/blob/master/assets/11/parent_child.png?raw=true)\\n\\n\u4ece\u56fe\u4e2d\u53ef\u77e5\uff1a\\n* \u521b\u5efa\u9636\u6bb5\uff0c\u5148\u6302\u8f7d\u5b50\u7ec4\u4ef6\u5230 DOM\uff0c\u518d\u6302\u8f7d\u7236\u7ec4\u4ef6\u5230 DOM\u3002\\n* \u66f4\u65b0\u9636\u6bb5\uff0c\u5148\u66f4\u65b0\u5b50\u7ec4\u4ef6\uff0c\u518d\u66f4\u65b0\u7236\u7ec4\u4ef6\u3002**\u6ce8\u610f**\uff0c\u7236\u5b50\u7ec4\u4ef6\u540c\u65f6\u5b58\u5728\u66f4\u65b0\u65f6\u624d\u6709\u8fd9\u4e2a\u987a\u5e8f\uff0c\u5982\u679c\u53ea\u6709\u7236\u7ec4\u4ef6\u66f4\u65b0\uff0c\u5219\u53ea\u89e6\u53d1\u7236\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e0d\u4f1a\u89e6\u53d1\u3002\\n* \u9500\u6bc1\u9636\u6bb5\uff1a\u5148\u9500\u6bc1\u5b50\u7ec4\u4ef6\uff0c\u518d\u9500\u6bc1\u7236\u7ec4\u4ef6\u3002\\n\\n\u6240\u4ee5\u603b\u7684\u6765\u8bf4\uff0c\u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u6267\u884c\u5148\u540e\u987a\u5e8f\u662f\uff1a**\u5148\u6267\u884c\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u518d\u6267\u884c\u7236\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5**\u3002\\n\\n## \u4f7f\u7528 keep-alive \u540e\u7684\u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n\\n\u4e0b\u9762\u662f\u5355\u7ec4\u4ef6\u88ab`<keep-alive>`\u5305\u88f9\u65f6\u7684\u60c5\u5f62\uff1a\\n```html\\n<keep-alive>\\n  <Comp/>\\n</keep-alive>\\n```\\n\\n\u4f7f\u7528`<keep-alive>`\u6307\u4ee4\u540e Vue \u4f1a\u4fdd\u5b58\u7ec4\u4ef6\u72b6\u6001\uff0c\u7ec4\u4ef6\u5207\u6362\u65f6\u4e0d\u4f1a\u89e6\u53d1\u9500\u6bc1\u548c\u91cd\u5efa\uff0c\u4e3a\u4e86\u66b4\u9732\u7ec4\u4ef6\u9690\u85cf\u548c\u663e\u793a\u7684\u65f6\u673a\uff0cVue \u5bf9`<keep-alive>`\u5305\u88f9\u7684\u5b50\u7ec4\u4ef6\u53ca\u540e\u4ee3\u7ec4\u4ef6\u65b0\u589e\u4e86\u4e00\u5bf9\u751f\u547d\u5468\u671f\u65b9\u6cd5`activated`\u548c`deactivated`\uff0c\u5206\u522b\u5728\u7ec4\u4ef6\u5207\u6362\u663e\u793a\u548c\u9690\u85cf\u65f6\u8c03\u7528\u3002\\n\\n\u4f7f\u7528`<keep-alive>`\u5305\u88f9\u540e\u7684\u5355\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u793a\u610f\u56fe\u5982\u4e0b\uff1a\\n![](keepalive_component.png)\\n\\n>\u6ce8\u610f\uff1a\u901a\u8fc7`v-show`\u5207\u6362\u7ec4\u4ef6\u4e0d\u4f1a\u89e6\u53d1`activated`\u548c`deactivated`\uff0c\u56e0\u4e3a`v-show`\u5e76\u4e0d\u4f1a\u89e6\u53d1\u7ec4\u4ef6\u7684\u9500\u6bc1\u548c\u91cd\u5efa\uff0c\u4ec5\u4ec5\u662f\u6837\u5f0f\u4e0a\u7684\u9690\u85cf\u548c\u663e\u793a\u3002\\n\\n## \u4f7f\u7528 keep-alive \u540e\u7684\u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\\n\\n**\u60c5\u5f62\u4e00\uff1a\u4ec5\u7236\u7ec4\u4ef6\u7531 keep-alive \u5305\u88f9\u4e14\u521d\u59cb\u65f6\u5b58\u5728**\\n\u4e0b\u9762\u4ee3\u7801\u6a21\u62df\u4e86\u5355\u9875\u8def\u7531\u4e14\u7f13\u5b58\u9875\u9762\u7684\u60c5\u5f62\uff0c\u7236\u7ec4\u4ef6\u901a\u8fc7`v-if`\u6a21\u62df\u9875\u9762\u5207\u6362\uff0c\u4f7f\u7528`<keep-alive>`\u5305\u88f9\u7236\u7ec4\u4ef6\u5b9e\u73b0\u9875\u9762\u72b6\u6001\u7f13\u5b58\uff0c\u7236\u5b50\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u5982\u4e0b\u3002\\n```html\\n<App>\\n  <keep-alive>\\n    <Parent v-if=\\"showParent\\">\\n      <Child></Child>\\n    </Parent>\\n  </keep-alive>\\n<App>\\n\\ndata () {\\n  return {\\n    showParent: true\\n  }\\n}\\n```\\n\\n\u9996\u6b21\u52a0\u8f7d\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeCreate \\n[parent] created \\n[parent] beforeMount \\n[child ] beforeCreate \\n[child ] created \\n[child ] beforeMount \\n[child ] mounted \\n[parent] mounted \\n[child ] activated \\n[parent] activated \\n```\\n\u8bbe\u7f6e`showParent`\u4e3a`false`\uff1a\\n```\\n[child ] deactivated \\n[parent] deactivated \\n```\\n\u8bbe\u7f6e`showParent`\u4e3a`true`\uff1a\\n```\\n[child ] activated \\n[parent] activated \\n```\\n\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u793a\u610f\u56fe\u8868\u793a\uff1a\\n![](keepalive_parent_child.png)\\n\\n\u5206\u6790\uff1a\u9996\u6b21\u52a0\u8f7d\u65f6\uff0c\u5148 mount \u5b50\u7ec4\u4ef6\uff0c\u7136\u540e mount \u7236\u7ec4\u4ef6\uff0c\u7136\u540e`<keep-alive>`\u7ec4\u4ef6\u89e6\u53d1 activated \u5468\u671f\u65b9\u6cd5\uff0c\u5148 activated \u5b50\u7ec4\u4ef6\u518d activated \u7236\u7ec4\u4ef6\u3002\u540e\u7eed\u7236\u7ec4\u4ef6\u5207\u6362\u65f6\uff0c\u7531\u4e8e\u88ab\u7f13\u5b58\u4e0d\u4f1a\u89e6\u53d1\u9500\u6bc1\u91cd\u5efa\uff0c\u53d6\u800c\u4ee3\u4e4b\u89e6\u53d1 activated \u548c deactivated \u5468\u671f\u65b9\u6cd5\uff0c\u4e5f\u662f\u5148 activated \u5b50\u7ec4\u4ef6\u518d activated \u7236\u7ec4\u4ef6\u3002\\n\\n**\u60c5\u5f62\u4e8c\uff1a\u4ec5\u7236\u7ec4\u4ef6\u7531 keep-alive \u5305\u88f9\u4e14\u521d\u59cb\u65f6\u5b50\u7ec4\u4ef6\u4e0d\u5b58\u5728**\\n\\n\u548c\u60c5\u5f62\u4e00\u7684\u5dee\u5f02\u662f\u521d\u59cb\u65f6\u7ec4\u4ef6\u4e0d\u5c55\u793a\uff0c\u7b49\u5f85\u8bf7\u6c42\u540e\u53f0\u6570\u636e\u540e\u518d\u5c55\u793a\uff0c\u8fd9\u662f\u4e1a\u52a1\u4e2d\u6bd4\u8f83\u5e38\u89c1\u7684\u60c5\u5f62\uff0c\u8be5\u60c5\u5f62\u4e0b\u7236\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u5982\u4e0b\u3002\\n```html\\n<App>\\n  <keep-alive>\\n    <Parent v-if=\\"showParent\\">\\n      <Child v-if=\\"showChild\\"></Child>\\n    </Parent>\\n  </keep-alive>\\n<App>\\n\\ndata () {\\n  return {\\n    showParent: true,\\n    showChild: false\\n  }\\n}\\nmounted () {\\n   // \u6a21\u62df\u6570\u636e\u8bf7\u6c42\uff0c2s\u540e\u663e\u793a\u5b50\u7ec4\u4ef6\\n  setTimeout(() => this.showChild = true, 2000)\\n}\\n```\\n\\n\u9996\u6b21\u52a0\u8f7d\u5e76\u7b49\u5f85\u6570\u636e\u52a0\u8f7d\u5b8c\u6bd5\uff0c\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeCreate \\n[parent] created \\n[parent] beforeMount \\n[parent] mounted \\n[parent] activated \\n[child ] beforeCreate \\n[child ] created \\n[child ] beforeMount \\n[child ] mounted \\n```\\n\\n\u8bbe\u7f6e`showParent`\u4e3a`false`\uff1a\\n```\\n[child ] deactivated \\n[parent] deactivated \\n```\\n\u8bbe\u7f6e`showParent`\u4e3a`true`\uff1a\\n```\\n[child ] activated \\n[parent] activated \\n```\\n\u6267\u884c\u987a\u5e8f\u7528\u793a\u610f\u56fe\u8868\u793a\uff1a\\n![](keepalive_parent_false_child.png)\\n\\n\u5206\u6790\uff1a\u9996\u6b21\u52a0\u8f7d\u65f6\uff0c\u5b50\u7ec4\u4ef6\u4e0d\u5b58\u5728\uff0c\u6240\u4ee5\u53ea\u6267\u884c\u7236\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5 mounted \u548c activated\uff0c\u7b49\u5f85\u8bf7\u6c42\u7684\u7f51\u7edc\u6570\u636e\u8fd4\u56de\u540e\u663e\u793a\u5b50\u7ec4\u4ef6\uff0c\u89e6\u53d1\u5b50\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5 mounted\u3002\u6ce8\u610f**\u5b50\u7ec4\u4ef6\u7684 activated \u65b9\u6cd5\u5728\u521b\u5efa\u65f6\u4e0d\u4f1a\u89e6\u53d1**\u3002\u540e\u7eed\u7236\u7ec4\u4ef6\u5207\u6362\u65f6\uff0c\u7531\u4e8e\u88ab\u7f13\u5b58\u4e0d\u4f1a\u89e6\u53d1\u9500\u6bc1\u91cd\u5efa\uff0c\u53d6\u800c\u4ee3\u4e4b\u89e6\u53d1 activated \u548c deactivated \u5468\u671f\u65b9\u6cd5\uff0c\u4e5f\u662f\u5148 activated \u5b50\u7ec4\u4ef6\u518d activated \u7236\u7ec4\u4ef6\u3002\\n\\n**\u60c5\u5f62\u4e09\uff1a\u7236\u5b50\u7ec4\u4ef6\u90fd\u7531 keep-alive \u5305\u88f9\u4e14\u521d\u59cb\u65f6\u5b58\u5728**\\n\u4e0b\u9762\u4ee3\u7801\u6a21\u62df\u4e86\u5355\u9875\u5d4c\u5957\u8def\u7531\u4e14\u7f13\u5b58\u9875\u9762\u7684\u60c5\u5f62\u3002\\n```html\\n<App>\\n  <keep-alive>\\n    <Parent v-if=\\"showParent\\">\\n      <keep-alive>\\n        <Child></Child>\\n      </keep-alive>\\n    </Parent>\\n  </keep-alive>\\n<App>\\n\\ndata () {\\n  return {\\n    showParent: true\\n  }\\n}\\n```\\n\\n\u9996\u6b21\u52a0\u8f7d\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\uff1a\\n```\\n[parent] beforeCreate \\n[parent] created \\n[parent] beforeMount \\n[child ] beforeCreate \\n[child ] created \\n[child ] beforeMount \\n[child ] mounted \\n[child ] activated \\n[parent] mounted \\n[parent] activated \\n```\\n\u8bbe\u7f6e`showParent`\u4e3a`false`\uff1a\\n```\\n[child ] deactivated \\n[parent] deactivated \\n```\\n\u8bbe\u7f6e`showParent`\u4e3a`true`\uff1a\\n```\\n[child ] activated \\n[parent] activated \\n```\\n\u6267\u884c\u987a\u5e8f\u793a\u610f\u56fe\uff1a\\n![](keepalive_parent_keepalive_child.png)\\n\\n\u5206\u6790\uff1a\u9996\u6b21\u52a0\u8f7d\u65f6\uff0c\u5148 mount \u5b50\u7ec4\u4ef6\uff0c\u5305\u88f9\u5b50\u7ec4\u4ef6\u7684`<keep-alive>`\u7ec4\u4ef6\u89e6\u53d1 activated \u5468\u671f\u65b9\u6cd5\u3002\u7136\u540e mount \u7236\u7ec4\u4ef6\uff0c\u5305\u88f9\u7236\u7ec4\u4ef6\u7684`<keep-alive>`\u7ec4\u4ef6\u89e6\u53d1 activated \u5468\u671f\u65b9\u6cd5\uff0c\u5148\u5b50\u7ec4\u4ef6\u540e\u7236\u7ec4\u4ef6\u3002\u540e\u7eed\u7236\u7ec4\u4ef6\u5207\u6362\u65f6\uff0c\u7531\u4e8e\u88ab\u7f13\u5b58\u4e0d\u4f1a\u89e6\u53d1\u9500\u6bc1\u91cd\u5efa\uff0c\u53d6\u800c\u4ee3\u4e4b\u89e6\u53d1 activated \u548c deactivated \u5468\u671f\u65b9\u6cd5\uff0c\u4e5f\u662f\u5148\u5b50\u7ec4\u4ef6\u540e\u7236\u7ec4\u4ef6\u3002\\n\\n## \u5c0f\u7ed3\\n\\nVue \u66b4\u9732\u4e86\u4e30\u5bcc\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7ed9\u4f7f\u7528\u8005\uff0c\u8ba9\u6211\u4eec\u6709\u673a\u4f1a\u4ecb\u5165\u5230\u7ec4\u4ef6\u4ece\u521b\u5efa\u5230\u9500\u6bc1\u8fc7\u7a0b\u4e2d\u7684\u5404\u4e2a\u91cd\u8981\u9636\u6bb5\uff0c\u719f\u6089\u6bcf\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7684\u6267\u884c\u65f6\u673a\u548c\u4ea7\u751f\u7684\u5f71\u54cd\u53ef\u4ee5\u5e2e\u52a9\u66f4\u597d\u7684\u5b9e\u73b0\u9700\u6c42\u3002\u672c\u6587\u5206\u6790\u4e86\u5355\u7ec4\u4ef6\u3001\u7236\u5b50\u7ec4\u4ef6\u4ee5\u53ca\u5b58\u5728`<keep-alive>`\u65f6\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6267\u884c\u987a\u5e8f\u7684\u53d8\u5316\uff0c\u8fd9\u4e9b\u7ec4\u5408\u53ef\u4ee5\u8986\u76d6\u65e5\u5e38\u5927\u591a\u6570\u573a\u666f\u3002"},{"id":"/2018/09/29/take-photo-by-based-on-h5-miniprogram","metadata":{"permalink":"/blog/2018/09/29/take-photo-by-based-on-h5-miniprogram","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/09-29-take-photo-by-based-on-h5-miniprogram.md","source":"@site/blog/2018/09-29-take-photo-by-based-on-h5-miniprogram.md","title":"H5 \u548c\u5c0f\u7a0b\u5e8f\u62cd\u7167\u56fe\u7247\u65cb\u8f6c\u3001\u538b\u7f29\u548c\u4e0a\u4f20","description":"H5 \u548c\u5c0f\u7a0b\u5e8f\u62cd\u7167\u56fe\u7247\u65cb\u8f6c\u3001\u538b\u7f29\u548c\u4e0a\u4f20","date":"2018-09-29T00:00:00.000Z","formattedDate":"September 29, 2018","tags":[],"readingTime":0.085,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"prevItem":{"title":"Vue \u751f\u547d\u5468\u671f\u68b3\u7406","permalink":"/blog/2018/12/10/vue-component-lifecycle"},"nextItem":{"title":"H5 \u5b9e\u73b0\u4fdd\u5b58\u56fe\u7247\u7684\u91c7\u5751\u8bb0\u5f55","permalink":"/blog/2018/08/06/save-photo-pitfall"}},"content":"[H5 \u548c\u5c0f\u7a0b\u5e8f\u62cd\u7167\u56fe\u7247\u65cb\u8f6c\u3001\u538b\u7f29\u548c\u4e0a\u4f20](https://github.com/whinc/whinc.github.io/issues/9)"},{"id":"/2018/08/06/save-photo-pitfall","metadata":{"permalink":"/blog/2018/08/06/save-photo-pitfall","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/08-06-save-photo-pitfall.md","source":"@site/blog/2018/08-06-save-photo-pitfall.md","title":"H5 \u5b9e\u73b0\u4fdd\u5b58\u56fe\u7247\u7684\u91c7\u5751\u8bb0\u5f55","description":"H5 \u5b9e\u73b0\u4fdd\u5b58\u56fe\u7247\u7684\u91c7\u5751\u8bb0\u5f55","date":"2018-08-06T00:00:00.000Z","formattedDate":"August 6, 2018","tags":[],"readingTime":0.065,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"prevItem":{"title":"H5 \u548c\u5c0f\u7a0b\u5e8f\u62cd\u7167\u56fe\u7247\u65cb\u8f6c\u3001\u538b\u7f29\u548c\u4e0a\u4f20","permalink":"/blog/2018/09/29/take-photo-by-based-on-h5-miniprogram"},"nextItem":{"title":"\u7a0b\u5e8f\u53d8\u91cf\u547d\u540d\u7684\u51e0\u79cd\u53eb\u6cd5","permalink":"/blog/2018/03/16/name-program-variable"}},"content":"[H5 \u5b9e\u73b0\u4fdd\u5b58\u56fe\u7247\u7684\u91c7\u5751\u8bb0\u5f55](https://github.com/whinc/whinc.github.io/issues/8)"},{"id":"/2018/03/16/name-program-variable","metadata":{"permalink":"/blog/2018/03/16/name-program-variable","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/03-16-name-program-variable/index.md","source":"@site/blog/2018/03-16-name-program-variable/index.md","title":"\u7a0b\u5e8f\u53d8\u91cf\u547d\u540d\u7684\u51e0\u79cd\u53eb\u6cd5","description":"\u8ba1\u7b97\u673a\u8bed\u8a00\u5f88\u591a\uff0c\u65e0\u8bba\u54ea\u79cd\u8bed\u8a00\u7f16\u5199\u4ee3\u7801\u65f6\u90fd\u4f1a\u9047\u5230\u53d8\u91cf\u547d\u540d\u3001\u65b9\u6cd5\u547d\u540d\u7b49\u95ee\u9898\uff0c\u7f51\u4e0a\u5173\u4e8e\u4ee3\u7801\u547d\u540d\u98ce\u683c\u7684\u8ba8\u8bba\u5df2\u7ecf\u591a\u5230\u65e0\u6cd5\u5f62\u5bb9\u4e86\uff0c\u751a\u81f3\u6210\u4e3a\u4e86\u7a0b\u5e8f\u5458\u7684\u4e00\u79cd\u4ef7\u503c\u89c2\u3002\u4eca\u5929\u4e0d\u8ba8\u8bba\u547d\u540d\u98ce\u683c\u5b70\u4f18\u5b70\u52a3\uff0c\u4ec5\u6574\u7406\u4e0b\u5df2\u6709\u7684\u547d\u540d\u98ce\u683c\u4f5c\u4e3a\u4e86\u89e3\uff0c\u65b9\u4fbf\u76f8\u4e92\u4e4b\u95f4\u6c9f\u901a\u3002","date":"2018-03-16T00:00:00.000Z","formattedDate":"March 16, 2018","tags":[],"readingTime":1.605,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"prevItem":{"title":"H5 \u5b9e\u73b0\u4fdd\u5b58\u56fe\u7247\u7684\u91c7\u5751\u8bb0\u5f55","permalink":"/blog/2018/08/06/save-photo-pitfall"},"nextItem":{"title":"10 \u5206\u949f\u7406\u89e3 Redux","permalink":"/blog/2018/02/26/understand-redux-in-10min"}},"content":"\u8ba1\u7b97\u673a\u8bed\u8a00\u5f88\u591a\uff0c\u65e0\u8bba\u54ea\u79cd\u8bed\u8a00\u7f16\u5199\u4ee3\u7801\u65f6\u90fd\u4f1a\u9047\u5230\u53d8\u91cf\u547d\u540d\u3001\u65b9\u6cd5\u547d\u540d\u7b49\u95ee\u9898\uff0c\u7f51\u4e0a\u5173\u4e8e\u4ee3\u7801\u547d\u540d\u98ce\u683c\u7684\u8ba8\u8bba\u5df2\u7ecf\u591a\u5230\u65e0\u6cd5\u5f62\u5bb9\u4e86\uff0c\u751a\u81f3\u6210\u4e3a\u4e86\u7a0b\u5e8f\u5458\u7684\u4e00\u79cd\u4ef7\u503c\u89c2\u3002\u4eca\u5929\u4e0d\u8ba8\u8bba\u547d\u540d\u98ce\u683c\u5b70\u4f18\u5b70\u52a3\uff0c\u4ec5\u6574\u7406\u4e0b\u5df2\u6709\u7684\u547d\u540d\u98ce\u683c\u4f5c\u4e3a\u4e86\u89e3\uff0c\u65b9\u4fbf\u76f8\u4e92\u4e4b\u95f4\u6c9f\u901a\u3002\\n\\n\x3c!--truncate--\x3e\\n## camel case \uff08\u9a7c\u5cf0\u5f0f\uff09\\n\\n![](./camel.png)\\n\\n\u7279\u70b9\uff1a\u540d\u79f0\u4e2d\u95f4\u6ca1\u6709\u7a7a\u683c\u548c\u6807\u70b9\uff0c\u9664\u7b2c\u4e00\u4e2a\u5355\u8bcd\u5916\u540e\u9762\u7684\u5355\u8bcd\u9996\u5b57\u6bcd\u5747\u5927\u5199\u3002\\n\\n\u5982\u679c\u7b2c\u4e00\u4e2a\u5355\u8bcd\u9996\u5b57\u6bcd\u5927\u5199\uff0c\u79f0\u4e4b\u4e3a`upper camel case`\uff08`CamelCase`\uff0c\u5927\u9a7c\u5cf0\u5f0f\uff09\uff0c\u4f8b\u5982`\\"GetUserName\\"`\u3002\\n\u5982\u679c\u7b2c\u4e00\u4e2a\u5355\u8bcd\u9996\u5b57\u6bcd\u5c0f\u5199\uff0c\u79f0\u4e4b\u4e3a`lower camel case`\uff08`camelCase`\uff0c\u5c0f\u9a7c\u5cf0\u5f0f\uff09\uff0c\u4f8b\u5982`\\"getUserName\\"`\u3002\\n\\n>`upper camel case`\u8fd8\u6709\u4e00\u4e2a\u79f0\u547c`Pascal case`\\n\\n## snake case \uff08\u86c7\u5f0f\uff09\\n\\n![](./snake.jpg)\\n\\n\u7279\u70b9\uff1a\u540d\u79f0\u4e2d\u95f4\u7684\u6807\u70b9\u88ab\u66ff\u6362\u6210\u4e0b\u5212\u7ebf\uff08`_`\uff09\u3002\\n\\n\u5982\u679c\u6240\u6709\u5355\u8bcd\u90fd\u5c0f\u5199\uff0c\u79f0\u4e4b\u4e3a`lower snake case`\uff08\u5c0f\u86c7\u5f0f\uff09\uff0c\u4f8b\u5982`\\"get_user_name\\"`\u3002\\n\u5982\u679c\u6240\u6709\u5355\u8bcd\u90fd\u5927\u5199\uff0c\u79f0\u4e4b\u4e3a`upper snake case`\uff08\u5927\u86c7\u5f0f\uff09\uff0c\u4f8b\u5982`\\"GET_USER_NAME\\"`\u3002\\n\\n## kebab case \uff08\u70e4\u8089\u4e32\u5f0f\uff09\\n\\n![](./kebab.jpg)\\n\\n\u7279\u70b9\uff1a\u540d\u79f0\u4e2d\u95f4\u7684\u6807\u70b9\u88ab\u66ff\u6362\u6210\u8fde\u5b57\u7b26\uff08`-`\uff09\uff0c\u6240\u6709\u5355\u8bcd\u90fd\u5c0f\u5199\uff0c\u4f8b\u5982`\\"get-user-name\\"`\u3002\\n\\n## \u53c2\u8003\\n\\n* [Letter case - Special case styles](https://en.wikipedia.org/wiki/Letter_case#Special_case_styles)\\n* [lodash#cameCase](https://lodash.com/docs/4.17.4#camelCase)\\n* [lodash#snakeCase](https://lodash.com/docs/4.17.4#snakeCase)\\n* [lodash#kebabCase](https://lodash.com/docs/4.17.4#kebabCase)"},{"id":"/2018/02/26/understand-redux-in-10min","metadata":{"permalink":"/blog/2018/02/26/understand-redux-in-10min","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/02-26-understand-redux-in-10min/index.md","source":"@site/blog/2018/02-26-understand-redux-in-10min/index.md","title":"10 \u5206\u949f\u7406\u89e3 Redux","description":"redux \u662f\u4ec0\u4e48\uff1f","date":"2018-02-26T00:00:00.000Z","formattedDate":"February 26, 2018","tags":[],"readingTime":12.65,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"prevItem":{"title":"\u7a0b\u5e8f\u53d8\u91cf\u547d\u540d\u7684\u51e0\u79cd\u53eb\u6cd5","permalink":"/blog/2018/03/16/name-program-variable"},"nextItem":{"title":"\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0 ES6 Promise","permalink":"/blog/2018/02/25/implement-promise"}},"content":"## redux \u662f\u4ec0\u4e48\uff1f\\n\\nredux \u662f\u4e00\u4e2a\u524d\u7aef\u72b6\u6001\u7ba1\u7406\u5e93\u3002\\n\\n\u4e3a\u4ec0\u4e48\u8981\u641e\u4e2a\u72b6\u6001\u7ba1\u7406\u5e93\u6765\u589e\u52a0\u590d\u6742\u5ea6\u548c\u5b66\u4e60\u6210\u672c\u5462\uff1f\u8fd9\u6837\u8bb2\u6ca1\u9519\uff0c\u7b80\u5355\u7684\u9879\u76ee\u7528 redux \u5c31\u662f\u6298\u817e\u81ea\u5df1\uff0c\u6211\u4e5f\u4e0d\u5efa\u8bae\u4f60\u7528\uff0c\u4f46\u662f\u5927\u4e00\u70b9\u9879\u76ee\uff0c\u5c24\u5176\u662f\u591a\u4eba\u534f\u4f5c\u65f6\uff0c\u5c31\u5b8c\u5168\u662f\u53e6\u4e00\u56de\u4e8b\u4e86\u3002\\n\\n\u968f\u7740 JavaScript \u5355\u9875\u5e94\u7528\u5f00\u53d1\u65e5\u8d8b\u590d\u6742\uff0cJavaScript \u9700\u8981\u7ba1\u7406\u6bd4\u4efb\u4f55\u65f6\u5019\u90fd\u8981\u591a\u7684 state(\u72b6\u6001)\u3002 \u8fd9\u4e9b state \u53ef\u80fd\u5305\u62ec\u670d\u52a1\u5668\u54cd\u5e94\u3001\u7f13\u5b58\u6570\u636e\u3001\u672c\u5730\u751f\u6210\u5c1a\u672a\u6301\u4e45\u5316\u5230\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u4e5f\u5305\u62ec UI \u72b6\u6001\uff0c\u5982\u6fc0\u6d3b\u7684\u8def\u7531\uff0c\u88ab\u9009\u4e2d\u7684\u6807\u7b7e\uff0c\u662f\u5426\u663e\u793a\u52a0\u8f7d\u52a8\u6548\u6216\u8005\u5206\u9875\u5668\u7b49\u7b49\u3002\\n\\n\u7ba1\u7406\u4e0d\u65ad\u53d8\u5316\u7684 state \u975e\u5e38\u56f0\u96be\u3002\u5982\u679c\u4e00\u4e2a model \u7684\u53d8\u5316\u4f1a\u5f15\u8d77\u53e6\u4e00\u4e2a model \u53d8\u5316\uff0c\u90a3\u4e48\u5f53 view \u53d8\u5316\u65f6\uff0c\u5c31\u53ef\u80fd\u5f15\u8d77\u5bf9\u5e94 model \u4ee5\u53ca\u53e6\u4e00\u4e2a model \u7684\u53d8\u5316\uff0c\u4f9d\u6b21\u5730\uff0c\u53ef\u80fd\u4f1a\u5f15\u8d77\u53e6\u4e00\u4e2a view \u7684\u53d8\u5316\u3002\u76f4\u81f3\u4f60\u641e\u4e0d\u6e05\u695a\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\u3002state \u5728\u4ec0\u4e48\u65f6\u5019\uff1f\u7531\u4e8e\u4ec0\u4e48\u539f\u56e0\uff1f\u5982\u4f55\u53d8\u5316\uff1f\u5df2\u7136\u4e0d\u53d7\u63a7\u5236\u3002 \u5f53\u7cfb\u7edf\u53d8\u5f97\u9519\u7efc\u590d\u6742\u7684\u65f6\u5019\uff0c\u60f3\u91cd\u73b0\u95ee\u9898\u6216\u8005\u6dfb\u52a0\u65b0\u529f\u80fd\u5c31\u4f1a\u53d8\u5f97\u4e3e\u6b65\u7ef4\u8270\u3002\\n\\n\x3c!--truncate--\x3e\\n\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e00\u4e2a\u767b\u5f55\u9875\u9762\u6709\u8d26\u53f7\u8f93\u5165\u6846\u3001\u5bc6\u7801\u8f93\u5165\u6846\u548c\u767b\u5f55\u6309\u94ae\uff0c\u73b0\u5728\u8981\u5b9e\u73b0\uff0c\u8f93\u5165\u7684\u5bc6\u7801\u7b26\u5408\u6761\u4ef6\u65f6\uff0c\u767b\u5f55\u6309\u94ae\u9ad8\u4eae\u53ef\u70b9\u51fb\uff0c\u4e0d\u7b26\u5408\u6761\u4ef6\u65f6\uff0c\u767b\u5f55\u6309\u94ae\u7f6e\u7070\u4e0d\u53ef\u70b9\u51fb\uff0c\u540c\u65f6\u663e\u793a\u63d0\u793a\u4fe1\u606f\u3002\u8fd9\u91cc\u9700\u8981\u4e09\u4e2a\u53d8\u91cf\u6765\u8868\u793a\u9875\u9762 state\uff1apassword\uff08\u5bc6\u7801\uff09\u3001canLogin(\u6309\u94ae\u662f\u5426\u53ef\u7528)\u548c hasInfo(\u63d0\u793a\u4fe1\u606f\u662f\u5426\u663e\u793a)\u3002\\n\\n![](login-demo.png)\\n\\n\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f60\u9700\u8981\u76d1\u542c\u8f93\u5165\u6846\u7684\u53d8\u5316\u4e8b\u4ef6\uff0c\u68c0\u6d4b\u5230\u53d8\u5316\u65f6\uff0c\u5c31\u5224\u65ad password \u662f\u5426\u7b26\u5408\u6761\u4ef6\uff0c\u7136\u540e\u66f4\u65b0 canLogin \u548c hasInfo \u72b6\u6001\u3002\\n\\n```javascript\\npassword.on(\'change\', () => {\\n  canLogin = ...\\n  hasInfo = ...\\n})\\n```\\n\\n\u5f88\u591a\u4eba\u89c9\u5f97\u8fd9\u4e2a\u5f88\u7b80\u5355\u554a\uff0cOK\uff0c\u8fd9\u91cc\u903b\u8f91\u518d\u52a0\u4e0a\u8d26\u6237\u8f93\u5165\u6846\u7684\u53d8\u5316\u65f6\uff0c\u4e5f\u66f4\u65b0\u6309\u94ae\u548c\u63d0\u793a\u72b6\u6001\u5462\uff1f\u5982\u679c\u518d\u52a0\u4e0a\u8d26\u6237\u8f93\u5165\u65f6\uff0c\u8981\u5b9e\u65f6\u540e\u53f0\u6821\u9a8c\u662f\u5426\u5df2\u6ce8\u518c\uff0c\u7136\u540e\u66f4\u65b0\u6309\u94ae\u548c\u63d0\u793a\u72b6\u6001\u5462\uff1f\u5982\u679c\u8fd9\u4e2a\u9875\u9762\u518d\u590d\u6742\u4e00\u70b9\u5462\uff1f\\n\\n```javascript\\nusername.on(\'change\', () => {\\n  canLogin = ...\\n  hasInfo = ...\\n})\\n\\nfunction login () {\\n  setTimeout(() => {\\n    canLogin = ...\\n    hasInfo = ...\\n  }, 1000)\\n}\\n\\n// more code may modify state \'canLogin\' and \'hasInfo\' ...\\n```\\n\u8fd9\u4e2a\u65f6\u5019\uff0c\u5f53\u4f60\u53d1\u73b0\u6309\u94ae\u65e0\u6cd5\u70b9\u51fb\uff0c\u9700\u8981\u6392\u67e5\u539f\u56e0\u65f6\uff0c\u4f60\u5f88\u96be\u5feb\u901f\u627e\u51fa canLogin \u662f\u7531\u4e8e\u54ea\u4e2a\u56e0\u7d20\u5f15\u8d77\u7684\u3002\\n\\n\u8fd9\u91cc\u7684\u590d\u6742\u6027\u5f88\u5927\u7a0b\u5ea6\u4e0a\u6765\u81ea\u4e8e\uff0c\u6211\u4eec\u603b\u662f\u5c06\u4e24\u4e2a\u96be\u4ee5\u7406\u6e05\u7684\u6982\u5ff5\u6df7\u6dc6\u5728\u4e00\u8d77\uff1a**\u53d8\u5316**\u548c**\u5f02\u6b65**\u3002\u901a\u8fc7\u9650\u5236\u66f4\u65b0\u53d1\u751f\u7684\u65f6\u95f4\u548c\u65b9\u5f0f\uff0c**Redux \u8bd5\u56fe\u8ba9 state \u7684\u53d8\u5316\u53d8\u5f97\u53ef\u9884\u6d4b**\u3002\u8fd9\u4e9b\u9650\u5236\u6761\u4ef6\u53cd\u6620\u5728 Redux \u7684\u4e09\u5927\u539f\u5219\u4e2d\uff08\u540e\u9762\u63d0\u5230\uff09\u3002\\n\\n\u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u53ef\u80fd\u8fd8\u662f\u4e0d\u77e5\u9053 redux \u662f\u4ec0\u4e48\uff0c\u4f46\u81f3\u5c11\u77e5\u9053 redux \u4f3c\u4e4e\u53ef\u4ee5\u89e3\u51b3\u4e0a\u9762\u8fd9\u4e2a\u72b6\u6001\u7ba1\u7406\u7684\u95ee\u9898\u3002\u62bd\u8c61\u7684\u4e1c\u897f\u7ed3\u5408\u5b9e\u8df5\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\uff0c\u63a5\u4e0b\u6765\u770b\u4e0b redux \u7684\u6838\u5fc3\u6982\u5ff5\u548c\u5177\u4f53\u4f7f\u7528\u65b9\u6cd5\u3002\\n\\n\\n## redux \u6838\u5fc3\u6982\u5ff5\\n\\nredux \u672c\u8eab\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u53ea\u6709\u4e09\u4e2a\u6838\u5fc3\u6982\u5ff5\uff1a**state**\u3001**action**\u548c**reducer**\uff0c\u4e09\u8005\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a\\n\\n![](./reducer-action-state.png)\\n\\nstate \u4fdd\u5b58\u4e86\u5e94\u7528\u7a0b\u5e8f\u5f53\u524d\u72b6\u6001\uff0c\u6bcf\u5f53 state \u53d1\u751f\u53d8\u5316\u65f6\u89e6\u53d1\u72b6\u6001\u53d8\u5316\u4e8b\u4ef6\uff0c\u4e8b\u4ef6\u7684\u8ba2\u9605\u8005 View \u62ff\u5230\u6700\u65b0\u7684 state \u91cd\u65b0\u6e32\u67d3 UI \u4ee5\u53cd\u6620\u6700\u65b0\u7684 state \u4fe1\u606f\u3002\\n\\naction \u8868\u793a\u4e00\u4e2a\u64cd\u4f5c\uff08\u8bf7\u6c42\u4fee\u6539 state \u7684\u64cd\u4f5c\uff09\uff0c\u5b83\u662f\u4e00\u4e2a\u7eaf JavaScript \u5bf9\u8c61\uff0c\u5176\u5305\u542b\u4e86\u64cd\u4f5c\u7684\u7c7b\u578b\u3001\u6570\u636e\u548c\u5143\u6570\u636e\u4fe1\u606f\u3002\u7528\u6237\u4e0e View \u8fdb\u884c\u4ea4\u4e92\uff0c\u4f8b\u5982\u70b9\u51fb\u6309\u94ae\u3001\u8f93\u5165\u4fe1\u606f\u6216\u9875\u9762\u8df3\u8f6c\u7b49\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u4f1a\u89e6\u53d1\u4e00\u4e2a action\uff0c\u7f51\u7edc\u8bf7\u6c42\u3001\u5b9a\u65f6\u4efb\u52a1\u6216\u7cfb\u7edf\u5176\u4ed6\u5f02\u6b65\u4e8b\u4ef6\uff0c\u4e5f\u4f1a\u89e6\u53d1 action\u3002\u6240\u6709 action \u90fd\u4f1a\u88ab\u9001\u5230\u4e00\u4e2a\u79f0\u4e3a reducer \u7684\u5904\u7406\u51fd\u6570\u3002\\n\\nreducer \u662f\u4e00\u4e2a\u7eaf\u51fd\u6570\uff0c\u5176\u63a5\u53d7 state \u548c action \u4f5c\u4e3a\u8f93\u5165\uff0c\u5904\u7406\u540e\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 state\uff0c\u65b0\u7684 state \u4f1a\u66f4\u65b0\u8986\u76d6\u4e4b\u524d\u7684 state \u4f5c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u5f53\u524d\u6700\u65b0 state\uff0c\u5e76\u89e6\u53d1 state \u53d8\u5316\u4e8b\u4ef6\u3002\\n\\n\u4e0a\u9762\u5c31\u662f redux \u6838\u5fc3\u601d\u60f3\uff1a\u6570\u636e\u7684\u6d41\u52a8\u662f\u5355\u5411\u7684\uff0cView \u4e0d\u76f4\u63a5\u64cd\u4f5c state\uff0c\u6240\u6709\u5bf9 state \u4fee\u6539\u90fd\u901a\u8fc7\u53d1\u9001 action \u8fdb\u884c\uff0caction \u7edf\u4e00\u7531\u7eaf\u51fd\u6570 reducer \u8fdb\u884c\u5904\u7406\uff0c\u56e0\u6b64\u53ea\u6709 reducer \u80fd\u4fee\u6539 state\u3002redux \u901a\u8fc7\u8fd9\u4e9b\u7ea6\u675f\uff0c\u8ba9\u6570\u636e\u7684\u53d8\u5316\u53d8\u5f97\u53ef\u9884\u6d4b\u3001\u53ef\u56de\u6eaf\u3002\\n\\n\u4e0b\u9762\u7ed3\u5408\u4e00\u4e2a TODOs demo \u770b\u770b redux \u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f\\n\\n![](./redux-todos-demo.png)\\n\\n**state**\\n\\nredux \u7684 state \u662f\u4e00\u4e2a\u7eaf JavaScript \u5bf9\u8c61\uff0c\u7528\u4e8e\u4fdd\u5b58\u5e94\u7528\u7684\u72b6\u6001\u6570\u636e\u3002\u5728 TODOs \u5e94\u7528\u4e2d\uff0cstate \u4fdd\u5b58\u4e86 todo \u6570\u7ec4\uff0c\u6bcf\u6761 todo \u90fd\u5305\u542b\u4e86\u5185\u5bb9\u548c\u662f\u5426\u5b8c\u6210\u7684\u6807\u8bb0\uff0c\u540c\u65f6\u8fd8\u6709\u4e00\u4e2a visibilityFilter \u6807\u8bb0\u7528\u4e8e\u8fc7\u6ee4\u5df2\u5b8c\u6210\u7684\u6216\u672a\u5b8c\u6210\u7684 todos\u3002\\n```javascript\\n{\\n  todos: [{\\n    text: \'Eat food\',\\n    completed: true\\n  }, {\\n    text: \'Exercise\',\\n    completed: false\\n  }],\\n  visibilityFilter: \'SHOW_COMPLETED\'\\n}\\n```\\n\\n**action**\\n\\n\u8981\u60f3\u66f4\u65b0 state \u4e2d\u7684\u6570\u636e\uff0c\u4f60\u9700\u8981\u53d1\u8d77\u4e00\u4e2a action\uff0caction \u662f\u4e00\u4e2a\u666e\u901a JavaScript \u5bf9\u8c61\uff0c\u7528\u6765\u63cf\u8ff0\u53d1\u751f\u4e86\u4ec0\u4e48\u3002\u5728 TODO \u5e94\u7528\u4e2d\uff0c\u5b9a\u4e49\u4e86\u4e09\u79cd action\uff1a\u65b0\u589e todo\u3001\u5207\u6362 todo \u72b6\u6001\u548c\u4fee\u6539 todo \u8fc7\u6ee4\u663e\u793a\u72b6\u6001\u3002\\n\\n```javascript\\n// \u65b0\u589e\u4e00\u4e2a TODO\\n{ type: \'ADD_TODO\', text: \'Go to swimming pool\' } \\n\\n// \u5207\u6362\u4e00\u4e2a TODO \u7684\u5b8c\u6210\u72b6\u6001\\n{ type: \'TOGGLE_TODO\', index: 1 }\\n\\n// \u663e\u793a\u6240\u6709\u72b6\u6001\uff08\u5b8c\u6210\u548c\u672a\u5b8c\u6210\uff09\u7684 TODO\\n{ type: \'SET_VISIBILITY_FILTER\', filter: \'SHOW_ALL\' }\\n```\\n\\n>\u5f3a\u5236\u4f7f\u7528 action \u6765\u63cf\u8ff0\u6240\u6709\u53d8\u5316\u5e26\u6765\u7684\u597d\u5904\u662f\u53ef\u4ee5\u6e05\u6670\u5730\u77e5\u9053\u5e94\u7528\u4e2d\u5230\u5e95\u53d1\u751f\u4e86\u4ec0\u4e48\u3002\u5982\u679c\u4e00\u4e9b\u4e1c\u897f\u6539\u53d8\u4e86\uff0c\u5c31\u53ef\u4ee5\u77e5\u9053\u4e3a\u4ec0\u4e48\u53d8\u3002\\n\\n**reducer**\\n\\nreducer \u662f\u4e00\u4e2a\u7eaf\u51fd\u6570\uff0c\u5b83\u63a5\u6536\u4e24\u4e2a\u53c2\u6570 state \u548c action\uff0c\u5e76\u8fd4\u56de**\u65b0\u7684 state**\uff0c\u7528\u4f2a\u4ee3\u7801\u63cf\u8ff0\uff1a\\n```javascript\\nreducer = (state, action) => new_state\\n```\\n\\n\u5728 TODO \u5e94\u7528\u4e2d\uff0creducer \u63a5\u6536\u5230 action \u540e\uff0c\u8ba1\u7b97\u5e76\u8fd4\u56de\u65b0\u7684 state\u3002\\n```javascript\\nfunction todoApp(state = {}, action) {\\n  return {\\n    todos: todos(state.todos, action),\\n    visibilityFilter: visibilityFilter(state.visibilityFilter, action)\\n  };\\n}\\n```\\n\\n```javascript\\nfunction todos(state = [], action) {\\n  switch (action.type) {\\n  case \'ADD_TODO\':\\n    return state.concat([{ text: action.text, completed: false }]);\\n  case \'TOGGLE_TODO\':\\n    return state.map((todo, index) =>\\n      action.index === index ?\\n        { text: todo.text, completed: !todo.completed } :\\n        todo\\n   )\\n  default:\\n    return state;\\n  }\\n}\\n```\\n\\n```javascript\\nfunction visibilityFilter(state = \'SHOW_ALL\', action) {\\n  if (action.type === \'SET_VISIBILITY_FILTER\') {\\n    return action.filter;\\n  } else {\\n    return state;\\n  }\\n}\\n```\\n\\n\u4e3a\u4e86\u63d0\u9ad8\u4ee3\u7801\u53ef\u7ef4\u62a4\u6027\uff0c\u5bf9\u4e8e\u6bcf\u4e2a\u5b57\u6bb5\u7684\u66f4\u65b0\uff0c\u53ef\u4ee5\u62bd\u53d6\u51fa\u7c92\u5ea6\u66f4\u5c0f\u7684 reducer \u6765\u5b8c\u6210\uff0c\u4f8b\u5982 `todoApp()`\u66f4\u65b0\u6574\u4e2a state\uff0c\u5185\u90e8\u53c8\u8c03\u7528`todo()`\u66f4\u65b0`state.todos`\u5b57\u6bb5\uff0c\u8c03\u7528`visibilityFilter()`\u66f4\u65b0`state.visibilityFilter`\u5b57\u6bb5\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u6a21\u5757\u5b9a\u4e49 reducer\uff0c\u6bcf\u4e2areducer \u53ea\u8d1f\u8d23\u5904\u7406\u5404\u81ea\u6a21\u5757\u7684 state \u66f4\u65b0\uff0c\u6700\u7ec8\u5c06\u4e0d\u540c\u6a21\u5757\u7684 reducer \u7684\u5904\u7406\u7ed3\u679c\u5408\u5e76\u6210\u4e00\u4e2a reducer\uff0c\u4e0b\u9762\u662f\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u793a\u610f\u56fe\uff1a\\n>redux \u4e2d\u4e60\u60ef\u5c06 reducer \u51fd\u6570\u547d\u540d\u4e3a\u4e3a\u548c\u88ab\u66f4\u65b0\u7684 state \u5b57\u6bb5\u76f8\u540c\uff0c\u8fd9\u6837\u76f4\u89c2\u4e14\u65b9\u4fbf\u5de5\u5177\u5904\u7406\u3002\\n\\n\\n![](./combine-reducer.png)\\n\\n\u8fd9\u5dee\u4e0d\u591a\u5c31\u662f Redux \u601d\u60f3\u7684\u5168\u90e8\u3002\u51e0\u4e4e\u6ca1\u6709\u4ecb\u7ecd\u5230 Redux \u7684 API\uff0cRedux 90% \u7684\u662f\u601d\u60f3\uff0c\u8fd9\u90e8\u5206\u90fd\u662f\u7eaf JavaScript \u4ee3\u7801\u3002\\n\\n## Redux API\\n\\n\u4e0a\u9762\u4e00\u8282\u5df2\u7ecf\u5c06 redux \u7684\u6838\u5fc3\u601d\u60f3\u4ecb\u7ecd\u5b8c\u4e86\uff0c\u552f\u4e00\u7f3a\u5931\u7684\u90e8\u5206\u662f\uff0c\u5982\u4f55\u8fde\u63a5\u5404\u4e2a\u90e8\u5206\uff1aView \u5982\u4f55\u53d1\u9001 action\u3001action \u5982\u4f55\u4f20\u9012\u7ed9 reducer \u5904\u7406\uff0c\u66f4\u65b0 state \u540e\u5982\u4f55\u901a\u77e5 View \u66f4\u65b0\u3002\u8fd9\u90e8\u5206\u53ef\u4ee5\u57fa\u4e8e\u4e8b\u4ef6\u7684\u53d1\u5e03-\u8ba2\u9605\u5b8c\u6210\uff0c\u5b9e\u9645\u4e0a redux \u7684 API \u4e5f\u786e\u5b9e\u662f\u8fd9\u6837\u5b9e\u73b0\u7684\u3002\\n\\nRedux \u7684 API \u4e3b\u8981\u662f\u63d0\u4f9b\u4e86 Store\uff0c\u5b83\u7684\u4f5c\u7528\u5c31\u662f\u5c06\u8fd9\u51e0\u4e2a\u6982\u5ff5\u4e32\u8054\u8d77\u6765\u3002Store \u6709\u4ee5\u4e0b\u804c\u8d23\uff1a\\n* \u5185\u90e8\u7ef4\u6301\u5e94\u7528\u7684 state \u548c reducer\uff1b\\n* \u63d0\u4f9b`getState()`\u65b9\u6cd5\u83b7\u53d6 state\uff1b\\n* \u63d0\u4f9b`dispatch(action)`\u65b9\u6cd5\u66f4\u65b0 state\uff1b\\n* \u901a\u8fc7`subscribe(listener)`\u6ce8\u518c\u76d1\u542c\u5668;\\n\\n```javascript\\nimport { createStore } from \'redux\'\\n// \u5e94\u7528\u7684\u521d\u59cb\u72b6\u6001\\nconst initialState = {\\n  todos: [],\\n  visibilityFilter: \'SHOW_ALL\' \\n}\\n// \u521b\u5efa store \u65f6\u4f20\u5165 reducer \u548c\u5e94\u7528\u7684\u521d\u59cb state\\nconst store = createStore(todoApp, initialState)\\n\\n// \u7528\u6237\u4e0e View \u53d1\u751f\u4ea4\u4e92\u884c\u65f6\uff0c\u53d1\u9001 action \u66f4\u65b0\u5e94\u7528 state\\nstore.dispatch({ type: \'ADD_TODO\', text: \'Go to swimming pool\' })\\n\\n// \u8ba2\u9605 state \u53d8\u5316\u4e8b\u4ef6\\nstore.subscribe(function onStateUpdate() {\\n  // \u66f4\u65b0 View\\n  renderUI(store.getState())\\n})\\n```\\n\\nredux \u7684\u6838\u5fc3 API \u6e90\u7801\u975e\u5e38\u77ed\uff08\u52a0\u4e0a\u6ce8\u91ca 250 \u5de6\u53f3\uff09\uff0c\u611f\u5174\u8da3\u53ef\u4ee5\u770b [createStore \u6e90\u7801](https://github.com/reactjs/redux/blob/master/src/createStore.js)\uff0credux \u7684\u5176\u4ed6\u51e0\u4e2a API \u63a5\u53e3\u90fd\u662f\u4e3a\u4e86\u7b80\u5316 action \u548c reducer \u7684\u521b\u5efa\uff0c\u4ee5\u53ca\u652f\u6301 middleware\uff0c\u5e76\u4e0d\u5f71\u54cd\u5230 redux \u7684\u6838\u5fc3\u3002\\n\\n\\n## Redux \u4e09\u5927\u539f\u5219\\n\\n\u4f7f\u7528 redux \u5e94\u5f53\u59cb\u7ec8\u9075\u5faa\u4e0b\u9762\u4ecb\u7ecd\u7684\u4e09\u4e2a\u539f\u5219\uff0c\u8fd9\u5c06\u4f1a\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u3001\u5f00\u53d1\u6548\u7387\u548c\u5176\u4ed6\u65b9\u9762\u7684\u597d\u5904\u3002\u4e0b\u9762\u7684\u4e09\u5927\u539f\u5219\u63cf\u8ff0\u6765\u81ea redux \u6587\u6863\uff08\u6211\u53ea\u662f\u642c\u8fd0\u5de5\uff09\uff0c\u7565\u5fae\u8fdb\u884c\u7b80\u5316\u3002\\n\\n**\u5355\u4e00\u6570\u636e\u6e90**\\n\\n\u6574\u4e2a\u5e94\u7528\u7684 state \u88ab\u50a8\u5b58\u5728\u4e00\u68f5\u5bf9\u8c61\u6570\u4e2d\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5bf9\u8c61\u6811\u53ea\u5b58\u5728\u4e8e\u552f\u4e00\u4e00\u4e2a store \u4e2d\u3002\\n\\n\u5355\u4e00\u6570\u636e\u6e90\u5728\u8c03\u8bd5\u65f6\u975e\u5e38\u65b9\u4fbf\uff0c\u56e0\u4e3a\u4efb\u610f\u65f6\u523b\uff0c\u4f60\u90fd\u53ef\u4ee5\u83b7\u53d6\u5230\u6574\u4e2a\u5e94\u7528\u5f53\u524d\u7684 state \u5feb\u7167\u3002\\n\\n**state \u662f\u53ea\u8bfb\u7684**\\n\\n\u552f\u4e00\u6539\u53d8 state \u7684\u65b9\u6cd5\u5c31\u662f\u89e6\u53d1 action\\n\\n\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd View \u7684\u4ea4\u4e92\u4e8b\u4ef6\u3001\u7f51\u7edc\u8bf7\u6c42\u7b49\u90fd\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539 state\uff0c\u76f8\u53cd\u5b83\u4eec\u53ea\u80fd\u8868\u8fbe\u4fee\u6539\u7684\u610f\u56fe\uff0c\u6240\u6709\u7684\u4fee\u6539\u90fd\u88ab\u96c6\u4e2d\u5316\u5904\u7406\uff0c\u4e14\u4e25\u683c\u6309\u7167\u4e00\u4e2a\u63a5\u4e00\u4e2a\u7684\u987a\u5e8f\u6267\u884c\uff0c\u56e0\u6b64\u4e0d\u7528\u62c5\u5fc3\u6761\u4ef6\u7ade\u4e89\u5bfc\u81f4\u7684\u65f6\u5e8f\u95ee\u9898\u3002\\n\\n\u540c\u65f6\uff0c\u7531\u4e8e action \u662f\u4e00\u4e2a\u7eaf JavaScript \u5bf9\u8c61\uff0c\u6253\u5370\u51fa action \u5c31\u53ef\u4ee5\u6e05\u6670\u7684\u770b\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u53d8\u8fc1\u56fe\uff0c\u8fd9\u5bf9\u4e8e\u8c03\u8bd5\u548c\u56de\u6eaf\u975e\u5e38\u65b9\u4fbf\u3002\\n\\n**reducer \u662f\u7eaf\u51fd\u6570**\\n\\nreducer \u662f\u7eaf\u51fd\u6570\uff0c\u610f\u5473\u7740\u5b83\u5e76\u4e0d\u76f4\u63a5\u4fee\u6539 state\uff0c\u800c\u662f\u5728 state \u7684\u526f\u672c\u4e0a\u8fdb\u884c\u4fee\u6539\uff0c\u5e76\u8fd4\u56de\u526f\u672c\u3002\u540c\u65f6\uff0c\u7531\u4e8e reducer \u662f\u7eaf\u51fd\u6570\uff0c\u6240\u4ee5 reducer \u5185\u90e8\u4e0d\u80fd\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u3001\u4e0d\u80fd\u4fee\u6539\u5916\u90e8\u53d8\u91cf\u7b49\u5f15\u8d77\u526f\u4f5c\u7528\u7684\u884c\u4e3a\u3002\\n\\n\u4e4b\u6240\u4ee5\u8fd9\u4e48\u4e0d\u9057\u4f59\u529b\u7684\u8981\u4fdd\u6301 reducer \u7684\u7eaf\u51fd\u6570\u7279\u6027\uff0c\u662f\u4e3a\u4e86\u4fdd\u6301 state \u7684\u53d8\u5316\u53ea\u53d7 action \u5f71\u54cd\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u5176\u4ed6\u5916\u90e8\u56e0\u7d20\uff0c\u8ba9 state \u7684\u53d8\u5316\u53ef\u9884\u6d4b\u3002\\n\\n## \u793a\u4f8b & \u6e90\u7801\\n\\nOnline demo: <https://whinc.github.io/redux-todos-demo/>\\n\\nGithub source code: <https://github.com/whinc/redux-todos-demo>\\n\\n## \u53c2\u8003\\n\\n* [redux \u4e2d\u6587\u6587\u6863](http://cn.redux.js.org/index.html)\\n* [\u6d45\u8c08 React\u3001Flux \u4e0e Redux](http://imweb.io/topic/57711e37f0a5487b05f325b5)"},{"id":"/2018/02/25/implement-promise","metadata":{"permalink":"/blog/2018/02/25/implement-promise","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/02-25-implement-promise.md","source":"@site/blog/2018/02-25-implement-promise.md","title":"\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0 ES6 Promise","description":"\u524d\u8a00","date":"2018-02-25T00:00:00.000Z","formattedDate":"February 25, 2018","tags":[],"readingTime":10.93,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"prevItem":{"title":"10 \u5206\u949f\u7406\u89e3 Redux","permalink":"/blog/2018/02/26/understand-redux-in-10min"},"nextItem":{"title":"React UI \u7ec4\u4ef6\u5e93\u6362\u80a4\u8bbe\u8ba1\u601d\u8def","permalink":"/blog/2018/02/25/switch-react-component-theme-dynamically"}},"content":"## \u524d\u8a00\\n\\n\u4e3a\u4e86\u589e\u5f3a\u5bf9 ES6 `Promise`\u5de5\u4f5c\u65b9\u5f0f\u7684\u7406\u89e3\uff0c\u6211\u5b9e\u73b0\u4e86\u4e00\u4e2a\u81ea\u5df1\u7684`ES6Promise`\u7c7b\uff0c\u63a5\u53e3\u4e0e ES6 \u7684`Promise`\u7c7b\u4e00\u81f4\uff08\u5305\u542b\u6784\u9020\u51fd\u6570\u3001`then`\u3001`catch`\u3001`resolve`\u3001`reject`\uff09\uff0c \u5e76\u4e14\u7b26\u5408 [Promise/A+ \u89c4\u8303](https://promisesaplus.com/)\uff08\u901a\u8fc7\u4e86\u89c4\u8303\u7684\u5168\u90e8\u6d4b\u8bd5\u7528\u4f8b\uff09 \u3002\u4e0b\u9762\u4ece\u7b80\u5355\u5f00\u59cb\uff0c\u4e00\u6b65\u6b65\u5b9e\u73b0\u4e00\u4e2a\u81ea\u5df1\u7684`Promise`\u3002\\n\\n\u4e0b\u9762\u662f\u6700\u7ec8\u5b9e\u73b0\u7684`ES6Promise`\u4f7f\u7528\u793a\u4f8b\uff1a\\n\\n```javascript\\nimport {ES6Promise} from \'./es6-promise\'\\n\\n\\nlet p1 = new ES6Promise((resolve, reject) => {\\n    resolve(1);\\n});\\n\\nlet p2 = new Promise((resolve, reject) => {\\n    setTimeout(() => {\\n        resolve(999);\\n    }, 1000);\\n});\\n\\nES6Promise.resolve(1)\\n.then(value => value + 1, reason => reason)\\n.then(value => ES6Promise.reject(p2), reason => reason)\\n.catch((value) => console.log(value));                    // 999\\n```\\n\\n\x3c!--truncate--\x3e\\n## \u521b\u5efa Promise\\n\\n\u56de\u60f3 ES6 \u7684 `Promise`\u5bf9\u8c61\u6784\u9020\u51fd\u6570\uff0c\u5b83\u8981\u6c42\u4f20\u5165\u4e00\u4e2a\u6267\u884c\u5668\uff0c\u6267\u884c\u5668\u6709\u4e24\u4e2a\u53c2\u6570`resolve`\u548c`reject`\uff0c\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u51fd\u6570\u7c7b\u578b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u6267\u884c\u5668\u4e2d\u8c03\u7528\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff0c\u5c06`Promise`\u53d8\u4e3a`resolved`\u6216`rejected`\u3002\u5148\u5b9e\u73b0\u8fd9\u4e2a\u4e00\u6b65\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\\n\\n```\\nconst State = {\\n    pending: 0,\\n    resolved: 1,\\n    rejected: 2\\n}\\n\\nclass ES6Promise {\\n    constructor(executor) {\\n        this._state = State.pending;    // \u4fdd\u5b58\u72b6\u6001\uff0c\u53d6\u503c\u4e3a State \u4e4b\u4e00\\n        this._value = undefined;        // \u4fdd\u5b58 resolve \u6216 reject \u65f6\u6240\u4f20\u5165\u7684\u503c\\n        this._callbacks = [];           // \u4fdd\u5b58\u72b6\u6001\u76d1\u542c\u51fd\u6570\uff0cpromise \u72b6\u6001\u53d8\u5316\u65f6\u8c03\u7528\\n\\n        if (typeof executor === \'function\') {\\n            let resolve = (value) => {\\n                this._transition(State.resolved, value);\\n            };\\n\\n            let reject = (value) => {\\n                this._transition(State.rejected, value);\\n            };\\n            executor(resolve, reject);\\n        }\\n    }\\n\\n    // \u72b6\u6001\u8f6c\u79fb\\n    _transition(state, value) {        \\n        if (this._state === State.pending) {    \\n            this._state = state;               \\n            this._value = value;\\n            this._callbacks.forEach(callback => callback());\\n        } \\n    }\\n}\\n```\\n\\n\u4f7f\u7528\uff1a\\n```javascript\\nlet promise1 = new ES6Promise((resolve, reject) => {\\n    resolve(1);\\n});\\n```\\n\\n\u9996\u5148\uff0c\u5728`MyPromise`\u6784\u9020\u51fd\u6570\u4e2d\u58f0\u660e\u4e86\u4e24\u4e2a\u6210\u5458\u53d8\u91cf`status`\u548c`data`\uff0c\u5206\u522b\u8868\u793a`MyPromise`\u7684\u72b6\u6001\u548c\u6570\u636e\u3002\u6839\u636e`Promise`\u89c4\u8303\uff0c\u5176\u72b6\u6001\u53ea\u80fd\u6709\u4e09\u79cd\uff1a`pending`\u3001`resolved`\u548c`rejected`\uff0c\u521d\u59cb\u72b6\u6001\u662f`pending`\uff0c\u4e00\u65e6\u53d8\u5316\u4e3a`resolved`\u6216`rejected`\u72b6\u6001\u540e\uff0c\u5176\u72b6\u6001\u4e0d\u518d\u53d8\u5316\u3002\u6240\u4ee5\uff0c\u521d\u59cb\u8bbe\u7f6e`status`\u4e3a`undefined`\uff0c\u5f53\u8c03\u7528`resolve()`\u6216`reject()`\u65f6\uff0c\u5185\u90e8\u5148\u5224\u65ad\u5176\u72b6\u6001\uff0c\u5982\u679c\u72b6\u6001\u5df2\u7ecf\u53d1\u751f\u53d8\u5316\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u8fd9\u6837\u4fdd\u8bc1\u5176\u72b6\u6001\u4e0d\u4f1a\u88ab\u4fee\u6539\u3002\u5426\u5219\uff0c\u5c06\u72b6\u6001\u6807\u8bb0\u4e3a`resolved`\u6216`rejected`\uff0c\u540c\u65f6\u4fdd\u5b58\u6570\u636e\u3002\\n\\n## \u5b9e\u73b0 then \u65b9\u6cd5\\n\\n`Promise`\u5bf9\u8c61\u53ef\u4ee5\u94fe\u5f0f\u8c03\u7528`then()`\u65b9\u6cd5\uff0c\u8fd9\u5f97\u76ca\u4e8e`then()`\u8fd4\u56de\u7684\u4e5f\u662f`Promise`\u5bf9\u8c61\uff08\u51c6\u786e\u8bf4\u662f`thenable`\u5bf9\u8c61\uff0c\u5373\u5305\u542b`then`\u65b9\u6cd5\u7684\u5bf9\u8c61\uff09\uff0c\u4f8b\u5982\uff1a\\n\\n```\\nlet promise1 = new ES6Promise((resolve, reject) => {\\n    resolve(1);\\n});\\n\\nlet promise2 = promise1.then(function onResolved(){}, function onRejected() {});\\n```\\n\\n\u6240\u4ee5\u4e0b\u9762`ES6Promise`\u7684`then`\u51fd\u6570\u5b9e\u73b0\u4e2d\uff0c\u9996\u5148\u521b\u5efa\u5e76\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684`ES6Promise`\u5bf9\u8c61`promise2`\uff0c\u5728\u4f20\u5165`promise2`\u6784\u9020\u51fd\u6570\u7684\u6267\u884c\u5668\u5185\u90e8\uff0c\u901a\u8fc7`resolve`\u548c`reject`\u65b9\u6cd5\u4fee\u6539`promise2`\u7684\u72b6\u6001\u3002`promise2`\u72b6\u6001\u4f55\u65f6\u53d8\u5316\uff0c\u53d6\u51b3\u4e8e\u5f53\u524d`promise1`\u7684\u72b6\u6001\uff0c\u5982\u679c`promise1`\u72b6\u6001\u662f`pending`\uff0c\u5219\u7b49\u5f85`promise1`\u88ab`resolved`\u6216`rejected`\u65f6\u6267\u884c`scheduleFn()`\uff0c\u5426\u5219\u7acb\u5373\u6267\u884c`scheduleFn()`\u3002\\n\\n`scheduleFn()`\u65b9\u6cd5\u4e3b\u8981\u5de5\u4f5c\u662f\uff0c\u6839\u636e`promise1`\u5f53\u524d\u72b6\u6001\u662f`resolved`\uff08\u6216`rejected`\uff09\uff0c\u8c03\u7528`then(onResolved, onRejected)`\u65b9\u6cd5\u53c2\u6570\u4e2d\u7684`onResolved(promise1.value)`\uff08\u6216`onRejected(promise1.value)`\uff09\uff0c\u4ee5`promise1`\u7684\u5185\u90e8\u503c\u4f5c\u4e3a\u53c2\u6570\uff0c\u8fd4\u56de\u7ed3\u679c\u4f20\u9012\u7ed9`promise2`\u7684`resolve`\uff08\u6216`reject`\uff09\u65b9\u6cd5\uff0c\u4ece\u800c\u6539\u53d8`promise2`\u7684\u72b6\u6001\u548c\u5185\u90e8\u503c\u3002\u6309 [Promise/A+ \u89c4\u8303](https://promisesaplus.com/) `scheduleFn()`\u5fc5\u987b\u662f\u5f02\u6b65\u6267\u884c\u7684\uff0c\u6240\u4ee5\u8fd9\u91cc\u901a\u8fc7`setTimeout()`\u65b9\u6cd5\uff0c\u8ba9\u5176\u5728\u4e0b\u4e2a\u4e8b\u4ef6\u5faa\u73af\u4e2d\u5904\u7406\u3002\\n\\n```javascript\\nclass ES6Promise {\\n    // \u7701\u7565\u91cd\u590d\u4ee3\u7801...\\n\\n    then(onResolved, onRejected) {\\n        let self = this;\\n\\n        let promise2 = new ES6Promise((resolve, reject) => {\\n            let scheduleFn = () => {\\n                setTimeout(() => {\\n    \\n                    onResolved = typeof onResolved === \'function\' ? onResolved : v => v;\\n                    onRejected = typeof onRejected === \'function\' ? onRejected : v => {throw v};\\n                    try {\\n                        if (self._state === State.resolved) {\\n                            resolve(onResolved(self._value));\\n                        } else {\\n                            resolve(onRejected(self._value));\\n                        }                    \\n                    } catch (e) {\\n                        reject(e);\\n                    }\\n                });\\n            }\\n\\n            if (this._state === State.pending) {\\n                this._callbacks.push(scheduleFn);\\n            } else {\\n                scheduleFn();\\n            }\\n        });\\n\\n        return promise2;\\n    }\\n}\\n```\\n\\n## \u5b9e\u73b0 then \u65b9\u6cd5 v2\\n\\n\u4e0a\u9762\u5b9e\u73b0\u7684`then()`\u65b9\u6cd5\u4e2d\uff0c \u76f4\u63a5\u5c06`onResolved()`\uff08\u6216`onRejected()`\uff09\u7684\u8fd4\u56de\u503c\uff0c\u4f20\u9012\u7ed9`resolve`\uff08\u6216`reject`\uff09\uff0c\u6539\u53d8`promise2`\u7684\u72b6\u6001\u548c\u5185\u90e8\u503c\u3002\u8fd9\u91cc\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c`onResolved()`\uff08\u6216`onRejected()`\uff09\u8fd4\u56de\u7684\u4e5f\u662f\u4e00\u4e2a`Promise`\u5bf9\u8c61\uff08\u6216`thenable`\u5bf9\u8c61\uff09\uff0c\u90a3\u4e48`promise2`\u4e0d\u4f1a\u7b49\u5230\u8fd9\u4e2a\u8fd4\u56de\u7684`Promise`\u5bf9\u8c61`resolved`\u6216\u7684`rejected`\u540e\u624d\u6267\u884c\uff0c\u800c\u662f\u5c06\u8fd4\u56de\u7684`Promise`\u5bf9\u8c61\u4f5c\u4e3a`promise2`\u7684\u5185\u90e8\u503c\u3002\u770b\u4e0b\u9762\u4f8b\u5b50\uff0c\u6700\u540e\u4e00\u4e2a`then()`\u65b9\u6cd5\u6267\u884c\u540e\u5e94\u8be5\u8f93\u51fa`2`\u624d\u7b26\u5408\u9884\u671f\uff0c\u800c\u5b9e\u9645\u8f93\u51fa\u7684\u662f`ES6Promise`\u5bf9\u8c61\u5b9e\u4f8b\uff1a\\n\\n```javascript\\nlet p1 = new ES6Promise((resolve, reject) => {\\n    resolve(1);\\n}).then(value => {\\n    return new ES6Promise((resolve, reject) => {\\n        setTimeout(() => resolve(value + 1), 1000);\\n    });\\n}).then(value => console.log(value));       // \u8f93\u51fa\uff1aES6Promise \u5bf9\u8c61\\n```\\n\\n\u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u5bf9`onResolved()`\uff08\u6216`onRejected()`\uff09\u7684\u8fd4\u56de\u503c\uff08\u6682\u79f0\u4e4b\u4e3a`x`\uff09\u8fdb\u884c\u5224\u65ad\u548c\u5904\u7406\uff0c\u8fd9\u91cc\u5f15\u5165\u4e00\u4e2a`resolveProcedure()`\u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u6839\u636e`x`\u503c\u7684\u7c7b\u578b\uff0c\u51b3\u5b9a\u4f55\u65f6\u8c03\u7528`promise2`\u7684`resolve`\u6216`reject`\u65b9\u6cd5\u3002\u5982\u679c`x`\u662f\u4e00\u4e2a`thenable`\u5bf9\u8c61\uff0c\u5219\u7b49\u5230\u8be5`thenable`\u5bf9\u8c61\u72b6\u6001\u786e\u5b9a\u65f6\u624d\u8c03\u7528\u8c03\u7528`promise2`\u7684`resolve`\u6216`reject`\u65b9\u6cd5\uff0c\u5426\u5219\u7acb\u5373\u8c03\u7528`promise2`\u7684`resolve`\uff0c\u5982\u679c\u4e2d\u95f4\u629b\u51fa\u5f02\u5e38\uff0c\u5219\u7acb\u5373\u8c03\u7528`promise2`\u7684`reject`\u65b9\u6cd5\u3002\u4ee3\u7801\u5982\u4e0b\uff1a\\n\\n```javascript\\nclass ES6Promise {\\n    // \u7701\u7565\u91cd\u590d\u4ee3\u7801...\\n\\n    then(onResolved, onRejected) {\\n        let self = this;\\n\\n        let promise2 = new ES6Promise((resolve, reject) => {\\n            let scheduleFn = () => {\\n                setTimeout(() => {\\n                    onResolved = typeof onResolved === \'function\' ? onResolved : v => v;\\n                    onRejected = typeof onRejected === \'function\' ? onRejected : v => {throw v};\\n                    try {\\n                        // \u4fee\u6539\u8fd9\u91cc\\n                        let x = self._state === State.resolved ? onResolved(self._value) : onRejected(self._value);\\n                        resolveProcedure({ resolve, reject }, x);\\n                    } catch (e) {\\n                        reject(e);\\n                    }\\n                });\\n            }\\n\\n            if (this._state === State.pending) {\\n                this._callbacks.push(scheduleFn);\\n            } else {\\n                scheduleFn();\\n            }\\n        });\\n\\n        return promise2;\\n    }\\n}\\n\\n\\n// \u6839\u636e x \u503c\uff0c\u89e3\u6790 promise \u72b6\u6001 resolveProcedure(promise, x)\\nfunction resolveProcedure({ resolve, reject, promise2 }, x) {\\n    // 2.3.1 If promise and x refer to the same object, reject promise with a TypeError as the reason.\\n    if (promise2 === x) {\\n        reject(new TypeError(x));\\n    }\\n\\n    if (x instanceof ES6Promise) {    // 2.3.2 If x is a promise, adopt its state\\n        x.then(value => resolveProcedure({resolve, reject, promise2}, value), reason => reject(reason));\\n    } else if ((typeof x === \'object\' && x !== null) || (typeof x === \'function\')) {  // 2.3.3 \\n        let resolvedOrRejected = false;\\n        try {\\n            let then = x.then;      // 2.3.3.1 Let then be x.then\\n            if (typeof then === \'function\') {   // 2.3.3 If then is a function, call it with x as this, first argument resolvePromise, and second argument rejectPromise, where:\\n                then.call(x, value => {\\n                    if (!resolvedOrRejected) {\\n                        resolveProcedure({ resolve, reject, promise2 }, value); // 2.3.3.3.1 If/when resolvePromise is called with a value y, run [[Resolve]](promise, y).\\n                        resolvedOrRejected = true;\\n                    }\\n                    // 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.\\n                }, reason => {\\n                    if (!resolvedOrRejected) {\\n                        reject(reason);             // 2.3.3.3.2 If/when rejectPromise is called with a reason r, reject promise with r.\\n                        resolvedOrRejected = true;\\n                    }\\n                    // 2.3.3.3.3 If both resolvePromise and rejectPromise are called, or multiple calls to the same argument are made, the first call takes precedence, and any further calls are ignored.\\n                });\\n            } else {                // 2.3.3.4 If then is not a function, fulfill promise with x.\\n                resolve(x);\\n            }\\n        } catch (e) {\\n            if (!resolvedOrRejected) {\\n                // 2.3.3.2 If retrieving the property x.then results in a thrown exception e, reject promise with e as the reason.\\n                // 2.3.3.4 If calling then throws an exception e\\n                reject(e);\\n            }\\n        }\\n    } else {\\n        resolve(x);     // 2.3.4 If x is not an object or function, fulfill promise with x.\\n    }\\n}\\n```\\n\\n\u4fee\u6539\u540e\uff0c\u518d\u6b21\u8fd0\u884c\u4e0a\u9762\u6d4b\u8bd5\u4ee3\u7801\uff0c\u7ed3\u679c\u7b26\u5408\u9884\u671f\uff1a\\n```javascript\\nlet p1 = new ES6Promise((resolve, reject) => {\\n    resolve(1);\\n}).then(value => {\\n    return new ES6Promise((resolve, reject) => {\\n        setTimeout(() => resolve(value + 1), 1000);\\n    });\\n}).then(value => console.log(value));       // \u8f93\u51fa\uff1a 2\\n```\\n\\n## \u5b9e\u73b0 catch \u65b9\u6cd5\\n\\n`ES6Promise`\u6838\u5fc3\u7684`then`\u65b9\u6cd5\u4e0a\u9762\u5df2\u7ecf\u5b9e\u73b0\uff0c`catch`\u65b9\u6cd5\u4e0d\u8fc7\u662f`then`\u65b9\u6cd5\u7684\u4e00\u79cd\u4fbf\u6377\u5f62\u5f0f\uff0c\u5176\u5b9e\u73b0\u5982\u4e0b\uff1a\\n```javascript\\nclass ES6Promise {\\n    // \u7701\u7565\u91cd\u590d\u4ee3\u7801...\\n\\n    catch(onRejected) {\\n        this.then(undefined, onRejected);\\n    }\\n}\\n```\\n\\n## \u5b9e\u73b0 resolve/reject \u9759\u6001\\n\\nES6 \u7684`Promise`\u5bf9\u8c61\u8fd8\u63d0\u4f9b\u4e86\u4e24\u4e2a\u9759\u6001\u65b9\u6cd5`Promise.resolve`\u548c`Promise.reject`\uff0c\u901a\u8fc7\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5c06\u4e00\u822c`javascript`\u503c\u5c01\u88c5\u6210`Promise`\u5bf9\u8c61\u3002\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u4ee5`Promise.resolve`\u4e3a\u4f8b\uff0c\u9996\u5148\u8fd9\u4e2a\u65b9\u6cd5\u8981\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684`Promise`\u5bf9\u8c61\uff0c\u65b0\u7684`Promise`\u5bf9\u8c61\u89e3\u6790\u4f20\u5165\u7684\u503c\uff0c\u8fd9\u4e2a\u89e3\u6790\u8fc7\u7a0b\u4ea4\u7531`resolveProcedure()`\u65b9\u6cd5\u5b8c\u6210\uff0c\u7531\u4e8e\u8fd9\u662f`resolve`\u65b9\u6cd5\uff0c\u6240\u4ee5\u5373\u4f7f`value`\u662f\u4e00\u4e2a\u88ab`rejected`\u7684`Promise`\uff0c\u4e5f\u8981\u5c06\u5176\u7ed3\u679c`resolve`\uff0c\u6240\u4ee5\u4f20\u9012\u7ed9`resolveProcedure()`\u65b9\u6cd5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u90fd\u662f`resolve`\u65b9\u6cd5\u3002`Promise.reject`\u65b9\u6cd5\u5b9e\u73b0\u7c7b\u4f3c\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a\\n\\n```javascript\\nclass ES6Promise {\\n    // \u7701\u7565\u91cd\u590d\u4ee3\u7801...\\n\\n    static resolve(value) {\\n        return new ES6Promise((resolve, reject) => resolveProcedure({resolve, reject: resolve}, value));\\n    }\\n\\n    static reject(reason) {\\n        return new ES6Promise((resolve, reject) => resolveProcedure({resolve: reject, reject}, reason));\\n    }\\n}\\n```\\n\\n## \u6d4b\u8bd5\\n\\n\u4e0a\u9762\u7684`ES6Promsie`\u901a\u8fc7\u4e86 [promises-tests](https://github.com/promises-aplus/promises-tests) \u63d0\u4f9b\u7684\u5168\u90e8\u6d4b\u8bd5\u7528\u4f8b\uff0c\u610f\u5473\u7740\u5176\u5b8c\u5168\u7b26\u5408\u4e86 Promise/A+ \u89c4\u8303\u3002\\n\\n\u53ef\u4ee5\u901a\u8fc7 npm \u5b89\u88c5\u540e\uff0c\u67e5\u770b\u6e90\u7801\u548c\u6d4b\u8bd5\u7ed3\u679c\uff1a\\n\\n```\\n// \u5b89\u88c5\\n$ npm install es6-promise\\n// \u7f16\u8bd1\\n$ npm run build\\n// \u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b\\n$ npm run test\\n```\\n\\n\\n## \u5c0f\u7ed3\\n\\n`Promise`\u4f5c\u4e3a\u793e\u533a\u4ea7\u7269\uff0c\u6700\u7ec8\u88ab\u7eb3\u5165 ECMAScript \u89c4\u8303\uff0c\u53ef\u89c1\u5176\u662f\u88ab\u5927\u4f17\u6240\u63a5\u53d7\u7684\u3002`Promise`\u6539\u53d8\u4e86\u957f\u4e45\u4ee5\u6765\u901a\u8fc7`callback`\u7f16\u5199\u5f02\u6b65\u4ee3\u7801\u7684\u65b9\u5f0f\uff0c\u8ba9\u5f02\u6b65\u56de\u8c03\u4ee5\u4e00\u79cd\u66f4\u4f18\u96c5\u7684\u65b9\u5f0f\u94fe\u5f0f\u8c03\u7528\uff0c\u5e76\u62e5\u6709\u66f4\u6e05\u6670\u7684\u9519\u8bef\u5904\u7406\u3002`Promise`\u540c\u65f6\u4e5f\u4e3a`generator/yield`\u548c`async/await`\u4ee5\u540c\u6b65\u65b9\u5f0f\u7f16\u5199\u5f02\u6b65\u4ee3\u7801\u63d0\u4f9b\u4e86\u57fa\u7840\u8bbe\u65bd\u3002`Promise`\u4f7f\u7528\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u6d89\u53ca\u5230\u4e00\u4e9b\u590d\u6742\u6216\u6781\u7aef\u7684\u4f8b\u5b50\uff0c\u9700\u8981\u5bf9`Promise`\u89c4\u8303\u7406\u89e3\u900f\u5f7b\u624d\u80fd\u6b63\u786e\u5f97\u5230\u7ed3\u679c\u3002\\n\\n\\n\u6700\u540e\u9644\u4e0a\u9879\u76ee\u5730\u5740\u548c\u4ed3\u5e93\u5730\u5740\uff1a\\n\\ngithub \u5730\u5740 : <https://github.com/whinc/es6-promise>\\n\\nnpm \u5730\u5740\uff1a<https://www.npmjs.com/package/whinc-es6-promise>\\n\\n## \u53c2\u8003\\n\\n* [Promise/A+ \u89c4\u8303](https://promisesaplus.com/)\\n* [Promise | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)\\n* \u5d14\u9e4f\u98de\uff0c[\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0Promises/A+\u89c4\u8303](http://cuipengfei.me/blog/2016/05/15/promise/)\\n* [promises-tests | github](https://github.com/promises-aplus/promises-tests)\\n* \u962e\u4e00\u5cf0\uff0c[ECMAScript 6 \u5165\u95e8 - Promise](http://es6.ruanyifeng.com/#docs/promise)"},{"id":"/2018/02/25/switch-react-component-theme-dynamically","metadata":{"permalink":"/blog/2018/02/25/switch-react-component-theme-dynamically","editUrl":"https://github.com/whinc/whinc.github.io/tree/master/website/blog/2018/02-25-switch-react-component-theme-dynamically/index.md","source":"@site/blog/2018/02-25-switch-react-component-theme-dynamically/index.md","title":"React UI \u7ec4\u4ef6\u5e93\u6362\u80a4\u8bbe\u8ba1\u601d\u8def","description":"\u57fa\u4e8e React \u7684 UI \u7ec4\u4ef6\u5e93\u5c42\u51fa\u4e0d\u7a77\uff0c\u4f5c\u4e3a\u7ec4\u4ef6\u5e93\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u529f\u80fd\u5c31\u662f\u5b9e\u73b0\u4e3b\u9898\u6362\u80a4\u529f\u80fd\u3002\u901a\u8fc7\u7ec4\u4ef6\u5e93\u63d0\u4f9b\u7684\u4e3b\u9898\u5b9a\u5236\u63a5\u53e3\uff0c\u7528\u6237\u53ea\u9700\u8981\u4fee\u6539\u4e00\u4e9b\u7ec4\u4ef6\u7684 UI \u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u4fee\u6539\u6574\u4e2a\u7ec4\u4ef6\u5e93\u6837\u5f0f\u3002","date":"2018-02-25T00:00:00.000Z","formattedDate":"February 25, 2018","tags":[],"readingTime":11.345,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"prevItem":{"title":"\u81ea\u5df1\u52a8\u624b\u5b9e\u73b0 ES6 Promise","permalink":"/blog/2018/02/25/implement-promise"}},"content":"\u57fa\u4e8e React \u7684 UI \u7ec4\u4ef6\u5e93\u5c42\u51fa\u4e0d\u7a77\uff0c\u4f5c\u4e3a\u7ec4\u4ef6\u5e93\u5f88\u91cd\u8981\u7684\u4e00\u4e2a\u529f\u80fd\u5c31\u662f\u5b9e\u73b0\u4e3b\u9898\u6362\u80a4\u529f\u80fd\u3002\u901a\u8fc7\u7ec4\u4ef6\u5e93\u63d0\u4f9b\u7684\u4e3b\u9898\u5b9a\u5236\u63a5\u53e3\uff0c\u7528\u6237\u53ea\u9700\u8981\u4fee\u6539\u4e00\u4e9b\u7ec4\u4ef6\u7684 UI \u53c2\u6570\uff0c\u5c31\u53ef\u4ee5\u8fbe\u5230\u4fee\u6539\u6574\u4e2a\u7ec4\u4ef6\u5e93\u6837\u5f0f\u3002\\n\\n\u76ee\u6807\uff1a\u53ef\u5b9a\u5236\u6027\u5f3a\uff0c\u5e76\u4e14\u6613\u5b66\u6613\u7528\u3002\\n\\n\x3c!--truncate--\x3e\\n## \u4e00\u79cd\u7b80\u5355\u7684\u4e3b\u9898\u8bbe\u8ba1\u65b9\u6848\\n\\n\u4e3a\u4e86\u652f\u6301\u6839\u636e\u4e3b\u9898\u6539\u53d8\u5916\u89c2\uff0c\u7ec4\u4ef6\u5e93\u4e2d\u6bcf\u4e2a\u7ec4\u4ef6\u90fd\u8981\u6c42\u66b4\u9732\u4e00\u4e2a`style`\u5c5e\u6027\uff0c\u4ee5\u4fbf\u5916\u90e8\u53ef\u4ee5\u901a\u8fc7\u4f20\u5165\u4e0d\u540c\u6837\u5f0f\u63a7\u5236\u7ec4\u4ef6\u7684\u5916\u89c2\u3002\\n```javascript\\n<Button style={style}>\\n```\\n\\n\u4e3a\u4e86\u5207\u6362\u4e3b\u9898\uff0c\u5148\u5b9a\u4e49\u9ed1\u767d\u4e24\u5957\u4e3b\u9898\u3002\u4e0d\u540c\u4e3b\u9898\u4e4b\u95f4\u53ea\u662f\u6837\u5f0f\u53d6\u503c\u4e0d\u4e00\u6837\uff0c\u6570\u636e\u7ed3\u6784\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u3002\u6bcf\u79cd\u4e3b\u9898\u8be6\u7ec6\u5b9a\u4e49\u4e86\u6bcf\u4e2a\u7ec4\u4ef6\u7684`style`\u503c\u3002\\n```javascript\\nconst DarkTheme = {\\n  ButtonStyle: {...},\\n  InputStyle: {...}\\n}\\n\\nconst LightTheme = {\\n  ButtonStyle: {...},\\n  InputStyle: {...}\\n}\\n```\\n\\n\u63a5\u4e0b\u6765\u5c31\u662f\u5207\u6362\u4e3b\u9898\u4e86\uff0c\u5e94\u7528\u5185\u4e0d\u76f4\u63a5\u5f15\u7528\u5177\u4f53\u7684\u67d0\u4e2a\u4e3b\u9898\uff0c\u800c\u662f\u5f15\u7528\u4e3b\u9898\u7684\u62bd\u8c61\uff0c\u7531\u4e8e\u4e0d\u540c\u4e3b\u9898\u6570\u636e\u7ed3\u6784\u76f8\u540c\uff0c\u53ea\u9700\u8981\u5728\u521b\u5efa`theme`\u5bf9\u8c61\u65f6\uff0c\u8d4b\u4e88\u4e0d\u540c\u7684\u4e3b\u9898\u5373\u53ef\u8fbe\u5230\u5207\u6362\u6574\u4e2a\u5e94\u7528\u5916\u89c2\u7684\u76ee\u7684\u3002\\n```javascript\\nconst theme = DarkTheme\\n//const theme = LightTheme\\nReactDOM.render(\\n  <App>\\n    <Button style={theme.ButtonStyle} />\\n    <Input style={theme.InputStyle} />\\n  </App>\\n, node)\\n```\\n\\n\u5230\u8fd9\u91cc\uff0c\u4e00\u4e2a\u4e3b\u9898\u5207\u6362\u65b9\u6848\u5c31\u8bbe\u8ba1\u5b8c\u4e86\u3002\u9664\u4e86\u6bcf\u6b21\u90fd\u8981\u5728\u7ec4\u4ef6\u4e2d\u58f0\u660e`style`\u4e3a\u5f53\u524d\u4e3b\u9898\u6837\u5f0f\u5916\uff0c\u5176\u4ed6\u90fd\u6bd4\u8f83\u6ee1\u610f\uff0c\u4f60\u53ef\u4ee5\u4fee\u6539\u5168\u5c40\u4e3b\u9898\uff0c\u4e5f\u53ef\u4ee5\u4fee\u6539\u5355\u72ec\u67d0\u4e2a\u7ec4\u4ef6\u7684\u9ed8\u8ba4\u6837\u5f0f\u3002\\n```javascript\\nconst theme = DarkTheme\\n// \u4fee\u6539\u5168\u5c40 Button \u7684\u9ed8\u8ba4\u6837\u5f0f\\ntheme.ButtonStyle = {...this.ButtonStyle, color: \'red\'}\\n\\nReactDOM.render(\\n  <App>\\n    {/* \u4fee\u6539\u5355\u4e2a Button \u7684\u9ed8\u8ba4\u6837\u5f0f */} \\n    <Button style={[theme.ButtonStyle, {color: \'blue\'}]} />\\n    <Input style={theme.InputStyle} />\\n  </App>\\n, node)\\n```\\n\\n\u8fd9\u79cd\u65b9\u5f0f\u4e00\u4e2a\u4e3b\u8981\u95ee\u9898\u662f\uff1a\u6bcf\u4e2a\u7ec4\u4ef6\u4f7f\u7528\u65f6\u9700\u8981\u6307\u5b9a`style`\u4e3a\u6307\u5b9a\u7684\u4e3b\u9898\u6837\u5f0f\uff0c\u5bf9\u4f7f\u7528\u8005\u4e0d\u900f\u660e\u3002\u5982\u679c\u80fd\u89e3\u51b3\u597d\u8fd9\u4e2a\u95ee\u9898\uff0c\u90a3\u8fd9\u5c31\u4f1a\u662f\u4e00\u4e2a\u7b80\u5355\u5f3a\u5927\u7684\u4e3b\u9898\u5207\u6362\u65b9\u6848\u4e86\uff0c\u63a5\u4e0b\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\\n\\n\\n## \u57fa\u4e8e Context \u7684\u7ec4\u4ef6\u4e3b\u9898\u8bbe\u8ba1\u65b9\u6848\\n\\nContext \u662f React 15 \u5f15\u5165\u7684\u5b9e\u9a8c\u7279\u6027\uff08\u73b0\u5b9e\u60c5\u51b5\u662f\u5df2\u7ecf\u5e7f\u6cdb\u7528\u4e8e\u5404\u79cd\u5e93\uff09\uff0c\u5229\u7528\u5b83\u53ef\u4ee5\u5b9e\u73b0\u4ece\u7236\u7ec4\u4ef6\u4f20\u9012\u6570\u636e\u7ed9\u5b50\uff08\u53ca\u540e\u4ee3\uff09\u7ec4\u4ef6\uff0c\u800c\u4e0d\u5fc5\u4f9d\u8d56\u4e8e\u4e2d\u95f4\u7ec4\u4ef6\u7684\u5c42\u5c42\u4f20\u9012\uff0c\u6574\u4e2a\u4f20\u9012\u8fc7\u7a0b\u5bf9\u4e2d\u95f4\u7684\u7ec4\u4ef6\u662f\u900f\u660e\u7684\u3002\\n\\n\u901a\u8fc7\u7ec4\u4ef6\u7684 Context \u7279\u6027\uff0c\u53ef\u4ee5\u5c06\u5728\u6839\u7ec4\u4ef6\u4e2d\u5b9a\u4e49\u7684\u4e3b\u9898\u5bf9\u8c61\u76f4\u63a5\u4f20\u9012\u7ed9\u76ee\u6807\u5b50\u7ec4\u4ef6\uff0c\u800c\u4e0d\u5fc5\u663e\u5f0f\u5730\u7531\u5916\u90e8\u4f20\u5165`style`\u5c5e\u6027\u6765\u8bbe\u7f6e\u9ed8\u8ba4\u4e3b\u9898\u6837\u5f0f\u3002\u9884\u671f\u50cf\u4e0b\u9762\u8fd9\u6837\u4f7f\u7528\u4e3b\u9898\uff1a\u5728\u6839\u7ec4\u4ef6\u4e2d\u4f20\u5165\u4e3b\u9898\u914d\u7f6e\uff0c\u6240\u6709\u5728\u6839\u7ec4\u4ef6\u4e0b\u7684\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\u90fd\u663e\u793a\u4f20\u5165\u7684\u4e3b\u9898\u5916\u89c2\u3002\\n\\n```javascript\\nReactDOM.render(\\n  <ThemeProvider theme={DarkTheme}>\\n    <div>\\n      <p>Theme test</p>\\n      <FlatButton title={\'FlatButton\'} />\\n    </div>\\n  </ThemeProvider>\\n, node)\\n```\\n\\n\u601d\u8def\u6709\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u5f00\u59cb\u52a8\u624b\u5b9e\u73b0\u3002\\n\\n\u9996\u5148\uff0c\u5b9a\u4e49\u4e00\u4e2a\u7684\u6839\u7ec4\u4ef6\u547d\u540d\u4e3a`ThemeProvider`\uff08\u547d\u540d\u6309\u559c\u597d\uff0c\u65e0\u5f71\u54cd\uff09\uff0c\u5b83\u7684`render`\u65b9\u6cd5\u8fd4\u56de\u4f20\u5165\u7684`children`\u3002\u8fd9\u4e2a\u7ec4\u4ef6\u5145\u5f53\u4e00\u4e2a\u4e3b\u9898\u914d\u7f6e\u5206\u53d1\u7684\u89d2\u8272\uff0c\u5b83\u5c06\u4f20\u5165\u7684`theme`\u914d\u7f6e\u5bf9\u8c61\u4f20\u9012\u7ed9\u5b50\uff08\u53ca\u540e\u4ee3\uff09\u7ec4\u4ef6\u3002\\n\\n```javascript\\nclass ThemeProvider extends Component {\\n  static propTypes = {\\n    children: PropTypes.element,\\n    theme: PropTypes.object\\n  }\\n\\n  static childContextTypes = {\\n    theme: PropTypes.object.isRequired\\n  }\\n\\n  getChildContext() {\\n    return {\\n      theme: this.props.theme || createTheme()\\n    }\\n  }\\n\\n  render() {\\n    return this.props.children\\n  }\\n}\\n```\\n\\n\u7136\u540e\uff0c\u5b50\uff08\u540e\u4ee3\uff09\u7ec4\u4ef6\u4e2d\u63a5\u6536\u6765\u81ea\u6839\u7ec4\u4ef6\u7684`context`\u5bf9\u8c61\uff0c\u5e76\u8bfb\u53d6`theme`\u914d\u7f6e\u5bf9\u8c61\uff0c\u5c06\u6837\u5f0f\u5e94\u7528\u5230\u5f53\u524d\u81ea\u8eab\u3002\\n\\n```javascript\\nclass FlatButton extends Component {\\n  static propTypes = {\\n    title: PropTypes.string\\n  }\\n\\n  static contextTypes = {\\n    theme: PropTypes.object.isRequired\\n  }\\n\\n  render () {\\n    const {title} = this.props\\n    const {\\n      fontFamily,\\n      borderRadius,\\n      palette: {\\n        primaryColor,\\n        secondColor\\n      }\\n    } = this.context.theme\\n    return <button style={{backgroundColor: primaryColor, color: secondColor, fontFamily, borderRadius}}>{title}</button>\\n  }\\n}\\n```\\n\\nOK\uff0c\u8fd9\u5c31\u662f\u5168\u90e8\u4e86\uff0c\u73b0\u5728\u53ef\u4ee5\u5411\u6839\u7ec4\u4ef6`ThemeProvider`\u4f20\u5165\u4e0d\u540c\u7684\u4e3b\u9898\u914d\u7f6e\u6539\u53d8\u6574\u4e2aUI\u5e93\u7684\u5916\u89c2\u3002\\n\\n```javascript\\nReactDOM.render(\\n  <div style={{margin: 20}}>\\n    <p>DarkTheme</p>\\n    <ThemeProvider theme={createTheme(DarkTheme)}>\\n      <App />\\n    </ThemeProvider>\\n    <p>LightTheme</p>\\n    <ThemeProvider theme={createTheme(LightTheme)}>\\n      <App />\\n    </ThemeProvider>\\n  </div>\\n, node)\\n```\\n\\n![\u4e0d\u540c\u4e3b\u9898\u7684\u6548\u679c](./figure1.png)\\n\\n\\n### \u81ea\u5b9a\u4e49\u7ec4\u4ef6\u7684\u4e3b\u9898\\n\\n\u7b49\u7b49\u6709\u4e2a\u95ee\u9898\uff0c\u4e0a\u9762\u4f20\u9012\u7ed9\u6839\u7ec4\u4ef6`ThemeProvider`\u7684\u4e3b\u9898\u914d\u7f6e\u4ec5\u5f71\u54cd\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\u5916\u89c2\uff0c\u5bf9\u81ea\u5b9a\u4e49\u7684\u7ec4\u4ef6\u6ca1\u6709\u6548\u679c\u3002\\n\\n\u4e0b\u9762`MyButton`\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7ec4\u4ef6\uff0c\u5e76\u975e\u7ec4\u4ef6\u5e93\u63d0\u4f9b\u7684\u7ec4\u4ef6\uff0c\u653e\u5230\u9875\u9762\u4e0a\u663e\u793a\u7684\u662f\u9ed8\u8ba4\u7684\u6d4f\u89c8\u5668\u6837\u5f0f\u3002\\n```javascript\\nclass MyButton extends Component {\\n  static propTypes = {\\n    title: PropTypes.string\\n  }\\n\\n  render () {\\n    const {title} = this.props\\n    return <button>{title}</button>\\n  }\\n}\\n```\\n\\n![](./figure2.png)\\n\\n\u5bf9\u6bd4\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e0e\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\u4ee3\u7801\uff0c\u7f3a\u5c11\u4e86\u8bfb\u53d6`context`\u5bf9\u8c61\u4e2d\u7684`theme`\u5bf9\u8c61\u5e76\u5e94\u7528\u6837\u5f0f\u5230\u81ea\u8eab\u7684\u4ee3\u7801\u3002\u8865\u4e0a\u8fd9\u90e8\u5206\u4ee3\u7801\uff08\u4ece`context`\u4e2d\u8bfb\u53d6\u4e3b\u9898\u6837\u5f0f\u5e76\u5e94\u7528\u5230\u81ea\u8eab\uff09\u540e\uff0c\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4e5f\u53ef\u4ee5\u548c\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\u4e00\u6837\uff0c\u5b9e\u73b0\u4e0e\u5f53\u524d\u4e3b\u9898\u4fdd\u6301\u5916\u89c2\u4e00\u81f4\u53d8\u5316\u3002\\n\\n\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u8981\u505a\u7684\u5de5\u4f5c\u5c31\u662f\u5b9a\u4e49`contextTypes`\uff0c\u7136\u540e\u5728`render`\u4e2d\u8bfb\u53d6`context`\u4e2d\u7684\u4e3b\u9898\u914d\u7f6e\u5e76\u5e94\u7528\u5230\u81ea\u8eab\u6837\u5f0f\u3002\u4e3a\u6bcf\u4e2a\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u7f16\u5199\u4e00\u6b21`contextTypes`\u5b9a\u4e49\u5341\u5206\u4e4f\u5473\uff0c\u8fd9\u91cc\u5229\u7528\u9ad8\u9636\u7ec4\u4ef6\u5c01\u88c5\u4e00\u4e0b\u3002\\n\\n\u4ee3\u7801\u5982\u4e0b\uff0c`themeable`\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u4ece\u6839\u7ec4\u4ef6`ThemeProvider`\u4e2d\u83b7\u53d6`theme`\u914d\u7f6e\u5e76\u4f20\u9012\u7ed9\u88ab\u5305\u88f9\u7684\u7ec4\u4ef6\u3002\\n\\n```javascript\\nconst themeable = () => {\\n  const getDisplayName = c => c.displayName || c.name || \'Component\'\\n  return Component => {\\n    const WrappedComponent =  (props, context) => {\\n      const {theme = createTheme()} = context\\n      return <Component theme={theme} {...props} />\\n    }\\n    WrappedComponent.contextTypes = { \\n      theme: PropTypes.object\\n    }\\n    WrappedComponent.displayName = getDisplayName(Component)\\n    return WrappedComponent\\n  }\\n}\\n```\\n\\n\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u5bfc\u51fa\u65f6\uff0c\u4f7f\u7528`themeable`\u4fee\u9970\u4e00\u4e0b\uff0c\u4e4b\u540e\u4f7f\u7528\u65f6\u5bfc\u5165\u7684`MyButton`\u7ec4\u4ef6\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u6765\u81ea\u6839\u7ec4\u4ef6`ThemeProvider`\u4e2d\u63d0\u4f9b\u7684`theme`\u914d\u7f6e\u3002\\n```javascript\\nclass MyButton extends Component {\\n  static propTypes = {\\n    title: PropTypes.string\\n  }\\n\\n  render () {\\n    const {title, theme} = this.props\\n    return <button style={{color: theme.palette.secondColor}}>{title}</button>\\n  }\\n}\\nexport default themeble()(MyButton)\\n```\\n\\n## \u8bbe\u7f6e\u5355\u4e2a\u7ec4\u4ef6\u4e3b\u9898\\n\\n\u524d\u9762\u63d0\u5230\u4e86\u5728`ThemeProvider`\u4e2d\u63d0\u4f9b\u4e00\u4efd`theme`\u914d\u7f6e\u5bf9\u8c61\uff0c\u5b83\u5305\u542b\u4e86\u8bf8\u5982\u8c03\u8272\u677f\u3001\u5b57\u4f53\u3001\u8fb9\u6846\u3001\u95f4\u8ddd\u3001\u52a8\u753b\u7b49\u914d\u7f6e\uff0c\u5b83\u4f1a\u5e94\u7528\u5230\u6240\u6709\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\uff0c\u540c\u65f6\u4e5f\u63d0\u4f9b\u7ed9\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u4f7f\u7528\uff08\u901a\u8fc7`themeable`\u5305\u88c5\uff09\u3002\u6709\u65f6\u5728\u5f00\u53d1\u67d0\u4e2a\u7ec4\u4ef6\u65f6\uff0c\u5e0c\u671b\u8be5\u7ec4\u4ef6\u7684\u6837\u5f0f\u53ef\u4ee5\u5355\u72ec\u5b9a\u5236\uff0c\u5f53\u524d\u7684`theme`\u914d\u7f6e\u7ed3\u6784\u65e0\u6cd5\u6ee1\u8db3\uff0c\u9700\u8981\u5bf9\u914d\u7f6e\u7ed3\u6784\u8fdb\u884c\u7ec6\u5316\uff0c\u5b9e\u73b0\u9488\u5bf9\u7279\u5b9a\u7ec4\u4ef6\u7684\u4e3b\u9898\u5b9a\u5236\u3002\\n\\n\u9996\u5148\uff0c\u4fee\u6539\u7ec4\u4ef6\u5185\u90e8\u5e94\u7528`theme`\u7684\u4f18\u5148\u7ea7\uff1a\u4f18\u5148\u4f7f\u7528\u4e3b\u9898\u914d\u7f6e\u4e2d\u4e0e\u5f53\u524d\u7ec4\u4ef6\u5339\u914d\uff08\u4e00\u822c\u6309\u7ec4\u4ef6\u540d\uff09\u7684\u6837\u5f0f\u3002\u4f8b\u5982\u4e0b\u9762`FlatButton`\u4f18\u5148\u4f7f\u7528`theme.flatButton`\u914d\u7f6e\u7684\u6837\u5f0f\u3002\\n\\n```javascript\\nclass FlatButton extends Component {\\n  static propTypes = {\\n    title: PropTypes.string\\n  }\\n\\n  static contextTypes = {\\n    theme: PropTypes.object.isRequired\\n  }\\n\\n  static defaultProps = {\\n    title: \'\'\\n  }\\n\\n  render () {\\n    const {title} = this.props\\n    const {\\n      flatButton: {\\n        borderRadius,\\n        textColor,\\n        backgroundColor\\n      }\\n    } = this.context.theme\\n    return <button style={{ backgroundColor, color: textColor, borderRadius }}>{title}</button>\\n  }\\n}\\n```\\n\\n\u4e3b\u9898\u914d\u7f6e\u5bf9\u8c61\u4e2d\u4ec5\u5b9a\u4e49\u6700\u5c0f\u914d\u7f6e\u9879\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u4e3b\u9898\u914d\u7f6e\u975e\u5e38\u7cbe\u7b80\uff0c`createTheme()`\u51fd\u6570\u63a5\u6536\u4e3b\u9898\u914d\u7f6e\u5bf9\u8c61\uff0c\u8fd4\u56de\u5305\u542b\u4e86\u7279\u5b9a\u7ec4\u4ef6\u7684\u6837\u5f0f\uff0c\u7ec4\u4ef6\u9ed8\u8ba4\u4e3b\u9898\u6837\u5f0f\u57fa\u4e8e\u6700\u5c0f\u914d\u7f6e\u9879\u3002\\n\\n\u4f8b\u5982\u4e0b\u9762\u4e3b\u9898\u7684\u914d\u7f6e\u53ea\u5305\u542b\u4e86\u8c03\u8272\u677f\u3001\u5b57\u4f53\u3001\u8fb9\u6846\uff0c`createTheme()`\u51fd\u6570\u8c03\u7528\u540e\u8fd4\u56de\u7684\u4e3b\u9898\u5bf9\u8c61\uff0c\u5305\u542b\u4e86`FlatButton`\u7684\u6837\u5f0f\uff0c\u521b\u5efa\u7684\u65b0\u7684\u4e3b\u9898\u5bf9\u8c61\u63d0\u4f9b\u7ed9`ThemeProvider`\u7ec4\u4ef6\u8fdb\u884c\u5206\u53d1\u3002\\n```javascript\\nconst DarkTheme = {\\n  fontFamily: \'Roboto, sans-serif\',\\n  borderRadius: 2,\\n  palette: {\\n    primaryColor: \'#000000\',\\n    secondColor: \'#444444\'\\n  }\\n}\\n\\nfunction createTheme (theme = {}, ...more) {\\n  const noneUiTheme = merge({}, LightTheme, theme, ...more)\\n\\n  const {borderRadius, palette, fontFamily} = noneUiTheme\\n  return merge({\\n    flatButton: {\\n      borderRadius: borderRadius,\\n      textColor: palette.textColor,\\n      backgroundColor: palette.primaryColor\\n    }\\n  }, noneUiTheme)\\n}\\n\\n<ThemeProvider theme={createTheme(DardTheme)}>\\n  \x3c!-- Your code --\x3e\\n</ThemeProvider >\\n```\\n\\n\u7ecf\u8fc7\u4e0a\u9762\u7684\u6539\u52a8\u540e\uff0c\u7ec4\u4ef6\u7684\u4e3b\u9898\u6ca1\u6709\u53d1\u751f\u4ec0\u4e48\u53d8\u5316\uff0c\u4f46\u662f\u589e\u52a0\u4e86\u4e3a\u7ec4\u4ef6\u5355\u72ec\u8bbe\u7f6e\u4e3b\u9898\u7684\u80fd\u529b\u3002\u4e0b\u9762\u4f8b\u5b50\u4e2d\uff0c\u521b\u5efa\u4e86\u4e00\u4efd\u81ea\u5b9a\u4e49\u7684`customDarkTheme`\u4e3b\u9898\uff0c\u8be5\u4e3b\u9898\u9488\u5bf9`FlatButton`\u6837\u5f0f\u8fdb\u884c\u4e86\u5b9a\u5236\uff0c\u7ec4\u4ef6\u5e93\u4e2d\u5176\u4ed6\u7ec4\u4ef6\u4fdd\u6301\u5f53\u524d\u9ed8\u8ba4\u4e3b\u9898\u4e0d\u53d8\u3002\\n\\n```javascript\\nimport {ThemeProvider, createTheme, DarkTheme, LightTheme} from \'./none-ui\'\\n\\n// \u7ee7\u627f DarkTheme \u5e76\u5728\u6b64\u57fa\u7840\u4e4b\u4e0a\u5b9a\u5236 FlatButton \u7ec4\u4ef6\u7684\u6837\u5f0f\\nconst customDarkTheme = {\\n  ...DarkTheme,\\n  flatButton: {\\n    backgroundColor: \'red\',\\n    textColor: \'white\',\\n    borderRadius: 10\\n  }\\n}\\n\\nReactDOM.render(\\n  <div style={{margin: 20}}>\\n    <p>DarkTheme</p>\\n    <ThemeProvider theme={createTheme(DarkTheme)}>\\n      <App />\\n    </ThemeProvider>\\n    <p>Custom DarkTheme</p>\\n    <ThemeProvider theme={createTheme(customDarkTheme)}>\\n      <App />\\n    </ThemeProvider>\\n    <p>LightTheme</p>\\n    <ThemeProvider theme={createTheme(LightTheme)}>\\n      <App />\\n    </ThemeProvider>\\n  </div>\\n, document.getElementById(\'root\'));\\n```\\n\\n![](./figure3.png)\\n\\n## \u603b\u7ed3\\n\\n\u6587\u7ae0\u9996\u5148\u4ecb\u7ecd\u4e86\u4e00\u79cd\u7b80\u5355\u76f4\u89c2\u7684\u5207\u6362\u4e3b\u9898\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u8981\u6c42\u6bcf\u6b21\u4f7f\u7528\u7ec4\u4ef6\u65f6\u90fd\u8981\u5173\u5fc3\u4e3b\u9898\u6837\u5f0f\uff0c\u5bf9\u4f7f\u7528\u8005\u4e0d\u53cb\u597d\u3002\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u63d0\u4f9b\u9664\u4e86\u5229\u7528`React`\u7684`Context`\u7279\u6027\uff0c\u5728\u6839\u7ec4\u4ef6\u4e2d\u5b9a\u4e49\u4e00\u6b21\u4e3b\u9898\uff0c\u6240\u6709\u4f7f\u7528\u5230\u7684\u7ec4\u4ef6\u5e93\u4e2d\u7684\u7ec4\u4ef6\u90fd\u663e\u793a\u5f53\u524d\u4e3b\u9898\uff0c\u4f7f\u7528\u65f6\u65e0\u9700\u5173\u5fc3\u4e3b\u9898\u6837\u5f0f\u3002\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u53c8\u4ecb\u7ecd\u4e86\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u5982\u4f55\u4f7f\u7528\u4e3b\u9898\u3001\u5982\u4f55\u4fee\u6539\u7279\u5b9a\u7ec4\u4ef6\u7684\u4e3b\u9898\u6837\u5f0f\u3002\\n\\n\u672c\u6587\u4e3b\u8981\u53c2\u8003\u4e86[callemall/material-ui](https://github.com/callemall/material-ui)\u5e93\u7684[v0.19.4](https://github.com/callemall/material-ui/tree/v0.19.4)\u7248\u672c\u7684\u4e3b\u9898\u5207\u6362\u529f\u80fd\u5b9e\u73b0\u673a\u5236\uff0c\u5c06\u5176\u4e2d\u7684\u91cd\u8981\u90e8\u5206\u63d0\u53d6\u51fa\u6765\u5e76\u7b80\u5316\uff0c\u65b9\u4fbf\u5b66\u4e60\u3002\\n\\n\u6587\u4e2d\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u5728Github\u4e0a[whinc/react-theme-solutions](https://github.com/whinc/react-theme-solutions)\u627e\u5230\uff0c\u8fd9\u4e2a\u4ed3\u5e93\u4e2d\u4ee3\u4e2d\u5b9e\u73b0\u4e86\u4e00\u4e2a\u5177\u6709\u4e3b\u9898\u5207\u6362\u529f\u80fd\u7684UI\u5e93\u3002"}]}')}}]);